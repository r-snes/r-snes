<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
    content: counter(line);
    margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","apu.rs"],"content":"use crate::{cpu::Spc700, dsp::Dsp, memory::Memory, timers::Timers};\n\npub struct Apu {\n    pub cpu: Spc700,\n    pub dsp: Dsp,\n    pub memory: Memory,\n    pub timers: Timers,\n    pub cycles: u64,\n}\n\n\nimpl Apu {\n    pub fn new() -\u003e Self {\n        Self {\n            cpu: Spc700::new(),\n            dsp: Dsp::new(),\n            memory: Memory::new(),\n            timers: Timers::new(),\n            cycles: 0,\n        }\n    }\n\n    /// Step the APU forward by a given number of cycles\n    pub fn step(\u0026mut self, cycles: u32) {\n        for _ in 0..cycles {\n            self.cpu.step(\u0026mut self.memory);\n            self.timers.step(\u0026mut self.memory);\n            self.dsp.step(\u0026mut self.memory);\n            self.cycles += 1;\n        }\n    }\n\n    /// Generate audio samples (stub for now)\n    pub fn render_audio(\u0026mut self, _num_samples: usize) -\u003e Vec\u003ci16\u003e {\n        // TODO: pull from DSPâ€™s audio buffer\n        vec![0; _num_samples]\n    }\n}\n","traces":[{"line":13,"address":[42592],"length":1,"stats":{"Line":0}},{"line":15,"address":[42639],"length":1,"stats":{"Line":0}},{"line":16,"address":[42649],"length":1,"stats":{"Line":0}},{"line":17,"address":[42659],"length":1,"stats":{"Line":0}},{"line":18,"address":[42672],"length":1,"stats":{"Line":0}},{"line":24,"address":[42784],"length":1,"stats":{"Line":0}},{"line":25,"address":[42802,42959],"length":1,"stats":{"Line":0}},{"line":26,"address":[42842],"length":1,"stats":{"Line":0}},{"line":27,"address":[42869],"length":1,"stats":{"Line":0}},{"line":28,"address":[42896],"length":1,"stats":{"Line":0}},{"line":29,"address":[42916,42952,42964],"length":1,"stats":{"Line":0}},{"line":34,"address":[42992],"length":1,"stats":{"Line":0}},{"line":36,"address":[43013],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":13},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","cpu.rs"],"content":"use crate::memory::Memory;\n\n#[derive(Default)]\npub struct Registers {\n    pub a: u8,     // Accumulator\n    pub x: u8,     // Index X\n    pub y: u8,     // Index Y\n    pub sp: u8,    // Stack Pointer\n    pub pc: u16,   // Program Counter\n    pub psw: u8,   // Processor Status Word (flags)\n}\n\n// Processor status flags\npub const FLAG_C: u8 = 0x01; // Carry\npub const FLAG_Z: u8 = 0x02; // Zero\npub const FLAG_I: u8 = 0x04; // Interrupt Disable\npub const FLAG_H: u8 = 0x08; // Half-Carry\npub const FLAG_B: u8 = 0x10; // Break\npub const FLAG_P: u8 = 0x20; // Direct Page\npub const FLAG_V: u8 = 0x40; // Overflow\npub const FLAG_N: u8 = 0x80; // Negative\n\npub struct Spc700 {\n    pub regs: Registers,\n    pub cycles: u32,\n}\n\nimpl Spc700 {\n    pub fn new() -\u003e Self {\n        Self {\n            regs: Registers::default(),\n            cycles: 0,\n        }\n    }\n\n    pub fn reset(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.pc = mem.read16(0xFFFE); // Reset vector\n        self.regs.sp = 0xFF;\n        self.regs.psw = 0;\n    }\n\n    pub fn step(\u0026mut self, mem: \u0026mut Memory) {\n        let opcode = mem.read8(self.regs.pc);\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n\n        match opcode {\n            0x00 =\u003e self.inst_nop(), // NOP\n        \n            // Register moves\n            0x7D =\u003e self.inst_mov_a_x(), // MOV A, X\n            0xDD =\u003e self.inst_mov_a_y(), // MOV A, Y\n            0x5D =\u003e self.inst_mov_x_a(), // MOV X, A\n            0xFD =\u003e self.inst_mov_y_a(), // MOV Y, A\n        \n            // Immediate loads\n            0xE8 =\u003e self.inst_lda_imm(mem), // LDA #imm\n            0xCD =\u003e self.inst_ldx_imm(mem), // LDX #imm\n            0x8D =\u003e self.inst_ldy_imm(mem), // LDY #imm\n        \n            // Absolute loads\n            0xE5 =\u003e self.inst_lda_abs(mem), // MOV A, !a\n            0xE9 =\u003e self.inst_ldx_abs(mem), // MOV X, !a\n            0xEC =\u003e self.inst_ldy_abs(mem), // MOV Y, !a\n        \n            // Direct Page loads\n            0xE4 =\u003e self.inst_lda_dp(mem), // MOV A, d\n            0xF8 =\u003e self.inst_ldx_dp(mem), // MOV X, d\n            0xEB =\u003e self.inst_ldy_dp(mem), // MOV Y, d\n        \n            // Stores\n            0xC4 =\u003e self.inst_sta_dp(mem),  // MOV d, A\n            0xC5 =\u003e self.inst_sta_abs(mem), // MOV !a, A\n            0xC9 =\u003e self.inst_stx_abs(mem), // MOV !a, X\n            0xCC =\u003e self.inst_sty_abs(mem), // MOV !a, Y\n        \n            // Arithmetic \u0026 logic\n            0x88 =\u003e self.inst_adc_imm(mem), // ADC #imm\n            0xA8 =\u003e self.inst_sbc_imm(mem), // SBC #imm\n            0x68 =\u003e self.inst_cmp_imm(mem), // CMP #imm\n            0x28 =\u003e self.inst_and_imm(mem), // AND #imm\n            0x08 =\u003e self.inst_ora_imm(mem), // ORA #imm\n            0x48 =\u003e self.inst_eor_imm(mem), // EOR #imm\n        \n            // Catch-all\n            _ =\u003e unimplemented!(\"Opcode {:02X} not yet implemented\", opcode),\n        }\n    }        \n\n    // Flag helpers\n    pub fn set_flag(\u0026mut self, mask: u8, value: bool) {\n        if value {\n            self.regs.psw |= mask;\n        } else {\n            self.regs.psw \u0026= !mask;\n        }\n    }\n\n    pub fn get_flag(\u0026self, mask: u8) -\u003e bool {\n        (self.regs.psw \u0026 mask) != 0\n    }      \n\n    fn set_zn_flags(\u0026mut self, value: u8) {\n        self.set_flag(FLAG_Z, value == 0);\n        self.set_flag(FLAG_N, (value \u0026 0x80) != 0);\n    }\n\n    fn dp_base(\u0026self) -\u003e u16 {\n        if self.get_flag(FLAG_P) {\n            0x0100\n        } else {\n            0x0000\n        }\n    }\n\n    /// Reads the next byte from memory and increments the program counter.\n    fn read_immediate(\u0026mut self, mem: \u0026Memory) -\u003e u8 {\n        let value = mem.read8(self.regs.pc);\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n        value\n    }\n\n    /// Read a 16-bit little-endian immediate (two bytes) and advance PC by 2.\n    fn read_immediate16(\u0026mut self, mem: \u0026mut Memory) -\u003e u16 {\n        let lo = self.read_immediate(mem) as u16;\n        let hi = self.read_immediate(mem) as u16;\n        lo | (hi \u003c\u003c 8)\n    }\n\n    // Implemented instructions\n    fn inst_mov_a_x(\u0026mut self) {\n        self.regs.a = self.regs.x;\n        self.cycles += 2;\n    }\n    fn inst_mov_a_y(\u0026mut self) {\n        self.regs.a = self.regs.y;\n        self.cycles += 2;\n    }\n    fn inst_mov_x_a(\u0026mut self) {\n        self.regs.x = self.regs.a;\n        self.cycles += 2;\n    }\n    fn inst_mov_y_a(\u0026mut self) {\n        self.regs.y = self.regs.a;\n        self.cycles += 2;\n    }\n    fn inst_nop(\u0026mut self) {\n        self.cycles += 2;\n    }\n\n    pub fn inst_lda_imm(\u0026mut self, mem: \u0026Memory) {\n        self.regs.a = self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n\n    pub fn inst_ldx_imm(\u0026mut self, mem: \u0026Memory) {\n        self.regs.x = self.read_immediate(mem);\n        self.set_zn_flags(self.regs.x);\n        self.cycles += 2;\n    }\n\n    pub fn inst_ldy_imm(\u0026mut self, mem: \u0026Memory) {\n        self.regs.y = self.read_immediate(mem);\n        self.set_zn_flags(self.regs.y);\n        self.cycles += 2;\n    }\n\n    pub fn inst_sta_abs(\u0026mut self, mem: \u0026mut Memory) {\n        // Read the 16-bit address in little-endian\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        // Move PC past the operand\n        self.regs.pc = self.regs.pc.wrapping_add(2);\n    \n        // Store A into memory\n        mem.write8(addr, self.regs.a);\n    \n        // Increment cycles\n        self.cycles += 4;\n    }\n    \n    pub fn inst_stx_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n    \n        mem.write8(addr, self.regs.x);\n        self.cycles += 4;\n    }\n    \n    pub fn inst_sty_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n    \n        mem.write8(addr, self.regs.y);\n        self.cycles += 4;\n    }\n\n    pub fn inst_lda_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n        self.regs.a = mem.read8(addr as u16);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 4;\n    }\n    \n    pub fn inst_ldx_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n        self.regs.x = mem.read8(addr as u16);\n        self.set_zn_flags(self.regs.x);\n        self.cycles += 4;\n    }\n    \n    pub fn inst_ldy_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n        self.regs.y = mem.read8(addr as u16);\n        self.set_zn_flags(self.regs.y);\n        self.cycles += 4;\n    }    \n\n    // Load accumulator from direct page\n    pub fn inst_lda_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        self.regs.a = mem.read8(addr);\n    \n        self.set_zn_flags(self.regs.a);\n        self.cycles += 3;\n    }\n    \n    pub fn inst_ldx_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        self.regs.x = mem.read8(addr);\n    \n        self.set_zn_flags(self.regs.x);\n        self.cycles += 3;\n    }\n    \n    pub fn inst_ldy_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        self.regs.y = mem.read8(addr);\n    \n        self.set_zn_flags(self.regs.y);\n        self.cycles += 3;\n    }\n    \n    pub fn inst_sta_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        mem.write8(addr, self.regs.a);\n    \n        self.cycles += 3;\n    }\n    \n    pub fn inst_stx_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        mem.write8(addr, self.regs.x);\n    \n        self.cycles += 3;\n    }\n    \n    pub fn inst_sty_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        mem.write8(addr, self.regs.y);\n    \n        self.cycles += 3;\n    }    \n\n    pub fn inst_adc_imm(\u0026mut self, mem: \u0026mut Memory) {\n        let value = self.read_immediate(mem);\n\n        let carry_in = if self.get_flag(FLAG_C) { 1 } else { 0 };\n        let result = self.regs.a as u16 + value as u16 + carry_in as u16;\n\n        // Update flags\n        self.set_flag(FLAG_C, result \u003e 0xFF);\n        let result_u8 = result as u8;\n        self.set_zn_flags(result_u8);\n\n        // Overflow flag\n        self.set_flag(\n            FLAG_V,\n            (!(self.regs.a ^ value) \u0026 (self.regs.a ^ result_u8) \u0026 0x80) != 0,\n        );\n\n        self.regs.a = result_u8;\n        self.cycles += 2;\n    }\n\n    /// Compare memory with accumulator (sets flags only)\n    pub fn inst_cmp_imm(\u0026mut self, mem: \u0026mut Memory) {\n        let value = self.read_immediate(mem);\n\n        let result = self.regs.a.wrapping_sub(value);\n\n        self.set_flag(FLAG_C, self.regs.a \u003e= value);\n        self.set_zn_flags(result);\n\n        self.cycles += 2;\n    }\n\n    pub fn inst_sbc_imm(\u0026mut self, mem: \u0026mut Memory) {\n        let value = self.read_immediate(mem);\n\n        let carry_in = if self.get_flag(FLAG_C) { 0 } else { 1 }; // SPC700 uses inverted carry\n        let result = self.regs.a as i16 - value as i16 - carry_in as i16;\n\n        self.set_flag(FLAG_C, result \u003e= 0);\n        let result_u8 = result as u8;\n        self.set_zn_flags(result_u8);\n        self.set_flag(\n            FLAG_V,\n            ((self.regs.a ^ result_u8) \u0026 (self.regs.a ^ value) \u0026 0x80) != 0,\n        );\n\n        self.regs.a = result_u8;\n        self.cycles += 2;\n    }\n\n    /// Bitwise AND with accumulator\n    pub fn inst_and_imm(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.a \u0026= self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n\n    /// Bitwise OR with accumulator\n    pub fn inst_ora_imm(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.a |= self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n\n    /// Bitwise XOR with accumulator\n    pub fn inst_eor_imm(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.a ^= self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n}\n","traces":[{"line":29,"address":[347920],"length":1,"stats":{"Line":1}},{"line":31,"address":[43262],"length":1,"stats":{"Line":1}},{"line":36,"address":[348000],"length":1,"stats":{"Line":0}},{"line":37,"address":[348032],"length":1,"stats":{"Line":0}},{"line":38,"address":[348051],"length":1,"stats":{"Line":0}},{"line":39,"address":[348055],"length":1,"stats":{"Line":0}},{"line":42,"address":[348064],"length":1,"stats":{"Line":6}},{"line":43,"address":[43435],"length":1,"stats":{"Line":3}},{"line":44,"address":[348127],"length":1,"stats":{"Line":5}},{"line":46,"address":[348147],"length":1,"stats":{"Line":7}},{"line":47,"address":[348590],"length":1,"stats":{"Line":1}},{"line":50,"address":[43928],"length":1,"stats":{"Line":1}},{"line":51,"address":[348620],"length":1,"stats":{"Line":1}},{"line":52,"address":[348635],"length":1,"stats":{"Line":1}},{"line":53,"address":[348650],"length":1,"stats":{"Line":1}},{"line":56,"address":[348670],"length":1,"stats":{"Line":1}},{"line":57,"address":[348691],"length":1,"stats":{"Line":1}},{"line":58,"address":[348712],"length":1,"stats":{"Line":1}},{"line":61,"address":[348733],"length":1,"stats":{"Line":1}},{"line":62,"address":[348754],"length":1,"stats":{"Line":1}},{"line":63,"address":[348775],"length":1,"stats":{"Line":1}},{"line":66,"address":[348796],"length":1,"stats":{"Line":1}},{"line":67,"address":[348817],"length":1,"stats":{"Line":0}},{"line":68,"address":[348838],"length":1,"stats":{"Line":0}},{"line":71,"address":[348859],"length":1,"stats":{"Line":1}},{"line":72,"address":[348880],"length":1,"stats":{"Line":1}},{"line":73,"address":[348901],"length":1,"stats":{"Line":1}},{"line":74,"address":[348919],"length":1,"stats":{"Line":1}},{"line":77,"address":[348937],"length":1,"stats":{"Line":0}},{"line":78,"address":[348955],"length":1,"stats":{"Line":0}},{"line":79,"address":[348973],"length":1,"stats":{"Line":0}},{"line":80,"address":[348991],"length":1,"stats":{"Line":0}},{"line":81,"address":[349009],"length":1,"stats":{"Line":0}},{"line":82,"address":[349027],"length":1,"stats":{"Line":0}},{"line":90,"address":[349056],"length":1,"stats":{"Line":2}},{"line":91,"address":[349088,349110],"length":1,"stats":{"Line":3}},{"line":92,"address":[349121],"length":1,"stats":{"Line":1}},{"line":94,"address":[44397],"length":1,"stats":{"Line":2}},{"line":98,"address":[349136],"length":1,"stats":{"Line":1}},{"line":99,"address":[349148],"length":1,"stats":{"Line":2}},{"line":102,"address":[349168],"length":1,"stats":{"Line":1}},{"line":103,"address":[349193],"length":1,"stats":{"Line":1}},{"line":104,"address":[349227],"length":1,"stats":{"Line":3}},{"line":107,"address":[349264],"length":1,"stats":{"Line":1}},{"line":108,"address":[44569,44590],"length":1,"stats":{"Line":2}},{"line":109,"address":[44592],"length":1,"stats":{"Line":0}},{"line":111,"address":[44583],"length":1,"stats":{"Line":1}},{"line":116,"address":[349328],"length":1,"stats":{"Line":2}},{"line":117,"address":[349360],"length":1,"stats":{"Line":2}},{"line":118,"address":[349382],"length":1,"stats":{"Line":3}},{"line":123,"address":[349424],"length":1,"stats":{"Line":0}},{"line":124,"address":[44744],"length":1,"stats":{"Line":0}},{"line":125,"address":[44772],"length":1,"stats":{"Line":0}},{"line":126,"address":[44792],"length":1,"stats":{"Line":0}},{"line":130,"address":[44816],"length":1,"stats":{"Line":1}},{"line":131,"address":[44829],"length":1,"stats":{"Line":1}},{"line":132,"address":[44866,44835],"length":1,"stats":{"Line":1}},{"line":134,"address":[44880],"length":1,"stats":{"Line":1}},{"line":135,"address":[44893],"length":1,"stats":{"Line":1}},{"line":136,"address":[44899,44930],"length":1,"stats":{"Line":1}},{"line":138,"address":[349648],"length":1,"stats":{"Line":1}},{"line":139,"address":[349661],"length":1,"stats":{"Line":1}},{"line":140,"address":[44963,44994],"length":1,"stats":{"Line":1}},{"line":142,"address":[349712],"length":1,"stats":{"Line":1}},{"line":143,"address":[45021],"length":1,"stats":{"Line":1}},{"line":144,"address":[349731,349762],"length":1,"stats":{"Line":1}},{"line":146,"address":[45072],"length":1,"stats":{"Line":1}},{"line":147,"address":[45116,45085],"length":1,"stats":{"Line":1}},{"line":150,"address":[349840],"length":1,"stats":{"Line":1}},{"line":151,"address":[349859],"length":1,"stats":{"Line":1}},{"line":152,"address":[349874],"length":1,"stats":{"Line":1}},{"line":153,"address":[349891,349923],"length":1,"stats":{"Line":1}},{"line":156,"address":[349936],"length":1,"stats":{"Line":1}},{"line":157,"address":[349955],"length":1,"stats":{"Line":1}},{"line":158,"address":[349970],"length":1,"stats":{"Line":1}},{"line":159,"address":[350019,349987],"length":1,"stats":{"Line":1}},{"line":162,"address":[350032],"length":1,"stats":{"Line":1}},{"line":163,"address":[350051],"length":1,"stats":{"Line":1}},{"line":164,"address":[350066],"length":1,"stats":{"Line":1}},{"line":165,"address":[45411,45379],"length":1,"stats":{"Line":1}},{"line":168,"address":[350128],"length":1,"stats":{"Line":1}},{"line":170,"address":[350163],"length":1,"stats":{"Line":1}},{"line":171,"address":[350190],"length":1,"stats":{"Line":1}},{"line":172,"address":[350237],"length":1,"stats":{"Line":1}},{"line":175,"address":[350254],"length":1,"stats":{"Line":1}},{"line":178,"address":[350288],"length":1,"stats":{"Line":1}},{"line":181,"address":[350306,350338],"length":1,"stats":{"Line":1}},{"line":184,"address":[350352],"length":1,"stats":{"Line":1}},{"line":185,"address":[350387],"length":1,"stats":{"Line":1}},{"line":186,"address":[350414],"length":1,"stats":{"Line":1}},{"line":187,"address":[350461],"length":1,"stats":{"Line":1}},{"line":189,"address":[350478],"length":1,"stats":{"Line":1}},{"line":191,"address":[350512],"length":1,"stats":{"Line":1}},{"line":192,"address":[45855,45823],"length":1,"stats":{"Line":1}},{"line":195,"address":[350576],"length":1,"stats":{"Line":1}},{"line":196,"address":[350611],"length":1,"stats":{"Line":1}},{"line":197,"address":[350638],"length":1,"stats":{"Line":1}},{"line":198,"address":[350685],"length":1,"stats":{"Line":1}},{"line":200,"address":[350702],"length":1,"stats":{"Line":1}},{"line":202,"address":[350736],"length":1,"stats":{"Line":1}},{"line":203,"address":[350754,350786],"length":1,"stats":{"Line":1}},{"line":206,"address":[46096],"length":1,"stats":{"Line":1}},{"line":207,"address":[350835],"length":1,"stats":{"Line":1}},{"line":208,"address":[350862],"length":1,"stats":{"Line":1}},{"line":209,"address":[350909],"length":1,"stats":{"Line":1}},{"line":211,"address":[350926],"length":1,"stats":{"Line":1}},{"line":212,"address":[350960],"length":1,"stats":{"Line":1}},{"line":213,"address":[350979],"length":1,"stats":{"Line":1}},{"line":214,"address":[46321,46289],"length":1,"stats":{"Line":1}},{"line":217,"address":[351056],"length":1,"stats":{"Line":1}},{"line":218,"address":[46371],"length":1,"stats":{"Line":1}},{"line":219,"address":[351118],"length":1,"stats":{"Line":1}},{"line":220,"address":[46443],"length":1,"stats":{"Line":1}},{"line":222,"address":[46460],"length":1,"stats":{"Line":1}},{"line":223,"address":[46494],"length":1,"stats":{"Line":1}},{"line":224,"address":[351235],"length":1,"stats":{"Line":1}},{"line":225,"address":[46529,46561],"length":1,"stats":{"Line":1}},{"line":228,"address":[46576],"length":1,"stats":{"Line":1}},{"line":229,"address":[351347],"length":1,"stats":{"Line":1}},{"line":230,"address":[351374],"length":1,"stats":{"Line":1}},{"line":231,"address":[351421],"length":1,"stats":{"Line":1}},{"line":233,"address":[46700],"length":1,"stats":{"Line":1}},{"line":234,"address":[351472],"length":1,"stats":{"Line":1}},{"line":235,"address":[46752],"length":1,"stats":{"Line":1}},{"line":236,"address":[351508,351540],"length":1,"stats":{"Line":1}},{"line":240,"address":[351568],"length":1,"stats":{"Line":1}},{"line":241,"address":[351605],"length":1,"stats":{"Line":1}},{"line":242,"address":[46879],"length":1,"stats":{"Line":1}},{"line":244,"address":[351653],"length":1,"stats":{"Line":1}},{"line":245,"address":[46923],"length":1,"stats":{"Line":1}},{"line":247,"address":[351695],"length":1,"stats":{"Line":1}},{"line":248,"address":[351712,351744],"length":1,"stats":{"Line":1}},{"line":251,"address":[47008],"length":1,"stats":{"Line":0}},{"line":252,"address":[351797],"length":1,"stats":{"Line":0}},{"line":253,"address":[47071],"length":1,"stats":{"Line":0}},{"line":255,"address":[351845],"length":1,"stats":{"Line":0}},{"line":256,"address":[351868],"length":1,"stats":{"Line":0}},{"line":258,"address":[351887],"length":1,"stats":{"Line":0}},{"line":259,"address":[351904,351936],"length":1,"stats":{"Line":0}},{"line":262,"address":[351952],"length":1,"stats":{"Line":0}},{"line":263,"address":[47237],"length":1,"stats":{"Line":0}},{"line":264,"address":[352016],"length":1,"stats":{"Line":0}},{"line":266,"address":[352037],"length":1,"stats":{"Line":0}},{"line":267,"address":[352060],"length":1,"stats":{"Line":0}},{"line":269,"address":[47325],"length":1,"stats":{"Line":0}},{"line":270,"address":[47374,47342],"length":1,"stats":{"Line":0}},{"line":273,"address":[352144],"length":1,"stats":{"Line":1}},{"line":274,"address":[47429],"length":1,"stats":{"Line":1}},{"line":275,"address":[352208],"length":1,"stats":{"Line":1}},{"line":277,"address":[47476],"length":1,"stats":{"Line":1}},{"line":278,"address":[352260],"length":1,"stats":{"Line":1}},{"line":280,"address":[352310,352278],"length":1,"stats":{"Line":1}},{"line":283,"address":[352336],"length":1,"stats":{"Line":0}},{"line":284,"address":[47621],"length":1,"stats":{"Line":0}},{"line":285,"address":[352400],"length":1,"stats":{"Line":0}},{"line":287,"address":[352421],"length":1,"stats":{"Line":0}},{"line":288,"address":[47699],"length":1,"stats":{"Line":0}},{"line":290,"address":[352502,352470],"length":1,"stats":{"Line":0}},{"line":293,"address":[352528],"length":1,"stats":{"Line":0}},{"line":294,"address":[47813],"length":1,"stats":{"Line":0}},{"line":295,"address":[47839],"length":1,"stats":{"Line":0}},{"line":297,"address":[352613],"length":1,"stats":{"Line":0}},{"line":298,"address":[47891],"length":1,"stats":{"Line":0}},{"line":300,"address":[352662,352694],"length":1,"stats":{"Line":0}},{"line":303,"address":[352720],"length":1,"stats":{"Line":1}},{"line":304,"address":[47987],"length":1,"stats":{"Line":1}},{"line":306,"address":[352757],"length":1,"stats":{"Line":2}},{"line":307,"address":[352799,353011],"length":1,"stats":{"Line":1}},{"line":310,"address":[48126],"length":1,"stats":{"Line":2}},{"line":311,"address":[352920],"length":1,"stats":{"Line":2}},{"line":312,"address":[352924],"length":1,"stats":{"Line":1}},{"line":315,"address":[352962],"length":1,"stats":{"Line":1}},{"line":317,"address":[48188],"length":1,"stats":{"Line":2}},{"line":320,"address":[352991],"length":1,"stats":{"Line":2}},{"line":321,"address":[353033,352994,353041],"length":1,"stats":{"Line":3}},{"line":325,"address":[48304],"length":1,"stats":{"Line":2}},{"line":326,"address":[353075],"length":1,"stats":{"Line":1}},{"line":328,"address":[48341],"length":1,"stats":{"Line":2}},{"line":330,"address":[353124],"length":1,"stats":{"Line":1}},{"line":331,"address":[353159],"length":1,"stats":{"Line":1}},{"line":333,"address":[353172,353204],"length":1,"stats":{"Line":1}},{"line":336,"address":[353232],"length":1,"stats":{"Line":1}},{"line":337,"address":[353251],"length":1,"stats":{"Line":1}},{"line":339,"address":[48501],"length":1,"stats":{"Line":1}},{"line":340,"address":[48744,48542],"length":1,"stats":{"Line":1}},{"line":342,"address":[353391],"length":1,"stats":{"Line":1}},{"line":343,"address":[353432],"length":1,"stats":{"Line":1}},{"line":344,"address":[353436],"length":1,"stats":{"Line":1}},{"line":345,"address":[353472],"length":1,"stats":{"Line":1}},{"line":347,"address":[353457],"length":1,"stats":{"Line":1}},{"line":350,"address":[48724],"length":1,"stats":{"Line":1}},{"line":351,"address":[353543,353551,353504],"length":1,"stats":{"Line":2}},{"line":355,"address":[353568],"length":1,"stats":{"Line":1}},{"line":356,"address":[353587],"length":1,"stats":{"Line":1}},{"line":357,"address":[353605],"length":1,"stats":{"Line":1}},{"line":358,"address":[353622,353654],"length":1,"stats":{"Line":1}},{"line":362,"address":[48912],"length":1,"stats":{"Line":1}},{"line":363,"address":[353699],"length":1,"stats":{"Line":1}},{"line":364,"address":[353717],"length":1,"stats":{"Line":1}},{"line":365,"address":[353734,353766],"length":1,"stats":{"Line":1}},{"line":369,"address":[353792],"length":1,"stats":{"Line":1}},{"line":370,"address":[353811],"length":1,"stats":{"Line":1}},{"line":371,"address":[353829],"length":1,"stats":{"Line":1}},{"line":372,"address":[353846,353878],"length":1,"stats":{"Line":1}}],"covered":161,"coverable":204},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","dsp.rs"],"content":"use crate::memory::Memory;\n\n/// Voice of the SNES APU DSP\n#[derive(Debug, Clone, Copy)]\npub struct Voice {\n    pub left_vol: u8,\n    pub right_vol: u8,\n    pub pitch: u16,\n    pub key_on: bool,\n    pub sample_start: u16,\n    pub sample_end: u16,\n    pub current_addr: u16,\n    pub frac: u16,          // fractional accumulator for pitch stepping\n    pub current_sample: i8, // last fetched sample\n}\n\nimpl Default for Voice {\n    fn default() -\u003e Self {\n        Self {\n            left_vol: 0,\n            right_vol: 0,\n            pitch: 0,\n            key_on: false,\n            sample_start: 0,\n            sample_end: 0,\n            current_addr: 0,\n            frac: 0,\n            current_sample: 0,\n        }\n    }\n}\n\npub struct Dsp {\n    registers: [u8; 128], // $F200-$F27F\n    pub voices: [Voice; 8],\n}\n\nimpl Dsp {\n    pub fn new() -\u003e Self {\n        Self {\n            registers: [0; 128],\n            voices: [Voice::default(); 8],\n        }\n    }\n\n    /// Read DSP register (memory-mapped)\n    pub fn read(\u0026self, addr: u16) -\u003e u8 {\n        let index = (addr - 0xF200) as usize;\n        self.registers[index]\n    }\n\n    /// Write DSP register (memory-mapped)\n    pub fn write(\u0026mut self, addr: u16, value: u8) {\n        // Make sure addr is in the valid DSP register range\n        if addr \u003c 0xF200 || (addr as usize) \u003e= 0xF200 + self.registers.len() {\n            // return could be used instead of panicking if more verif is added\n            panic!(\"Invalid DSP write address: {:#X}\", addr);\n        }\n    \n        let index = (addr - 0xF200) as usize;\n        self.registers[index] = value;\n    \n        match index {\n            // 0x00..=0x07: Left volume for each voice\n            // Registers 0x00..0x07 directly map to the `left_vol` field of each voice.\n            0x00..=0x07 =\u003e self.voices[index].left_vol = value,\n    \n            // 0x08..=0x0F: Right volume for each voice\n            // Same idea as left volume, but offset by 8.\n            0x08..=0x0F =\u003e self.voices[index - 0x08].right_vol = value,\n    \n            // 0x10..=0x17: Pitch low byte\n            // Sets the low 8 bits of the pitch value.\n            // The high 8 bits are updated separately at 0x18..=0x1F.\n            0x10..=0x17 =\u003e {\n                let voice_idx = index - 0x10;\n                let pitch = (self.voices[voice_idx].pitch \u0026 0xFF00) | value as u16;\n                self.voices[voice_idx].pitch = pitch;\n            }\n    \n            // 0x18..=0x1F: Pitch high byte\n            // Sets the high 8 bits of the pitch value.\n            0x18..=0x1F =\u003e {\n                let voice_idx = index - 0x18;\n                let pitch = ((value as u16) \u003c\u003c 8) | (self.voices[voice_idx].pitch \u0026 0x00FF);\n                self.voices[voice_idx].pitch = pitch;\n            }\n    \n            // 0x20..=0x27: Key On\n            // Writing a nonzero value starts playback for the corresponding voice.\n            // This also resets the current address to `sample_start`\n            // and clears the fractional accumulator.\n            // Writing zero turns the voice off.\n            0x20..=0x27 =\u003e {\n                let voice_idx = index - 0x20;\n                self.voices[voice_idx].key_on = value != 0;\n                if value != 0 {\n                    self.voices[voice_idx].current_addr = self.voices[voice_idx].sample_start;\n                    self.voices[voice_idx].frac = 0;\n                }\n            }\n    \n            // 0x30..=0x37: Sample Start (low byte)\n            // Sets the low 8 bits of the sample start address.\n            0x30..=0x37 =\u003e {\n                let voice_idx = index - 0x30;\n                self.voices[voice_idx].sample_start =\n                    (self.voices[voice_idx].sample_start \u0026 0xFF00) | value as u16;\n            }\n    \n            // 0x38..=0x3F: Sample End (low byte)\n            // Sets the low 8 bits of the sample end address.\n            0x38..=0x3F =\u003e {\n                let voice_idx = index - 0x38;\n                self.voices[voice_idx].sample_end =\n                    (self.voices[voice_idx].sample_end \u0026 0xFF00) | value as u16;\n            }\n    \n            _ =\u003e {} // Other registers (echo, ADSR, etc.) not implemented yet\n        }    \n    }    \n\n    /// Step DSP one tick (process voices)\n    pub fn step(\u0026mut self, mem: \u0026Memory) {\n        for voice in self.voices.iter_mut() {\n            if !voice.key_on {\n                continue;\n            }\n    \n            // Advance fractional accumulator\n            voice.frac = voice.frac.wrapping_add(voice.pitch);\n            let step = voice.frac \u003e\u003e 8; // integer increment\n            voice.frac \u0026= 0xFF;         // keep fractional\n    \n            // Advance current address\n            voice.current_addr = voice.current_addr.wrapping_add(step);\n    \n            // Stop if we reach the end of the sample\n            if voice.current_addr \u003e= voice.sample_end {\n                voice.key_on = false;\n            } else {\n                // Fetch sample from memory after stepping\n                voice.current_sample = mem.read8(voice.current_addr) as i8;\n            }\n        }\n    }    \n\n    /// Mix all voices into a stereo output buffer\n    pub fn render_audio(\u0026self, num_samples: usize) -\u003e Vec\u003c(i16, i16)\u003e {\n        let mut buffer = vec![(0i16, 0i16); num_samples];\n\n        for voice in \u0026self.voices {\n            if voice.key_on {\n                let left_vol = voice.left_vol as i32;\n                let right_vol = voice.right_vol as i32;\n                let sample_val = voice.current_sample as i32;\n\n                for sample in \u0026mut buffer {\n                    sample.0 = (sample.0 as i32 + sample_val * left_vol)\n                        .clamp(i16::MIN as i32, i16::MAX as i32) as i16;\n                    sample.1 = (sample.1 as i32 + sample_val * right_vol)\n                        .clamp(i16::MIN as i32, i16::MAX as i32) as i16;\n                }\n            }\n        }\n        buffer\n    }\n}\n","traces":[{"line":18,"address":[344192],"length":1,"stats":{"Line":24}},{"line":39,"address":[344256],"length":1,"stats":{"Line":4}},{"line":41,"address":[343585],"length":1,"stats":{"Line":19}},{"line":42,"address":[339266],"length":1,"stats":{"Line":4}},{"line":47,"address":[344464],"length":1,"stats":{"Line":1}},{"line":48,"address":[339509,339462],"length":1,"stats":{"Line":1}},{"line":49,"address":[38908,38922,38875],"length":1,"stats":{"Line":2}},{"line":53,"address":[344592],"length":1,"stats":{"Line":1}},{"line":55,"address":[339609,339783],"length":1,"stats":{"Line":6}},{"line":57,"address":[344679],"length":1,"stats":{"Line":0}},{"line":60,"address":[339807,339862],"length":1,"stats":{"Line":1}},{"line":61,"address":[339907,339852,339889],"length":1,"stats":{"Line":4}},{"line":66,"address":[344229,344283,345704],"length":1,"stats":{"Line":5}},{"line":70,"address":[346305,344954,345019],"length":1,"stats":{"Line":4}},{"line":75,"address":[339978,340055],"length":1,"stats":{"Line":3}},{"line":76,"address":[341131,340066,341115],"length":1,"stats":{"Line":2}},{"line":77,"address":[346182,346229,346147],"length":1,"stats":{"Line":2}},{"line":78,"address":[341238,341192,341258],"length":1,"stats":{"Line":2}},{"line":83,"address":[340115,340038],"length":1,"stats":{"Line":2}},{"line":84,"address":[345963,345991,345150],"length":1,"stats":{"Line":2}},{"line":85,"address":[346019,345971,346063],"length":1,"stats":{"Line":2}},{"line":86,"address":[341026,341092,341072],"length":1,"stats":{"Line":2}},{"line":94,"address":[344434,344511],"length":1,"stats":{"Line":2}},{"line":95,"address":[340186,340676,340660],"length":1,"stats":{"Line":2}},{"line":96,"address":[340736,340668,340703],"length":1,"stats":{"Line":3}},{"line":97,"address":[340902,340721],"length":1,"stats":{"Line":2}},{"line":98,"address":[340759,340861],"length":1,"stats":{"Line":2}},{"line":99,"address":[345872,345913,345936],"length":1,"stats":{"Line":2}},{"line":105,"address":[344571,344494],"length":1,"stats":{"Line":2}},{"line":106,"address":[340490,340506,340246],"length":1,"stats":{"Line":2}},{"line":107,"address":[39988,39937,40012],"length":1,"stats":{"Line":2}},{"line":108,"address":[340533,340498,340575],"length":1,"stats":{"Line":2}},{"line":113,"address":[39593,39661],"length":1,"stats":{"Line":2}},{"line":114,"address":[344672,344633],"length":1,"stats":{"Line":1}},{"line":115,"address":[344803,344779,344728],"length":1,"stats":{"Line":2}},{"line":116,"address":[345429,345352,345387],"length":1,"stats":{"Line":2}},{"line":124,"address":[341408],"length":1,"stats":{"Line":1}},{"line":125,"address":[346451,346484],"length":1,"stats":{"Line":2}},{"line":126,"address":[341518],"length":1,"stats":{"Line":1}},{"line":131,"address":[40908],"length":1,"stats":{"Line":1}},{"line":132,"address":[40931],"length":1,"stats":{"Line":1}},{"line":133,"address":[40944],"length":1,"stats":{"Line":1}},{"line":136,"address":[341584],"length":1,"stats":{"Line":1}},{"line":139,"address":[341604,341642,341655],"length":1,"stats":{"Line":4}},{"line":140,"address":[41023],"length":1,"stats":{"Line":1}},{"line":143,"address":[345959],"length":1,"stats":{"Line":1}},{"line":149,"address":[41801,41795,41040],"length":1,"stats":{"Line":2}},{"line":150,"address":[346041],"length":1,"stats":{"Line":2}},{"line":152,"address":[346849,346762],"length":1,"stats":{"Line":4}},{"line":153,"address":[346266],"length":1,"stats":{"Line":2}},{"line":154,"address":[341996],"length":1,"stats":{"Line":2}},{"line":155,"address":[41371],"length":1,"stats":{"Line":2}},{"line":156,"address":[41386],"length":1,"stats":{"Line":2}},{"line":158,"address":[347470,347065],"length":1,"stats":{"Line":3}},{"line":159,"address":[342197,342286,342321],"length":1,"stats":{"Line":3}},{"line":160,"address":[346597],"length":1,"stats":{"Line":2}},{"line":161,"address":[342442,342324,342412],"length":1,"stats":{"Line":2}},{"line":162,"address":[347411],"length":1,"stats":{"Line":1}},{"line":166,"address":[346972],"length":1,"stats":{"Line":1}}],"covered":58,"coverable":59},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","lib.rs"],"content":"pub mod cpu;\npub mod dsp;\npub mod memory;\npub mod timers;\npub mod apu;\n\npub use apu::Apu;\npub use cpu::Spc700;\npub use memory::Memory;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","memory.rs"],"content":"use crate::dsp::Dsp;\n\npub struct Memory {\n    pub ram: [u8; 64 * 1024], // 64KB APU RAM\n    pub dsp: Dsp,             // DSP registers\n}\n\nimpl Memory {\n    pub fn new() -\u003e Self {\n        Self {\n            ram: [0; 64 * 1024],\n            dsp: Dsp::new(),\n        }\n    }\n\n    pub fn read8(\u0026self, addr: u16) -\u003e u8 {\n        // DSP memory-mapped registers\n        if (0xF200..=0xF27F).contains(\u0026addr) {\n            self.dsp.read(addr)\n        } else {\n            self.ram[addr as usize]\n        }\n    }\n\n    pub fn read16(\u0026self, addr: u16) -\u003e u16 {\n        let lo = self.read8(addr) as u16;\n        let hi = self.read8(addr.wrapping_add(1)) as u16;\n        (hi \u003c\u003c 8) | lo\n    }\n\n    pub fn write8(\u0026mut self, addr: u16, val: u8) {\n        if (0xF200..=0xF27F).contains(\u0026addr) {\n            self.dsp.write(addr, val);\n        } else {\n            self.ram[addr as usize] = val;\n        }\n    }\n\n    pub fn write16(\u0026mut self, addr: u16, value: u16) {\n        let lo = (value \u0026 0xFF) as u8;\n        let hi = (value \u003e\u003e 8) as u8;\n        self.write8(addr, lo);\n        self.write8(addr.wrapping_add(1), hi);\n    }\n}\n","traces":[{"line":9,"address":[343504],"length":1,"stats":{"Line":3}},{"line":11,"address":[343551],"length":1,"stats":{"Line":18}},{"line":12,"address":[343568],"length":1,"stats":{"Line":4}},{"line":16,"address":[343648],"length":1,"stats":{"Line":6}},{"line":18,"address":[343670,343755],"length":1,"stats":{"Line":17}},{"line":19,"address":[55076],"length":1,"stats":{"Line":0}},{"line":21,"address":[342624,342642,342572],"length":1,"stats":{"Line":19}},{"line":25,"address":[343792],"length":1,"stats":{"Line":0}},{"line":26,"address":[342699],"length":1,"stats":{"Line":0}},{"line":27,"address":[55207],"length":1,"stats":{"Line":0}},{"line":28,"address":[55246],"length":1,"stats":{"Line":0}},{"line":31,"address":[342784],"length":1,"stats":{"Line":4}},{"line":32,"address":[343936,344022],"length":1,"stats":{"Line":26}},{"line":33,"address":[343986],"length":1,"stats":{"Line":0}},{"line":35,"address":[338572,338559,338502],"length":1,"stats":{"Line":18}},{"line":39,"address":[342944],"length":1,"stats":{"Line":2}},{"line":40,"address":[344096],"length":1,"stats":{"Line":1}},{"line":41,"address":[342987],"length":1,"stats":{"Line":1}},{"line":42,"address":[344119],"length":1,"stats":{"Line":1}},{"line":43,"address":[344136],"length":1,"stats":{"Line":2}}],"covered":14,"coverable":20},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","timers.rs"],"content":"use crate::memory::Memory;\n\npub struct Timers;\n\nimpl Timers {\n    pub fn new() -\u003e Self {\n        Self\n    }\n\n    pub fn step(\u0026mut self, _mem: \u0026mut Memory) {\n        // TODO: implement timer logic\n    }\n}\n","traces":[{"line":10,"address":[51840],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":1},{"path":["/","home","cbaziret","devel","eip","r-snes","common","src","lib.rs"],"content":"pub mod snes_address;\npub mod u16_split;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","common","src","snes_address.rs"],"content":"use std::convert::From;\n\n/// Common struct used to represent memory addresses in the global\n/// SNES adddress space.\n///\n/// The address space is split in 256 64Ko banks.\n#[derive(Debug, Copy, Clone, Eq, PartialEq, Default)]\npub struct SnesAddress {\n    /// The bank number of the address\n    pub bank: u8,\n\n    /// The memory address within the bank\n    pub addr: u16,\n}\n\nimpl From\u003cSnesAddress\u003e for usize {\n    fn from(addr: SnesAddress) -\u003e usize {\n        ((addr.bank as usize) \u003c\u003c 16) | (addr.addr as usize)\n    }\n}\n\nimpl From\u003cusize\u003e for SnesAddress {\n    /// If value is larger than 24 bits, only the lowest 24 bits are used and\n    /// the excess bits are ignored.\n    fn from(value: usize) -\u003e SnesAddress {\n        SnesAddress {\n            bank: ((value \u003e\u003e 16) \u0026 0xFF) as u8,\n            addr: (value \u0026 0xFFFF) as u16,\n        }\n    }\n}\n\nimpl SnesAddress {\n    /// Increment the memory address stored in [`self`]\n    ///\n    /// Returns whether the increment caused a bank change.\n    pub fn increment(\u0026mut self) -\u003e bool {\n        self.addr = self.addr.wrapping_add(1);\n\n        if self.addr != 0 {\n            return false;\n        }\n        self.bank = self.bank.wrapping_add(1);\n        true\n    }\n\n    /// Decrement the memory address stored in [`self`]\n    ///\n    /// Returns whether the decrement caused a bank change.\n    pub fn decrement(\u0026mut self) -\u003e bool {\n        self.addr = self.addr.wrapping_sub(1);\n\n        if self.addr != u16::MAX {\n            return false;\n        }\n        self.bank = self.bank.wrapping_sub(1);\n        true\n    }\n}\n\n#[cfg(test)]\nmod test {\n    use std::u16;\n\n    use super::*;\n\n    #[test]\n    fn test_simple_increment() {\n        let mut addr = SnesAddress { bank: 0, addr: 1 };\n        assert!(!addr.increment());\n\n        assert_eq!(addr, SnesAddress { bank: 0, addr: 2 });\n    }\n\n    #[test]\n    fn test_simple_decrement() {\n        let mut addr = SnesAddress { bank: 0, addr: 1 };\n        assert!(!addr.decrement());\n\n        assert_eq!(addr, SnesAddress { bank: 0, addr: 0 });\n    }\n\n    #[test]\n    fn test_wrapping_increment() {\n        let mut addr = SnesAddress {\n            bank: 3,\n            addr: u16::MAX,\n        };\n        assert!(addr.increment());\n\n        assert_eq!(addr, SnesAddress { bank: 4, addr: 0 });\n    }\n\n    #[test]\n    fn test_wrapping_decrement() {\n        let mut addr = SnesAddress { bank: 3, addr: 0 };\n        assert!(addr.decrement());\n\n        assert_eq!(\n            addr,\n            SnesAddress {\n                bank: 2,\n                addr: u16::MAX\n            }\n        );\n    }\n\n    #[test]\n    fn test_to_usize() {\n        let addr: SnesAddress = SnesAddress {\n            bank: (0xE3),\n            addr: (0x3F49),\n        };\n        let expected: usize = 0xE33F49;\n\n        assert_eq!(usize::from(addr), expected);\n    }\n\n    #[test]\n    fn test_from_usize() {\n        let nb: usize = 0x124089;\n        let expected: SnesAddress = SnesAddress {\n            bank: (0x12),\n            addr: (0x4089),\n        };\n\n        assert_eq!(SnesAddress::from(nb), expected);\n    }\n\n    #[test]\n    fn test_from_usize_too_big() {\n        let nb: usize = 0x12408993245;\n        let expected: SnesAddress = SnesAddress {\n            bank: (0x99),\n            addr: (0x3245),\n        };\n\n        assert_eq!(SnesAddress::from(nb), expected);\n    }\n\n    #[test]\n    fn test_from_usize_too_small() {\n        let nb: usize = 0x124;\n        let expected: SnesAddress = SnesAddress {\n            bank: (0x00),\n            addr: (0x0124),\n        };\n\n        assert_eq!(SnesAddress::from(nb), expected);\n    }\n}\n","traces":[{"line":17,"address":[37744],"length":1,"stats":{"Line":1}},{"line":18,"address":[37759],"length":1,"stats":{"Line":1}},{"line":25,"address":[37776],"length":1,"stats":{"Line":3}},{"line":27,"address":[37781],"length":1,"stats":{"Line":3}},{"line":28,"address":[37788],"length":1,"stats":{"Line":3}},{"line":37,"address":[37792],"length":1,"stats":{"Line":2}},{"line":38,"address":[37805],"length":1,"stats":{"Line":2}},{"line":40,"address":[37825],"length":1,"stats":{"Line":2}},{"line":41,"address":[37865],"length":1,"stats":{"Line":1}},{"line":43,"address":[37835],"length":1,"stats":{"Line":1}},{"line":44,"address":[37858],"length":1,"stats":{"Line":1}},{"line":50,"address":[37888],"length":1,"stats":{"Line":2}},{"line":51,"address":[37901],"length":1,"stats":{"Line":2}},{"line":53,"address":[37921],"length":1,"stats":{"Line":2}},{"line":54,"address":[37961],"length":1,"stats":{"Line":1}},{"line":56,"address":[37931],"length":1,"stats":{"Line":1}},{"line":57,"address":[37954],"length":1,"stats":{"Line":1}}],"covered":17,"coverable":17},{"path":["/","home","cbaziret","devel","eip","r-snes","common","src","u16_split.rs"],"content":"/// Extension trait for [`u16`] which defines additional methods\n/// allowing to \"split\" references (mutable or not) to a [`u16`] into\n/// two separate references to its individual bytes (as [`u8`]s)\npub trait U16Split {\n    /// Split an immutable reference to a [`u16`] into two\n    /// immutable references to its bytes (as [`u8`]s)\n    fn split\u003c'a\u003e(\u0026'a self) -\u003e SplitU16\u003c'a\u003e;\n    /// Split a mutable reference to a [`u16`] into two\n    /// mutable references to its bytes (as [`u8`]s)\n    fn split_mut\u003c'a\u003e(\u0026'a mut self) -\u003e SplitU16Mut\u003c'a\u003e;\n\n    /// Get an immutable reference to the least significant byte of a [`u16`]\n    fn lo\u003c'a\u003e(\u0026'a self) -\u003e \u0026'a u8 {\n        self.split().lo\n    }\n    /// Get an immutable reference to the most significant byte of a [`u16`]\n    fn hi\u003c'a\u003e(\u0026'a self) -\u003e \u0026'a u8 {\n        self.split().hi\n    }\n\n    /// Get an mutable reference to the least significant byte of a [`u16`]\n    fn lo_mut\u003c'a\u003e(\u0026'a mut self) -\u003e \u0026'a mut u8 {\n        self.split_mut().lo\n    }\n    /// Get an mutable reference to the most significant byte of a [`u16`]\n    fn hi_mut\u003c'a\u003e(\u0026'a mut self) -\u003e \u0026'a mut u8 {\n        self.split_mut().hi\n    }\n}\n\n/// Helper struct which contains two immutable references\n/// to the individual bytes of a [`u16`]\npub struct SplitU16\u003c'a\u003e {\n    /// Ref to the least signicant byte\n    pub lo: \u0026'a u8,\n    /// Ref to the most significant byte\n    pub hi: \u0026'a u8,\n}\n\n/// Helper struct which contains two immutable references\n/// to the individual bytes of a [`u16`]\npub struct SplitU16Mut\u003c'a\u003e {\n    /// Mut ref to the least significant byte\n    pub lo: \u0026'a mut u8,\n    /// Mut ref to the most significant byte\n    pub hi: \u0026'a mut u8,\n}\n\nimpl U16Split for u16 {\n    fn split\u003c'a\u003e(\u0026'a self) -\u003e SplitU16\u003c'a\u003e {\n        let first_byte_ptr = self as *const u16 as *const u8;\n        let second_byte_ptr = unsafe { first_byte_ptr.add(1) };\n        let (lo, hi) = if cfg!(target_endian = \"little\") {\n            unsafe { (\u0026*first_byte_ptr, \u0026*second_byte_ptr) }\n        } else {\n            unsafe { (\u0026*second_byte_ptr, \u0026*first_byte_ptr) }\n        };\n        SplitU16 { lo, hi }\n    }\n\n    fn split_mut\u003c'a\u003e(\u0026'a mut self) -\u003e SplitU16Mut\u003c'a\u003e {\n        let first_byte_ptr = self as *mut u16 as *mut u8;\n        let second_byte_ptr = unsafe { first_byte_ptr.add(1) };\n        let (lo, hi) = if cfg!(target_endian = \"little\") {\n            unsafe { (\u0026mut *first_byte_ptr, \u0026mut *second_byte_ptr) }\n        } else {\n            unsafe { (\u0026mut *second_byte_ptr, \u0026mut *first_byte_ptr) }\n        };\n        SplitU16Mut { lo, hi }\n    }\n}\n\n#[cfg(test)]\nmod test {\n    use super::*;\n\n    #[test]\n    fn test_split_u16() {\n        let my_u16: u16 = 0x1234;\n\n        let byte_refs = my_u16.split();\n\n        assert_eq!(*byte_refs.hi, 0x12);\n        assert_eq!(*byte_refs.lo, 0x34);\n\n        assert_eq!(my_u16, 0x1234);\n    }\n\n    #[test]\n    fn get_individual_bytes() {\n        let my_u16: u16 = 0xbeef;\n\n        assert_eq!(*my_u16.hi(), 0xbe);\n        assert_eq!(*my_u16.lo(), 0xef);\n    }\n\n    #[test]\n    fn test_split_u16_mut() {\n        let mut my_u16: u16 = 0x1234;\n\n        let byte_refs = my_u16.split_mut();\n\n        assert_eq!(*byte_refs.hi, 0x12);\n        assert_eq!(*byte_refs.lo, 0x34);\n\n        *byte_refs.lo = 0xee;\n\n        // drop(byte_refs) // byte_refs is implicitly dropped as we start\n        //                    reading from my_u16 again\n        assert_eq!(my_u16, 0x12ee);\n\n        // we can also assign directly from the method call\n        *my_u16.hi_mut() = 0xaa;\n        assert_eq!(my_u16, 0xaaee);\n\n        *my_u16.lo_mut() = 0x42;\n        assert_eq!(my_u16, 0xaa42);\n    }\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":1}},{"line":14,"address":[],"length":0,"stats":{"Line":1}},{"line":17,"address":[],"length":0,"stats":{"Line":1}},{"line":18,"address":[],"length":0,"stats":{"Line":1}},{"line":22,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":1}},{"line":26,"address":[],"length":0,"stats":{"Line":1}},{"line":27,"address":[],"length":0,"stats":{"Line":1}},{"line":50,"address":[],"length":0,"stats":{"Line":1}},{"line":51,"address":[],"length":0,"stats":{"Line":1}},{"line":52,"address":[],"length":0,"stats":{"Line":2}},{"line":54,"address":[],"length":0,"stats":{"Line":2}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":1}},{"line":62,"address":[],"length":0,"stats":{"Line":1}},{"line":63,"address":[],"length":0,"stats":{"Line":1}},{"line":65,"address":[],"length":0,"stats":{"Line":1}},{"line":67,"address":[],"length":0,"stats":{"Line":0}}],"covered":16,"coverable":18},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","instr_metalang_procmacro","src","lib.rs"],"content":"mod parser;\n\nuse parser::{Cycle, Instr};\nuse proc_macro2::TokenStream;\nuse quote::{format_ident, quote};\n\n/// Function that actually implements all the logic for the proc macro,\n/// using the types provided by the `proc_macro2` crate, which have the\n/// advantage of also existing outside of proc macro crates; and therefore\n/// have more utilities built around them, which makes unit-testing easier,\n/// among many other things.\npub(crate) fn cpu_instr2(input: TokenStream) -\u003e TokenStream {\n    let Instr { name, cycles } = match parser::Instr::try_from(input) {\n        Ok(instr) =\u003e instr,\n        Err(msg) =\u003e panic!(\"{}\", msg),\n    };\n\n    let cycle_funcs = cycles\n        .iter()\n        .enumerate()\n        .map(|(i, Cycle { body, cyc_type })| {\n            let func_name = format_ident!(\"{}_cyc{}\", name, i + 1);\n            let next_func_name = if i != cycles.len() - 1 {\n                format_ident!(\"{}_cyc{}\", name, i + 2)\n            } else {\n                format_ident!(\"opcode_fetch\")\n            };\n\n            quote! {\n                pub(crate) fn #func_name(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    #body\n\n                    (CycleResult::#cyc_type, InstrCycle(#next_func_name))\n                }\n            }\n        });\n\n    TokenStream::from_iter(cycle_funcs)\n}\n\n/// The main proc macro of this crate.\n///\n/// Syntax:\n/// ```rs\n/// cpu_instr!(instr_name {\n///     instruction_body();\n/// });\n/// ```\n///\n/// This macro can be called at the top level (not necessarily within a\n/// function body) since it will only produce function definitions.\n///\n/// The instruction name (`instr_name` in the above example) will be used\n/// as the base for the function name(s) that will be generated, in the\n/// following format: `(\"{}_cyc{}\", instr_name, cycnum)`, where `cycnum`\n/// is the cycle number starting at 1.\n///\n/// The instruction body comes in curly braces after the instruction name.\n/// The body accepts special syntax (*meta instructions*) as well as\n/// function-body Rust code.  \n/// Meta-instructions are a statement starting by a `meta` identifier,\n/// followed by a meta-instruction name (usually in all uppercase),\n/// followed by operands and then a semicolon.\n///\n/// The two basic meta-instructions are `END_CYCLE` and `END_INSTR`,\n/// which both an cycle type as parameter, and act as cycle delimiters;\n/// resulting in a separate function for each cycle.\n///\n/// For a reference of the available meta-instructions\n/// and their behaviour, see the (not yet done because the language is still\n/// very much subject to change) meta language reference in the module\n/// documentation.\n#[proc_macro]\npub fn cpu_instr(input: proc_macro::TokenStream) -\u003e proc_macro::TokenStream {\n    cpu_instr2(input.into()).into()\n}\n\n#[cfg(test)]\nmod test {\n    use super::*;\n\n    fn assert_tokstream_eq(actual: TokenStream, expected: TokenStream) {\n        let Ok(actual) = syn::parse2::\u003csyn::File\u003e(actual) else {\n            panic!(\"assert_tokstream_eq: actual doesn't parse\");\n        };\n        let Ok(expected) = syn::parse2::\u003csyn::File\u003e(expected) else {\n            panic!(\"assert_tokstream_eq: expected doesn't parse\");\n        };\n\n        assert_eq!(\n            actual,\n            expected,\n            \"\\n=====\\nActual:\\n{}\\n=====\\nExpected:\\n{}\\n\",\n            prettyplease::unparse(\u0026actual),\n            prettyplease::unparse(\u0026expected)\n        )\n    }\n\n    fn assert_macro_produces(macro_input: TokenStream, exp_output: TokenStream) {\n        assert_tokstream_eq(cpu_instr2(macro_input), exp_output)\n    }\n\n    #[test]\n    fn test_inx() {\n        assert_macro_produces(\n            quote!(instr_inx {\n                cpu.registers.X = cpu.registers.X.wrapping_add(1);\n                cpu.registers.P.Z = cpu.registers.X == 0;\n                cpu.registers.P.N = cpu.registers.X \u003e 0x7fff;\n\n                meta END_INSTR Internal;\n            }),\n            quote!(\n                pub(crate) fn instr_inx_cyc1(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    cpu.registers.X = cpu.registers.X.wrapping_add(1);\n                    cpu.registers.P.Z = cpu.registers.X == 0;\n                    cpu.registers.P.N = cpu.registers.X \u003e 0x7fff;\n\n                    (CycleResult::Internal, InstrCycle(opcode_fetch))\n                }\n            ),\n        );\n    }\n\n    #[test]\n    fn test_some_instr() {\n        assert_macro_produces(\n            quote!(some_instr {\n                some_function1(cpu);\n                meta END_CYCLE Internal;\n\n                some_function2(cpu);\n                meta END_CYCLE Read;\n\n                some_function3(cpu);\n                meta END_INSTR Write;\n            }),\n            quote!(\n                pub(crate) fn some_instr_cyc1(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    some_function1(cpu);\n\n                    (CycleResult::Internal, InstrCycle(some_instr_cyc2))\n                }\n                pub(crate) fn some_instr_cyc2(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    some_function2(cpu);\n\n                    (CycleResult::Read, InstrCycle(some_instr_cyc3))\n                }\n                pub(crate) fn some_instr_cyc3(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    some_function3(cpu);\n\n                    (CycleResult::Write, InstrCycle(opcode_fetch))\n                }\n            ),\n        );\n    }\n}\n","traces":[{"line":12,"address":[19872,20315],"length":1,"stats":{"Line":2}},{"line":13,"address":[19889,20027],"length":1,"stats":{"Line":3}},{"line":14,"address":[19982],"length":1,"stats":{"Line":1}},{"line":15,"address":[19933],"length":1,"stats":{"Line":0}},{"line":18,"address":[20084],"length":1,"stats":{"Line":1}},{"line":21,"address":[15312,15367,16491,18542],"length":1,"stats":{"Line":6}},{"line":22,"address":[15427],"length":1,"stats":{"Line":2}},{"line":23,"address":[16077,16142],"length":1,"stats":{"Line":4}},{"line":24,"address":[16242,16502],"length":1,"stats":{"Line":2}},{"line":26,"address":[16200,16292],"length":1,"stats":{"Line":2}},{"line":29,"address":[17075,16469],"length":1,"stats":{"Line":4}},{"line":38,"address":[20234],"length":1,"stats":{"Line":2}},{"line":74,"address":[20336],"length":1,"stats":{"Line":0}},{"line":75,"address":[20346],"length":1,"stats":{"Line":0}}],"covered":11,"coverable":14},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","instr_metalang_procmacro","src","parser.rs"],"content":"use pm2::{Ident, TokenStream, TokenTree};\nuse proc_macro2 as pm2;\n\n/// Enum for all the meta instructions implemented for the CPU\n/// meta-language.\npub(crate) enum MetaInstruction {\n    EndCycle(Ident),\n    EndInstr(Ident),\n}\n\nimpl MetaInstruction {\n    /// Method which checks if this instr is a `EndInstr`\n    fn is_end_instr(\u0026self) -\u003e bool {\n        match self {\n            Self::EndInstr(_) =\u003e true,\n            _ =\u003e false,\n        }\n    }\n}\n\nimpl MetaInstruction {\n    /// Conversion from a Token iterator\n    ///\n    /// For some reason can't be implemented as a TryFrom trait\n    fn try_from\u003cI: IntoIterator\u003cItem = TokenTree\u003e\u003e(value: I) -\u003e Result\u003cSelf, \u0026'static str\u003e {\n        let mut it = value.into_iter();\n\n        let Some(TokenTree::Ident(meta_kw)) = it.next() else {\n            Err(\"Expecting a meta-keyword\")?\n        };\n        let ret = match meta_kw.to_string().as_str() {\n            \"END_CYCLE\" =\u003e {\n                let Some(TokenTree::Ident(cyc_type)) = it.next() else {\n                    Err(\"END_CYCLE expects an identifier operand (cycle type)\")?\n                };\n                MetaInstruction::EndCycle(cyc_type)\n            }\n\n            \"END_INSTR\" =\u003e {\n                let Some(TokenTree::Ident(cyc_type)) = it.next() else {\n                    Err(\"INSTR expects an identifier operand (cycle type)\")?\n                };\n                MetaInstruction::EndInstr(cyc_type)\n            }\n\n            _ =\u003e Err(\"Unknown meta-keyword\")?,\n        };\n        if it.next().is_some() {\n            Err(\"Unexpected token after end of meta-instruction\")?\n        }\n        Ok(ret)\n    }\n}\n\n/// Type resulting from the parsing of the token stream passed\n/// as parameter to the [`cpu_instr`] proc macro.\npub(crate) struct Instr {\n    pub name: Ident,\n    pub cycles: Vec\u003cCycle\u003e,\n}\n\nimpl Instr {\n    fn new(name: Ident) -\u003e Self {\n        Self {\n            name,\n            cycles: vec![],\n        }\n    }\n}\n\nimpl TryFrom\u003cTokenStream\u003e for Instr {\n    fn try_from(stream: TokenStream) -\u003e Result\u003cSelf, Self::Error\u003e {\n        let mut it = stream.into_iter();\n        let Some(TokenTree::Ident(name)) = it.next() else {\n            Err(\"Expecting the instruction name\")?\n        };\n        let Some(TokenTree::Group(body)) = it.next() else {\n            Err(\"Expecting the instruction body\")?\n        };\n        if it.next().is_some() {\n            Err(\"Unexpected token after the instruction body\")?\n        }\n\n        let mut it = body.stream().into_iter().peekable();\n        let mut ret = Instr::new(name);\n        loop {\n            let it = it.by_ref();\n            let cycle_body = it.take_while(|token| token.to_string() != \"meta\");\n            let body_tok_stream = TokenStream::from_iter(cycle_body);\n            let meta_instr = MetaInstruction::try_from(it.take_while(|token| {\n                let TokenTree::Punct(p) = token else {\n                    return true;\n                };\n                return p.as_char() != ';';\n            }))?;\n\n            if it.peek().is_none() \u0026\u0026 !meta_instr.is_end_instr() {\n                Err(\"Instructions must end by an END_INSTR meta instruction\")?\n            }\n\n            match meta_instr {\n                MetaInstruction::EndCycle(c) =\u003e ret.cycles.push(Cycle::new(body_tok_stream, c)),\n                MetaInstruction::EndInstr(c) =\u003e ret.cycles.push(Cycle::new(body_tok_stream, c)),\n            }\n\n            if it.peek().is_none() {\n                break;\n            }\n        }\n        Ok(ret)\n    }\n    type Error = \u0026'static str;\n}\n\n/// Data structure which contains the info required to build\n/// a cycle function body\npub(crate) struct Cycle {\n    /// Raw function body\n    pub body: TokenStream,\n    /// Cycle type (part of the function return value; should evaluate\n    /// to something of type `CycleResult`)\n    pub cyc_type: Ident,\n}\n\nimpl Cycle {\n    fn new(body: TokenStream, cyc_type: Ident) -\u003e Self {\n        Self { body, cyc_type }\n    }\n}\n","traces":[{"line":13,"address":[30304],"length":1,"stats":{"Line":1}},{"line":14,"address":[30309],"length":1,"stats":{"Line":1}},{"line":25,"address":[],"length":0,"stats":{"Line":1}},{"line":26,"address":[],"length":0,"stats":{"Line":1}},{"line":28,"address":[],"length":0,"stats":{"Line":3}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":3}},{"line":32,"address":[],"length":0,"stats":{"Line":1}},{"line":33,"address":[],"length":0,"stats":{"Line":3}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":1}},{"line":39,"address":[],"length":0,"stats":{"Line":2}},{"line":40,"address":[],"length":0,"stats":{"Line":3}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":1}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":1}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":63,"address":[30461,30320],"length":1,"stats":{"Line":2}},{"line":66,"address":[30355],"length":1,"stats":{"Line":2}},{"line":72,"address":[30480,33551,33048],"length":1,"stats":{"Line":2}},{"line":73,"address":[30503],"length":1,"stats":{"Line":2}},{"line":74,"address":[30693,30568,30631],"length":1,"stats":{"Line":5}},{"line":75,"address":[33408],"length":1,"stats":{"Line":0}},{"line":77,"address":[30938,30876,30789],"length":1,"stats":{"Line":6}},{"line":78,"address":[33185],"length":1,"stats":{"Line":0}},{"line":80,"address":[31124,31026],"length":1,"stats":{"Line":3}},{"line":81,"address":[31260,33164],"length":1,"stats":{"Line":0}},{"line":84,"address":[31444,31230],"length":1,"stats":{"Line":3}},{"line":85,"address":[31498,31605],"length":1,"stats":{"Line":4}},{"line":86,"address":[32800],"length":1,"stats":{"Line":1}},{"line":87,"address":[31615,31669],"length":1,"stats":{"Line":3}},{"line":88,"address":[28016,28039],"length":1,"stats":{"Line":3}},{"line":89,"address":[31722],"length":1,"stats":{"Line":1}},{"line":90,"address":[28144],"length":1,"stats":{"Line":3}},{"line":91,"address":[28162],"length":1,"stats":{"Line":1}},{"line":92,"address":[28203],"length":1,"stats":{"Line":1}},{"line":94,"address":[28183],"length":1,"stats":{"Line":1}},{"line":97,"address":[32099,32171,32036],"length":1,"stats":{"Line":3}},{"line":98,"address":[32192],"length":1,"stats":{"Line":0}},{"line":101,"address":[32140],"length":1,"stats":{"Line":1}},{"line":102,"address":[32534],"length":1,"stats":{"Line":1}},{"line":103,"address":[32698,32420],"length":1,"stats":{"Line":2}},{"line":106,"address":[32682,32735],"length":1,"stats":{"Line":2}},{"line":110,"address":[32837],"length":1,"stats":{"Line":1}},{"line":126,"address":[33568],"length":1,"stats":{"Line":1}}],"covered":38,"coverable":47},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","cpu.rs"],"content":"use crate::{instr_tab::*, registers::Registers};\nuse common::snes_address::SnesAddress;\n\n/// Resumable main CPU of the SNES, a 65C816\n///\n/// The primary way to use this CPU is through the [`cycle`] function,\n/// which allows to resume execution between cycles, and inspecting\n/// what kind of cycle (memory access or internal) the CPU just finished.\n#[expect(non_snake_case, reason = \"Registers are named in full caps\")]\npub struct CPU {\n    /// Internal registers accessible read/write to executed programs\n    registers: Registers,\n\n    /// Address bus: points to one byte in the global address space\n    /// where memory I/O may occur if a read or write is executed.\n    addr_bus: SnesAddress,\n    /// Data bus: holds one byte that may be sent to RAM (at the address\n    /// hold by the address bus) by executing a write) or coming from\n    /// RAM (from the address in the address bus) right after a read has\n    /// been executed.\n    ///\n    /// It is a public member to allow code managing the CPU to feed\n    /// in bytes read from RAM into the CPU.\n    pub data_bus: u8,\n\n    /// Instruction register: in the original hardware, this holds the opcode\n    /// of the current instruction being executed; in our case, we can take\n    /// the shortcut of holding a reference to our custom Instruction type.\n    IR: \u0026'static Instruction,\n    /// Timing control unit: holds how many cycles of the current\n    /// instruction have been executed\n    TCU: usize,\n}\n\n/// The result of a CPU cycle.\n///\n/// This enum is the return type of the [`CPU::cycle`] function: it is used\n/// to inform the caller of what the CPU has done or I/O requests.\n#[derive(Debug, PartialEq, Eq)]\npub enum CycleResult {\n    /// The CPU wants to read from RAM. The caller should write in the data\n    /// bus the byte contained at the address pointed to by the address bus.\n    Read,\n\n    /// The CPU wants to write to RAM. The caller should write to RAM the\n    /// content of the data bus at the address pointed to by the address bus.\n    Write,\n\n    /// The CPU executes an internal cycle: it only tweaks internal registers,\n    /// does not access RAM. No specific action is required from the caller.\n    Internal,\n}\n\nimpl CPU {\n    pub fn new(registers: Registers) -\u003e Self {\n        Self {\n            registers,\n            addr_bus: SnesAddress::default(),\n            data_bus: 0,\n            IR: INSTRUCTIONS[0xea].unwrap(), // By default hold a NOP (no-operation) to do nothing\n            TCU: 1, // NOP is only 1 cycle, so we go to an opcode fetch cycle\n        }\n    }\n\n    /// Public getter to internal registers, can be used for tests or diagnostics\n    pub fn regs(\u0026self) -\u003e \u0026Registers {\n        \u0026self.registers\n    }\n\n    /// Public getter to the address bus, needs to be read by the\n    /// code managing the CPU for RAM I/O\n    pub fn addr_bus(\u0026self) -\u003e \u0026SnesAddress {\n        \u0026self.addr_bus\n    }\n\n    /// Execute a single CPU cycle.\n    ///\n    /// This function is the core part of the public API to this struct.\n    /// See the following example usage:\n    ///\n    /// ```rs\n    /// let mut cpu = CPU::new(Registers::default);\n    ///\n    /// // Example RAM, would be much more complicated in practice\n    /// let mut ram = [0u8; 65536 * 256];\n    ///\n    /// loop {\n    ///     match cpu.cycle() {\n    ///         // The CPU completed an internal cycle, no action required\n    ///         CycleResult::Internal =\u003e {\n    ///             // sleep for the amount of time for internal cycles\n    ///         },\n    ///\n    ///         // The CPU wants to read from memory\n    ///         CycleResult::Read =\u003e {\n    ///             // Get the read address\n    ///             let addr = *cpu.address_bus();\n    ///\n    ///             // Read the byte from RAM\n    ///             let byte = ram[(addr.bank \u003c\u003c 16) | addr.addr];\n    ///\n    ///             // Inject the byte from RAM into the CPU data bus\n    ///             cpu.data_bus = byte;\n    ///\n    ///             // sleep for the amount of time depending on the read address\n    ///         },\n    ///\n    ///         // The CPU wants to write to memory\n    ///         CycleResult::Write =\u003e {\n    ///             // Get the write address\n    ///             let addr = *cpu.address_bus();\n    ///\n    ///             // Get the byte to write\n    ///             let byte = cpu.data_bus;\n    ///\n    ///             // Inject the byte from the CPU data bus into RAM\n    ///             ram[(addr.bank \u003c\u003c 16) | addr.addr] = byte;\n    ///\n    ///             // sleep for the amount of time depending on the write address\n    ///         }\n    ///     },\n    /// }\n    /// ```\n    ///\n    /// See [`CycleResult`] for more information about the return value of\n    /// this function.\n    pub fn cycle(\u0026mut self) -\u003e CycleResult {\n        // check for opcode fetch cycle\n        if self.TCU == self.IR.len() {\n            self.TCU = 0;\n            self.addr_bus = SnesAddress {\n                bank: self.registers.PB,\n                addr: self.registers.PC,\n            };\n            return CycleResult::Read;\n        }\n\n        // if first cycle of an instruction, set IR according to the fetched opcode\n        if self.TCU == 0 {\n            if let Some(instr) = INSTRUCTIONS[self.data_bus as usize] {\n                self.IR = instr;\n            } else {\n                todo!(\"Unimplemented instruction ({:#02x})\", self.data_bus);\n            }\n        }\n\n        // actually run the instr cycle\n        let ret = match self.IR[self.TCU] {\n            InstructionCycle::Read =\u003e CycleResult::Read,\n            InstructionCycle::Write =\u003e CycleResult::Write,\n            InstructionCycle::Internal(internal) =\u003e {\n                internal(self);\n                CycleResult::Internal\n            }\n        };\n\n        self.TCU += 1;\n        ret\n    }\n\n    /// `INX` instruction: increment register X\n    ///\n    /// Flags set:\n    /// - `Z`: whether the result is zero\n    /// - `N`: whether the result is negative (if it were interpreted as signed)\n    pub(crate) fn inx(\u0026mut self) {\n        self.registers.X = self.registers.X.wrapping_add(1);\n        self.registers.P.Z = self.registers.X == 0;\n        self.registers.P.N = self.registers.X \u003e 0x7fff;\n    }\n}\n\n#[cfg(test)]\nmod test {\n    use super::*;\n\n    #[test]\n    fn test_1_plus_1_is_2() {\n        let mut regs = Registers::default();\n\n        regs.X = 1;\n        let mut cpu = CPU::new(regs);\n\n        cpu.inx();\n        assert_eq!(cpu.regs().X, 2);\n    }\n\n    #[test]\n    fn test_1_plus_1_is_2_cycle_api() {\n        let mut regs = Registers::default();\n        regs.PB = 0x12;\n        regs.PC = 0x3456;\n\n        regs.X = 1;\n        let mut cpu = CPU::new(regs);\n\n        assert_eq!(\n            cpu.cycle(),\n            CycleResult::Read,\n            \"Expecting a read cycle for opcode fetch\"\n        );\n        assert_eq!(\n            *cpu.addr_bus(),\n            SnesAddress {\n                bank: 0x12,\n                addr: 0x3456\n            },\n            \"Read query should be from address at PB:PC\"\n        );\n        cpu.data_bus = 0xe8; // Inject the INX opcode into the CPU\n\n        assert_eq!(\n            cpu.cycle(),\n            CycleResult::Internal,\n            \"Expecting internal cycle for register increment\"\n        );\n        assert_eq!(cpu.regs().X, 2, \"Expecting value 2 in X register\");\n    }\n}\n","traces":[{"line":55,"address":[39184],"length":1,"stats":{"Line":2}},{"line":58,"address":[39218],"length":1,"stats":{"Line":2}},{"line":60,"address":[39232],"length":1,"stats":{"Line":2}},{"line":66,"address":[39376],"length":1,"stats":{"Line":1}},{"line":72,"address":[39392],"length":1,"stats":{"Line":1}},{"line":73,"address":[39400],"length":1,"stats":{"Line":1}},{"line":127,"address":[39408],"length":1,"stats":{"Line":1}},{"line":129,"address":[39443],"length":1,"stats":{"Line":1}},{"line":130,"address":[39472],"length":1,"stats":{"Line":1}},{"line":131,"address":[39487],"length":1,"stats":{"Line":1}},{"line":132,"address":[39480],"length":1,"stats":{"Line":1}},{"line":133,"address":[39483],"length":1,"stats":{"Line":1}},{"line":135,"address":[39494],"length":1,"stats":{"Line":1}},{"line":139,"address":[39458],"length":1,"stats":{"Line":1}},{"line":140,"address":[39708,39592,39504],"length":1,"stats":{"Line":3}},{"line":141,"address":[39700],"length":1,"stats":{"Line":1}},{"line":148,"address":[39852,39555],"length":1,"stats":{"Line":2}},{"line":149,"address":[39916],"length":1,"stats":{"Line":0}},{"line":150,"address":[39926],"length":1,"stats":{"Line":0}},{"line":151,"address":[39946],"length":1,"stats":{"Line":1}},{"line":152,"address":[39966],"length":1,"stats":{"Line":1}},{"line":153,"address":[39968],"length":1,"stats":{"Line":1}},{"line":157,"address":[39981,40026],"length":1,"stats":{"Line":1}},{"line":158,"address":[40013],"length":1,"stats":{"Line":1}},{"line":166,"address":[40064],"length":1,"stats":{"Line":1}},{"line":167,"address":[40078],"length":1,"stats":{"Line":1}},{"line":168,"address":[40101],"length":1,"stats":{"Line":1}},{"line":169,"address":[40114],"length":1,"stats":{"Line":1}}],"covered":26,"coverable":28},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","instr_tab.rs"],"content":"use crate::cpu::CPU;\n\n/// An action the CPU will execute during a cycle.\n///\n/// For [`Read`]/`[`Write`]` cycle, there are no additional fields, the CPU spends\n/// the whole cycle reading or writing.\n///\n/// For internal cycles, any arbitrary action can happen within the CPU, so\n/// the [`Internal`] variant holds a function pointer to the rust code to run.\npub(crate) enum InstructionCycle {\n    Read,\n    Write,\n    Internal(fn(\u0026mut CPU) -\u003e ()),\n}\n\n/// Type representing the definition of a CPU instruction\n///\n/// Conceptually, an instruction is simply a list of actions\n/// done in 1 cycle each. This is what this type represents.\npub(crate) type Instruction = [InstructionCycle];\n\n/// Table of all SNES CPU instructions.\n///\n/// Since each one of the 256 possible opcodes is associated with a valid\n/// instruction, we can use an array to store them all.\n///\n/// When all instructions will be implemented, the [`Option`] wrapper\n/// will be removed.\npub(crate) const INSTRUCTIONS: [Option\u003c\u0026'static Instruction\u003e; 256] = [\n    /* 00 */ None,\n    /* 01 */ None,\n    /* 02 */ None,\n    /* 03 */ None,\n    /* 04 */ None,\n    /* 05 */ None,\n    /* 06 */ None,\n    /* 07 */ None,\n    /* 08 */ None,\n    /* 09 */ None,\n    /* 0a */ None,\n    /* 0b */ None,\n    /* 0c */ None,\n    /* 0d */ None,\n    /* 0e */ None,\n    /* 0f */ None,\n    /* 10 */ None,\n    /* 11 */ None,\n    /* 12 */ None,\n    /* 13 */ None,\n    /* 14 */ None,\n    /* 15 */ None,\n    /* 16 */ None,\n    /* 17 */ None,\n    /* 18 */ None,\n    /* 19 */ None,\n    /* 1a */ None,\n    /* 1b */ None,\n    /* 1c */ None,\n    /* 1d */ None,\n    /* 1e */ None,\n    /* 1f */ None,\n    /* 20 */ None,\n    /* 21 */ None,\n    /* 22 */ None,\n    /* 23 */ None,\n    /* 24 */ None,\n    /* 25 */ None,\n    /* 26 */ None,\n    /* 27 */ None,\n    /* 28 */ None,\n    /* 29 */ None,\n    /* 2a */ None,\n    /* 2b */ None,\n    /* 2c */ None,\n    /* 2d */ None,\n    /* 2e */ None,\n    /* 2f */ None,\n    /* 30 */ None,\n    /* 31 */ None,\n    /* 32 */ None,\n    /* 33 */ None,\n    /* 34 */ None,\n    /* 35 */ None,\n    /* 36 */ None,\n    /* 37 */ None,\n    /* 38 */ None,\n    /* 39 */ None,\n    /* 3a */ None,\n    /* 3b */ None,\n    /* 3c */ None,\n    /* 3d */ None,\n    /* 3e */ None,\n    /* 3f */ None,\n    /* 40 */ None,\n    /* 41 */ None,\n    /* 42 */ None,\n    /* 43 */ None,\n    /* 44 */ None,\n    /* 45 */ None,\n    /* 46 */ None,\n    /* 47 */ None,\n    /* 48 */ None,\n    /* 49 */ None,\n    /* 4a */ None,\n    /* 4b */ None,\n    /* 4c */ None,\n    /* 4d */ None,\n    /* 4e */ None,\n    /* 4f */ None,\n    /* 50 */ None,\n    /* 51 */ None,\n    /* 52 */ None,\n    /* 53 */ None,\n    /* 54 */ None,\n    /* 55 */ None,\n    /* 56 */ None,\n    /* 57 */ None,\n    /* 58 */ None,\n    /* 59 */ None,\n    /* 5a */ None,\n    /* 5b */ None,\n    /* 5c */ None,\n    /* 5d */ None,\n    /* 5e */ None,\n    /* 5f */ None,\n    /* 60 */ None,\n    /* 61 */ None,\n    /* 62 */ None,\n    /* 63 */ None,\n    /* 64 */ None,\n    /* 65 */ None,\n    /* 66 */ None,\n    /* 67 */ None,\n    /* 68 */ None,\n    /* 69 */ None,\n    /* 6a */ None,\n    /* 6b */ None,\n    /* 6c */ None,\n    /* 6d */ None,\n    /* 6e */ None,\n    /* 6f */ None,\n    /* 70 */ None,\n    /* 71 */ None,\n    /* 72 */ None,\n    /* 73 */ None,\n    /* 74 */ None,\n    /* 75 */ None,\n    /* 76 */ None,\n    /* 77 */ None,\n    /* 78 */ None,\n    /* 79 */ None,\n    /* 7a */ None,\n    /* 7b */ None,\n    /* 7c */ None,\n    /* 7d */ None,\n    /* 7e */ None,\n    /* 7f */ None,\n    /* 80 */ None,\n    /* 81 */ None,\n    /* 82 */ None,\n    /* 83 */ None,\n    /* 84 */ None,\n    /* 85 */ None,\n    /* 86 */ None,\n    /* 87 */ None,\n    /* 88 */ None,\n    /* 89 */ None,\n    /* 8a */ None,\n    /* 8b */ None,\n    /* 8c */ None,\n    /* 8d */ None,\n    /* 8e */ None,\n    /* 8f */ None,\n    /* 90 */ None,\n    /* 91 */ None,\n    /* 92 */ None,\n    /* 93 */ None,\n    /* 94 */ None,\n    /* 95 */ None,\n    /* 96 */ None,\n    /* 97 */ None,\n    /* 98 */ None,\n    /* 99 */ None,\n    /* 9a */ None,\n    /* 9b */ None,\n    /* 9c */ None,\n    /* 9d */ None,\n    /* 9e */ None,\n    /* 9f */ None,\n    /* a0 */ None,\n    /* a1 */ None,\n    /* a2 */ None,\n    /* a3 */ None,\n    /* a4 */ None,\n    /* a5 */ None,\n    /* a6 */ None,\n    /* a7 */ None,\n    /* a8 */ None,\n    /* a9 */ None,\n    /* aa */ None,\n    /* ab */ None,\n    /* ac */ None,\n    /* ad */ None,\n    /* ae */ None,\n    /* af */ None,\n    /* b0 */ None,\n    /* b1 */ None,\n    /* b2 */ None,\n    /* b3 */ None,\n    /* b4 */ None,\n    /* b5 */ None,\n    /* b6 */ None,\n    /* b7 */ None,\n    /* b8 */ None,\n    /* b9 */ None,\n    /* ba */ None,\n    /* bb */ None,\n    /* bc */ None,\n    /* bd */ None,\n    /* be */ None,\n    /* bf */ None,\n    /* c0 */ None,\n    /* c1 */ None,\n    /* c2 */ None,\n    /* c3 */ None,\n    /* c4 */ None,\n    /* c5 */ None,\n    /* c6 */ None,\n    /* c7 */ None,\n    /* c8 */ None,\n    /* c9 */ None,\n    /* ca */ None,\n    /* cb */ None,\n    /* cc */ None,\n    /* cd */ None,\n    /* ce */ None,\n    /* cf */ None,\n    /* d0 */ None,\n    /* d1 */ None,\n    /* d2 */ None,\n    /* d3 */ None,\n    /* d4 */ None,\n    /* d5 */ None,\n    /* d6 */ None,\n    /* d7 */ None,\n    /* d8 */ None,\n    /* d9 */ None,\n    /* da */ None,\n    /* db */ None,\n    /* dc */ None,\n    /* dd */ None,\n    /* de */ None,\n    /* df */ None,\n    /* e0 */ None,\n    /* e1 */ None,\n    /* e2 */ None,\n    /* e3 */ None,\n    /* e4 */ None,\n    /* e5 */ None,\n    /* e6 */ None,\n    /* e7 */ None,\n    /* e8 */ Some(\u0026[InstructionCycle::Internal(CPU::inx)]),\n    /* e9 */ None,\n    /* ea */ Some(\u0026[InstructionCycle::Internal(|_| {})]), // No-op, do nothing\n    /* eb */ None,\n    /* ec */ None,\n    /* ed */ None,\n    /* ee */ None,\n    /* ef */ None,\n    /* f0 */ None,\n    /* f1 */ None,\n    /* f2 */ None,\n    /* f3 */ None,\n    /* f4 */ None,\n    /* f5 */ None,\n    /* f6 */ None,\n    /* f7 */ None,\n    /* f8 */ None,\n    /* f9 */ None,\n    /* fa */ None,\n    /* fb */ None,\n    /* fc */ None,\n    /* fd */ None,\n    /* fe */ None,\n    /* ff */ None,\n];\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","lib.rs"],"content":"pub mod registers;\npub mod cpu;\nmod instr_tab;\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use registers::Registers;\n\n\n    #[test]\n    fn regs () {\n        let _ = Registers::default();\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","registers.rs"],"content":"/// A struct which represents the WDC 65C816's registers\n#[allow(non_snake_case, reason = \"We are naming register in all caps\")]\n#[derive(Debug)]\npub struct Registers {\n    /// The accumulator register: stores the result of most operations\n    pub A: u16,\n\n    /// Data Bank register: Default bank address for memory transfers\n    pub DB: u8,\n\n    /// Direct register: offset applied to all memory addresses for instructions\n    /// which use direct addressing\n    pub D: u16,\n\n    /// The index registers: used for 2D computations or memory access\n    pub X: u16,\n    pub Y: u16,\n\n    /// Processor status register: contains various CPU flags\n    pub P: RegisterP,\n\n    /// Program bank register: stores the bank address of current execution\n    pub PB: u8,\n\n    /// Program Counter: stores the current execution address within [`Registers::PB`]\n    pub PC: u16,\n\n    /// Stack pointer: the address of the top of the stack\n    pub S: u16,\n}\n\n#[allow(non_snake_case, reason = \"We are naming register in all caps\")]\n#[derive(Debug)]\npub struct RegisterP {\n    /// Carry flag: typically set when an arithmetic operation \"carries out\"\n    pub C: bool,\n\n    /// Negative flag: set when the result of a previous instruction is negative\n    pub N: bool,\n\n    /// Overflow flag: whether an operation overflew\n    pub V: bool,\n\n    /// Zero flag: set when the result is zero\n    pub Z: bool,\n\n    // Registers below are still unused\n    /// Decimal flag\n    pub D: bool,\n\n    /// IRQ Disable flag\n    pub I: bool,\n\n    /// Memory/Accumulator flag: Controls the width of the A register\n    ///\n    /// When set to 0, the accumulator register (A) is 16 bits wide \\\n    /// When set to 1, the accumulator register (A) is 8 bits wide\n    ///\n    /// Always set to 1 in emulation mode, reset to 1 when switching to native mode\n    pub M: bool,\n\n    /// Index flag: Controls the width of the index registers X and Y\n    ///\n    /// When set to 0, both X and Y are 16 bits wide \\\n    /// When set to 1, both X and Y are 8 bits wide\n    ///\n    /// When switching from 0 to 1, the high byte of both registers resets to 0\n    ///\n    /// Only exists in native mode (E=1), replaced by the B flag in emulation mode.\\\n    /// Reset to 1 when switching to native mode\n    pub X: bool,\n\n    /// Emulation flag: whether the CPU is in 8-bit compatibility mode\n    pub E: bool,\n\n    /// Break flag\n    pub B: bool,\n}\n\n/// Implementation of the default state of the CPU registers on power-on or reset\n/// TODO: Make this implementation truthful to the real 65816.\nimpl Default for Registers {\n    fn default() -\u003e Self {\n        Self {\n            A: 0,\n            DB: 0,\n            D: 0,\n            X: 0,\n            Y: 0,\n            P: RegisterP::default(),\n            PB: 0,\n            PC: 0,\n            S: 0,\n        }\n    }\n}\n\n/// TODO: Make this implementation truthful to the real 65816.\nimpl Default for RegisterP {\n    fn default() -\u003e Self {\n        Self {\n            C: false,\n            N: false,\n            V: false,\n            Z: false,\n            D: false,\n            I: false,\n            M: false,\n            X: false,\n            E: false,\n            B: false,\n        }\n    }\n}\n","traces":[{"line":83,"address":[42288],"length":1,"stats":{"Line":3}},{"line":90,"address":[42302],"length":1,"stats":{"Line":3}},{"line":100,"address":[42400],"length":1,"stats":{"Line":3}}],"covered":3,"coverable":3},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","lib.rs"],"content":"pub mod utils;\npub mod tile;\npub mod ppu;\n\n#[cfg(test)]\nmod tests;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","ppu.rs"],"content":"use crate::utils::{render_scanline, CGRAM_SIZE, HEIGHT, VRAM_SIZE, WIDTH};\n\npub struct PPU {\n    pub(crate) framebuffer: Vec\u003cu32\u003e,\n    pub(crate) vram: [u8; VRAM_SIZE],\n    pub(crate) cgram: [u16; CGRAM_SIZE],\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    pub(crate) cgaddr: u8,\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    pub(crate) latch: u8,\n    pub(crate) latch_filled: bool\n}\n\nimpl PPU {\n    pub fn new() -\u003e Self {\n        let mut ppu = Self {\n            framebuffer: vec![0; WIDTH * HEIGHT],\n            vram: [0; VRAM_SIZE],\n            cgram: [0; CGRAM_SIZE],\n            cgaddr: 0,\n            latch: 0,\n            latch_filled: false\n        };\n\n        // Hardcoded palette\n        for i in 0..CGRAM_SIZE {\n            let r = (i \u0026 0x1F) as u16;\n            let g = ((i \u003e\u003e 2) \u0026 0x1F) as u16;\n            let b = ((i \u003e\u003e 4) \u0026 0x1F) as u16;\n            ppu.cgram[i] = (b \u003c\u003c 10) | (g \u003c\u003c 5) | r;\n        }\n\n        ppu\n    }\n\n    pub fn write_vram(\u0026mut self, addr: usize, value: u8) {\n        if addr \u003e= VRAM_SIZE {\n            eprintln!(\"[ERR::VRAM] Write attempt to invalid address 0x{:04X}\", addr);\n            return;\n        }\n        self.vram[addr] = value;\n    }\n\n    pub fn read_vram(\u0026self, addr: usize) -\u003e u8 {\n        if addr \u003e= VRAM_SIZE {\n            eprintln!(\"[ERR::VRAM] Read attempt from invalid address 0x{:04X}\", addr);\n            return 0;\n        }\n        self.vram[addr]\n    }\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    // Set current CGRAM address ($2121 on the SNES)\n    pub fn set_cgram_addr(\u0026mut self, addr: u8) {\n        self.cgaddr = addr;\n        self.latch_filled = false; // reset latch when address changes\n    }\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    // Write one byte to CGRAM ($2122 on the SNES)\n    pub fn write_cgram_data(\u0026mut self, value: u8) {\n        if self.latch_filled {\n            // 2nd write â†’ combine low + high into one 16-bit value\n            let color = u16::from_le_bytes([self.latch, value]);\n            self.cgram[self.cgaddr as usize] = color \u0026 0x7FFF; // mask to 15 bits\n            self.cgaddr = self.cgaddr.wrapping_add(1); // auto-increment address\n            self.latch_filled = false;\n        } else {\n            // 1st write â†’ store in latch\n            self.latch = value;\n            self.latch_filled = true;\n        }\n    }\n\n    pub fn read_cgram(\u0026self, index: u8) -\u003e u32 {\n        bgr555_to_argb(self.cgram[index as usize])\n    }\n\n    pub fn render(\u0026mut self, tiles_per_row: usize) {\n        for y in 0..HEIGHT {\n            render_scanline(self, y, tiles_per_row);\n        }\n    }\n}\n\npub fn bgr555_to_argb(bgr: u16) -\u003e u32 {\n    let r = (bgr \u0026 0x1F) as u32;\n    let g = ((bgr \u003e\u003e 5) \u0026 0x1F) as u32;\n    let b = ((bgr \u003e\u003e 10) \u0026 0x1F) as u32;\n\n    // Expand 5-bit to 8-bit by duplicating upper bits\n    let r8 = (r \u003c\u003c 3) | (r \u003e\u003e 2);\n    let g8 = (g \u003c\u003c 3) | (g \u003e\u003e 2);\n    let b8 = (b \u003c\u003c 3) | (b \u003e\u003e 2);\n\n    (0xFF \u003c\u003c 24) | (r8 \u003c\u003c 16) | (g8 \u003c\u003c 8) | b8\n}\n","traces":[{"line":17,"address":[79157,78432,79163],"length":1,"stats":{"Line":13}},{"line":19,"address":[702786,703072],"length":1,"stats":{"Line":13}},{"line":20,"address":[702891],"length":1,"stats":{"Line":13}},{"line":21,"address":[702925],"length":1,"stats":{"Line":13}},{"line":28,"address":[703044,703135,703426],"length":1,"stats":{"Line":39}},{"line":29,"address":[703241],"length":1,"stats":{"Line":13}},{"line":30,"address":[79000,78954],"length":1,"stats":{"Line":26}},{"line":31,"address":[703330],"length":1,"stats":{"Line":13}},{"line":32,"address":[703436,703356],"length":1,"stats":{"Line":13}},{"line":35,"address":[703265],"length":1,"stats":{"Line":13}},{"line":38,"address":[703488],"length":1,"stats":{"Line":4}},{"line":39,"address":[703523],"length":1,"stats":{"Line":4}},{"line":40,"address":[703554],"length":1,"stats":{"Line":1}},{"line":43,"address":[703664,703675,703534],"length":1,"stats":{"Line":6}},{"line":46,"address":[703712],"length":1,"stats":{"Line":1}},{"line":47,"address":[79433],"length":1,"stats":{"Line":1}},{"line":48,"address":[703768],"length":1,"stats":{"Line":2}},{"line":49,"address":[703862],"length":1,"stats":{"Line":1}},{"line":51,"address":[703748,703894,703879],"length":1,"stats":{"Line":4}},{"line":56,"address":[703936],"length":1,"stats":{"Line":5}},{"line":57,"address":[703948],"length":1,"stats":{"Line":5}},{"line":58,"address":[703954],"length":1,"stats":{"Line":4}},{"line":63,"address":[703968],"length":1,"stats":{"Line":2}},{"line":64,"address":[79689,79875,79720],"length":1,"stats":{"Line":12}},{"line":66,"address":[704035],"length":1,"stats":{"Line":1}},{"line":67,"address":[704186,704087,704129],"length":1,"stats":{"Line":5}},{"line":68,"address":[704142],"length":1,"stats":{"Line":2}},{"line":69,"address":[704172],"length":1,"stats":{"Line":1}},{"line":72,"address":[79707],"length":1,"stats":{"Line":2}},{"line":73,"address":[704017],"length":1,"stats":{"Line":1}},{"line":77,"address":[79904],"length":1,"stats":{"Line":1}},{"line":78,"address":[704229,704278],"length":1,"stats":{"Line":1}},{"line":81,"address":[704304],"length":1,"stats":{"Line":2}},{"line":82,"address":[704327,704352],"length":1,"stats":{"Line":4}},{"line":83,"address":[80099],"length":1,"stats":{"Line":2}},{"line":88,"address":[704416],"length":1,"stats":{"Line":1}},{"line":89,"address":[80120],"length":1,"stats":{"Line":1}},{"line":90,"address":[704438],"length":1,"stats":{"Line":1}},{"line":91,"address":[704456],"length":1,"stats":{"Line":1}},{"line":94,"address":[704471],"length":1,"stats":{"Line":1}},{"line":95,"address":[704485],"length":1,"stats":{"Line":1}},{"line":96,"address":[704499],"length":1,"stats":{"Line":6}},{"line":98,"address":[704513],"length":1,"stats":{"Line":6}}],"covered":43,"coverable":43},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","tile.rs"],"content":"use image::{Rgba};\nuse crate::ppu::PPU;\nuse crate::utils::{TILE_SIZE};\n\npub fn load_and_split_image(path: \u0026str) -\u003e (Vec\u003cVec\u003cRgba\u003cu8\u003e\u003e\u003e, usize) {\n    let img = image::open(path).expect(\"[ERR::ImageLoad] Failed to load image file.\");\n    let img = img.to_rgba8();\n    let width = img.width() as usize;\n    let height = img.height() as usize;\n\n    let tile_size = TILE_SIZE;\n\n    let tiles_x = (width + tile_size - 1) / tile_size;\n    let tiles_y = (height + tile_size - 1) / tile_size;\n\n    let mut tiles = Vec::new();\n\n    for ty in 0..tiles_y {\n        for tx in 0..tiles_x {\n            let mut tile = Vec::new();\n\n            let x_start = tx * tile_size;\n            let y_start = ty * tile_size;\n            let x_end = (x_start + tile_size).min(width);\n            let y_end = (y_start + tile_size).min(height);\n\n            for y in y_start..y_end {\n                for x in x_start..x_end {\n                    let px = img.get_pixel(x as u32, y as u32);\n                    tile.push(*px);\n                }\n            }\n\n            tiles.push(tile);\n        }\n    }\n\n    (tiles, width)\n}\n\npub fn load_tiles_into_vram(ppu: \u0026mut PPU, tiles: \u0026Vec\u003cVec\u003cRgba\u003cu8\u003e\u003e\u003e) {\n    for (tile_index, tile) in tiles.iter().enumerate() {\n        let base_addr = tile_index * TILE_SIZE * TILE_SIZE;\n        if tile.len() \u003c TILE_SIZE * TILE_SIZE {\n            eprintln!(\n                \"[WARN] Skipping tile {}: only {} pixels, expected {}\",\n                tile_index,\n                tile.len(),\n                TILE_SIZE * TILE_SIZE\n            );\n            continue;\n        }\n\n        for y in 0..TILE_SIZE {\n            for x in 0..TILE_SIZE {\n                let pixel = \u0026tile[y * TILE_SIZE + x];\n\n                // Tmp: taking the red intensity as a \"palette index\"\n                let value = pixel[0] \u003e\u003e 2; // 0â€“255 â†’ 0â€“63 (enough to index a fake palette)\n\n                let addr = base_addr + y * TILE_SIZE + x;\n                ppu.write_vram(addr, value);\n            }\n        }\n    }\n}\n\npub fn get_tile_from_vram(ppu: \u0026PPU, tile_index: usize) -\u003e Vec\u003cu32\u003e {\n    let mut tile_pixels = Vec::new();\n    let base_addr = tile_index * TILE_SIZE * TILE_SIZE;\n\n    for y in 0..TILE_SIZE {\n        for x in 0..TILE_SIZE {\n            let addr = base_addr + y * TILE_SIZE + x;\n            let palette_index = ppu.read_vram(addr);\n\n            // Get color from CGRAM\n            let argb = ppu.read_cgram(palette_index);\n            tile_pixels.push(argb);\n        }\n    }\n\n    tile_pixels\n}\n","traces":[{"line":5,"address":[139013,139019,137024],"length":1,"stats":{"Line":5}},{"line":6,"address":[483895],"length":1,"stats":{"Line":1}},{"line":7,"address":[483980],"length":1,"stats":{"Line":6}},{"line":8,"address":[484117,484043],"length":1,"stats":{"Line":7}},{"line":9,"address":[484135],"length":1,"stats":{"Line":1}},{"line":11,"address":[484194],"length":1,"stats":{"Line":6}},{"line":13,"address":[137374],"length":1,"stats":{"Line":1}},{"line":14,"address":[484330],"length":1,"stats":{"Line":6}},{"line":16,"address":[484455],"length":1,"stats":{"Line":1}},{"line":18,"address":[484470,484557],"length":1,"stats":{"Line":7}},{"line":19,"address":[484857,485597,484686],"length":1,"stats":{"Line":8}},{"line":20,"address":[484990],"length":1,"stats":{"Line":6}},{"line":22,"address":[485078,485005],"length":1,"stats":{"Line":1}},{"line":23,"address":[485153,485177,485058],"length":1,"stats":{"Line":7}},{"line":24,"address":[485211,485161],"length":1,"stats":{"Line":7}},{"line":25,"address":[138434],"length":1,"stats":{"Line":6}},{"line":27,"address":[485348],"length":1,"stats":{"Line":1}},{"line":28,"address":[485498,485612],"length":1,"stats":{"Line":7}},{"line":29,"address":[485722],"length":1,"stats":{"Line":6}},{"line":30,"address":[485770],"length":1,"stats":{"Line":1}},{"line":34,"address":[485519],"length":1,"stats":{"Line":6}},{"line":38,"address":[484733],"length":1,"stats":{"Line":6}},{"line":41,"address":[485872],"length":1,"stats":{"Line":1}},{"line":42,"address":[139182,139081],"length":1,"stats":{"Line":2}},{"line":43,"address":[486111,486236,486152],"length":1,"stats":{"Line":2}},{"line":44,"address":[486203,486259],"length":1,"stats":{"Line":2}},{"line":45,"address":[487072,486330],"length":1,"stats":{"Line":1}},{"line":54,"address":[486355,486279],"length":1,"stats":{"Line":2}},{"line":55,"address":[139623,139592],"length":1,"stats":{"Line":2}},{"line":56,"address":[486529,486678],"length":1,"stats":{"Line":1}},{"line":59,"address":[139786],"length":1,"stats":{"Line":1}},{"line":61,"address":[486701,486658,486802],"length":1,"stats":{"Line":2}},{"line":62,"address":[486789],"length":1,"stats":{"Line":1}},{"line":68,"address":[487913,487907,487088],"length":1,"stats":{"Line":2}},{"line":69,"address":[140311],"length":1,"stats":{"Line":4}},{"line":70,"address":[487165,487283,487321],"length":1,"stats":{"Line":8}},{"line":72,"address":[140517,140459],"length":1,"stats":{"Line":8}},{"line":73,"address":[487554,487455],"length":1,"stats":{"Line":8}},{"line":74,"address":[487811,487669],"length":1,"stats":{"Line":4}},{"line":75,"address":[487844,487800],"length":1,"stats":{"Line":10}},{"line":78,"address":[487851],"length":1,"stats":{"Line":5}},{"line":79,"address":[487876],"length":1,"stats":{"Line":5}},{"line":83,"address":[487501],"length":1,"stats":{"Line":5}}],"covered":43,"coverable":43},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","utils.rs"],"content":"use crate::ppu::PPU;\nuse crate::tile::get_tile_from_vram;\n\npub const VRAM_SIZE: usize = 64 * 1024; // 64 KB\npub const CGRAM_SIZE: usize = 256; // 256 color palette\npub const TILE_SIZE: usize = 8;\npub const TILES_X: usize = 32;\npub const TILES_Y: usize = 32;\npub const WIDTH: usize = TILES_X * TILE_SIZE;\npub const HEIGHT: usize = TILES_Y * TILE_SIZE;\npub const SCALE: usize = 2;\npub const SCREEN_WIDTH: usize = WIDTH * SCALE;\npub const SCREEN_HEIGHT: usize = HEIGHT * SCALE;\n\npub fn render_scanline(ppu: \u0026mut PPU, y: usize, tiles_per_row: usize) {\n    if y \u003e= HEIGHT {\n        return;\n    }\n\n    for x in 0..tiles_per_row {\n        let tile_index = (y / TILE_SIZE) * tiles_per_row + x;\n\n        let tile_pixels = get_tile_from_vram(ppu, tile_index);\n\n        let tile_line = y % TILE_SIZE;\n\n        for px in 0..TILE_SIZE {\n            let screen_x = x * TILE_SIZE + px;\n            if screen_x \u003c WIDTH {\n                let color = tile_pixels[tile_line * TILE_SIZE + px];\n                ppu.framebuffer[y * WIDTH + screen_x] = color;\n            }\n        }\n    }\n}","traces":[{"line":15,"address":[243211,243217,242272],"length":1,"stats":{"Line":1}},{"line":16,"address":[625159],"length":1,"stats":{"Line":1}},{"line":20,"address":[625212,625176],"length":1,"stats":{"Line":3}},{"line":21,"address":[625396,625296],"length":1,"stats":{"Line":2}},{"line":23,"address":[625381],"length":1,"stats":{"Line":2}},{"line":25,"address":[625417,625394],"length":1,"stats":{"Line":10}},{"line":27,"address":[625517,625433],"length":1,"stats":{"Line":10}},{"line":28,"address":[625741,625631,625680],"length":1,"stats":{"Line":10}},{"line":29,"address":[626038,625728],"length":1,"stats":{"Line":10}},{"line":30,"address":[625764],"length":1,"stats":{"Line":5}},{"line":31,"address":[625908],"length":1,"stats":{"Line":5}}],"covered":11,"coverable":11}]};
        var previousData = {"files":[{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","apu.rs"],"content":"use crate::{cpu::Spc700, dsp::Dsp, memory::Memory, timers::Timers};\n\npub struct Apu {\n    pub cpu: Spc700,\n    pub dsp: Dsp,\n    pub memory: Memory,\n    pub timers: Timers,\n    pub cycles: u64,\n}\n\n\nimpl Apu {\n    pub fn new() -\u003e Self {\n        Self {\n            cpu: Spc700::new(),\n            dsp: Dsp::new(),\n            memory: Memory::new(),\n            timers: Timers::new(),\n            cycles: 0,\n        }\n    }\n\n    /// Step the APU forward by a given number of cycles\n    pub fn step(\u0026mut self, cycles: u32) {\n        for _ in 0..cycles {\n            self.cpu.step(\u0026mut self.memory);\n            self.timers.step(\u0026mut self.memory);\n            self.dsp.step(\u0026mut self.memory);\n            self.cycles += 1;\n        }\n    }\n\n    /// Generate audio samples (stub for now)\n    pub fn render_audio(\u0026mut self, _num_samples: usize) -\u003e Vec\u003ci16\u003e {\n        // TODO: pull from DSPâ€™s audio buffer\n        vec![0; _num_samples]\n    }\n}\n","traces":[{"line":13,"address":[42592],"length":1,"stats":{"Line":0}},{"line":15,"address":[42639],"length":1,"stats":{"Line":0}},{"line":16,"address":[42649],"length":1,"stats":{"Line":0}},{"line":17,"address":[42659],"length":1,"stats":{"Line":0}},{"line":18,"address":[42672],"length":1,"stats":{"Line":0}},{"line":24,"address":[42784],"length":1,"stats":{"Line":0}},{"line":25,"address":[42959,42802],"length":1,"stats":{"Line":0}},{"line":26,"address":[42842],"length":1,"stats":{"Line":0}},{"line":27,"address":[42869],"length":1,"stats":{"Line":0}},{"line":28,"address":[42896],"length":1,"stats":{"Line":0}},{"line":29,"address":[42952,42916,42964],"length":1,"stats":{"Line":0}},{"line":34,"address":[42992],"length":1,"stats":{"Line":0}},{"line":36,"address":[43013],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":13},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","cpu.rs"],"content":"use crate::memory::Memory;\n\n#[derive(Default)]\npub struct Registers {\n    pub a: u8,     // Accumulator\n    pub x: u8,     // Index X\n    pub y: u8,     // Index Y\n    pub sp: u8,    // Stack Pointer\n    pub pc: u16,   // Program Counter\n    pub psw: u8,   // Processor Status Word (flags)\n}\n\n// Processor status flags\npub const FLAG_C: u8 = 0x01; // Carry\npub const FLAG_Z: u8 = 0x02; // Zero\npub const FLAG_I: u8 = 0x04; // Interrupt Disable\npub const FLAG_H: u8 = 0x08; // Half-Carry\npub const FLAG_B: u8 = 0x10; // Break\npub const FLAG_P: u8 = 0x20; // Direct Page\npub const FLAG_V: u8 = 0x40; // Overflow\npub const FLAG_N: u8 = 0x80; // Negative\n\npub struct Spc700 {\n    pub regs: Registers,\n    pub cycles: u32,\n}\n\nimpl Spc700 {\n    pub fn new() -\u003e Self {\n        Self {\n            regs: Registers::default(),\n            cycles: 0,\n        }\n    }\n\n    pub fn reset(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.pc = mem.read16(0xFFFE); // Reset vector\n        self.regs.sp = 0xFF;\n        self.regs.psw = 0;\n    }\n\n    pub fn step(\u0026mut self, mem: \u0026mut Memory) {\n        let opcode = mem.read8(self.regs.pc);\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n\n        match opcode {\n            0x00 =\u003e self.inst_nop(), // NOP\n        \n            // Register moves\n            0x7D =\u003e self.inst_mov_a_x(), // MOV A, X\n            0xDD =\u003e self.inst_mov_a_y(), // MOV A, Y\n            0x5D =\u003e self.inst_mov_x_a(), // MOV X, A\n            0xFD =\u003e self.inst_mov_y_a(), // MOV Y, A\n        \n            // Immediate loads\n            0xE8 =\u003e self.inst_lda_imm(mem), // LDA #imm\n            0xCD =\u003e self.inst_ldx_imm(mem), // LDX #imm\n            0x8D =\u003e self.inst_ldy_imm(mem), // LDY #imm\n        \n            // Absolute loads\n            0xE5 =\u003e self.inst_lda_abs(mem), // MOV A, !a\n            0xE9 =\u003e self.inst_ldx_abs(mem), // MOV X, !a\n            0xEC =\u003e self.inst_ldy_abs(mem), // MOV Y, !a\n        \n            // Direct Page loads\n            0xE4 =\u003e self.inst_lda_dp(mem), // MOV A, d\n            0xF8 =\u003e self.inst_ldx_dp(mem), // MOV X, d\n            0xEB =\u003e self.inst_ldy_dp(mem), // MOV Y, d\n        \n            // Stores\n            0xC4 =\u003e self.inst_sta_dp(mem),  // MOV d, A\n            0xC5 =\u003e self.inst_sta_abs(mem), // MOV !a, A\n            0xC9 =\u003e self.inst_stx_abs(mem), // MOV !a, X\n            0xCC =\u003e self.inst_sty_abs(mem), // MOV !a, Y\n        \n            // Arithmetic \u0026 logic\n            0x88 =\u003e self.inst_adc_imm(mem), // ADC #imm\n            0xA8 =\u003e self.inst_sbc_imm(mem), // SBC #imm\n            0x68 =\u003e self.inst_cmp_imm(mem), // CMP #imm\n            0x28 =\u003e self.inst_and_imm(mem), // AND #imm\n            0x08 =\u003e self.inst_ora_imm(mem), // ORA #imm\n            0x48 =\u003e self.inst_eor_imm(mem), // EOR #imm\n        \n            // Catch-all\n            _ =\u003e unimplemented!(\"Opcode {:02X} not yet implemented\", opcode),\n        }\n    }        \n\n    // Flag helpers\n    pub fn set_flag(\u0026mut self, mask: u8, value: bool) {\n        if value {\n            self.regs.psw |= mask;\n        } else {\n            self.regs.psw \u0026= !mask;\n        }\n    }\n\n    pub fn get_flag(\u0026self, mask: u8) -\u003e bool {\n        (self.regs.psw \u0026 mask) != 0\n    }      \n\n    fn set_zn_flags(\u0026mut self, value: u8) {\n        self.set_flag(FLAG_Z, value == 0);\n        self.set_flag(FLAG_N, (value \u0026 0x80) != 0);\n    }\n\n    fn dp_base(\u0026self) -\u003e u16 {\n        if self.get_flag(FLAG_P) {\n            0x0100\n        } else {\n            0x0000\n        }\n    }\n\n    /// Reads the next byte from memory and increments the program counter.\n    fn read_immediate(\u0026mut self, mem: \u0026Memory) -\u003e u8 {\n        let value = mem.read8(self.regs.pc);\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n        value\n    }\n\n    /// Read a 16-bit little-endian immediate (two bytes) and advance PC by 2.\n    fn read_immediate16(\u0026mut self, mem: \u0026mut Memory) -\u003e u16 {\n        let lo = self.read_immediate(mem) as u16;\n        let hi = self.read_immediate(mem) as u16;\n        lo | (hi \u003c\u003c 8)\n    }\n\n    // Implemented instructions\n    fn inst_mov_a_x(\u0026mut self) {\n        self.regs.a = self.regs.x;\n        self.cycles += 2;\n    }\n    fn inst_mov_a_y(\u0026mut self) {\n        self.regs.a = self.regs.y;\n        self.cycles += 2;\n    }\n    fn inst_mov_x_a(\u0026mut self) {\n        self.regs.x = self.regs.a;\n        self.cycles += 2;\n    }\n    fn inst_mov_y_a(\u0026mut self) {\n        self.regs.y = self.regs.a;\n        self.cycles += 2;\n    }\n    fn inst_nop(\u0026mut self) {\n        self.cycles += 2;\n    }\n\n    pub fn inst_lda_imm(\u0026mut self, mem: \u0026Memory) {\n        self.regs.a = self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n\n    pub fn inst_ldx_imm(\u0026mut self, mem: \u0026Memory) {\n        self.regs.x = self.read_immediate(mem);\n        self.set_zn_flags(self.regs.x);\n        self.cycles += 2;\n    }\n\n    pub fn inst_ldy_imm(\u0026mut self, mem: \u0026Memory) {\n        self.regs.y = self.read_immediate(mem);\n        self.set_zn_flags(self.regs.y);\n        self.cycles += 2;\n    }\n\n    pub fn inst_sta_abs(\u0026mut self, mem: \u0026mut Memory) {\n        // Read the 16-bit address in little-endian\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        // Move PC past the operand\n        self.regs.pc = self.regs.pc.wrapping_add(2);\n    \n        // Store A into memory\n        mem.write8(addr, self.regs.a);\n    \n        // Increment cycles\n        self.cycles += 4;\n    }\n    \n    pub fn inst_stx_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n    \n        mem.write8(addr, self.regs.x);\n        self.cycles += 4;\n    }\n    \n    pub fn inst_sty_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n    \n        mem.write8(addr, self.regs.y);\n        self.cycles += 4;\n    }\n\n    pub fn inst_lda_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n        self.regs.a = mem.read8(addr as u16);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 4;\n    }\n    \n    pub fn inst_ldx_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n        self.regs.x = mem.read8(addr as u16);\n        self.set_zn_flags(self.regs.x);\n        self.cycles += 4;\n    }\n    \n    pub fn inst_ldy_abs(\u0026mut self, mem: \u0026mut Memory) {\n        let lo = mem.read8(self.regs.pc) as u16;\n        let hi = mem.read8(self.regs.pc.wrapping_add(1)) as u16;\n        let addr = lo | (hi \u003c\u003c 8);\n    \n        self.regs.pc = self.regs.pc.wrapping_add(2);\n        self.regs.y = mem.read8(addr as u16);\n        self.set_zn_flags(self.regs.y);\n        self.cycles += 4;\n    }    \n\n    // Load accumulator from direct page\n    pub fn inst_lda_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        self.regs.a = mem.read8(addr);\n    \n        self.set_zn_flags(self.regs.a);\n        self.cycles += 3;\n    }\n    \n    pub fn inst_ldx_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        self.regs.x = mem.read8(addr);\n    \n        self.set_zn_flags(self.regs.x);\n        self.cycles += 3;\n    }\n    \n    pub fn inst_ldy_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        self.regs.y = mem.read8(addr);\n    \n        self.set_zn_flags(self.regs.y);\n        self.cycles += 3;\n    }\n    \n    pub fn inst_sta_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        mem.write8(addr, self.regs.a);\n    \n        self.cycles += 3;\n    }\n    \n    pub fn inst_stx_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        mem.write8(addr, self.regs.x);\n    \n        self.cycles += 3;\n    }\n    \n    pub fn inst_sty_dp(\u0026mut self, mem: \u0026mut Memory) {\n        let offset = mem.read8(self.regs.pc) as u16;\n        self.regs.pc = self.regs.pc.wrapping_add(1);\n    \n        let addr = self.dp_base() | offset;\n        mem.write8(addr, self.regs.y);\n    \n        self.cycles += 3;\n    }    \n\n    pub fn inst_adc_imm(\u0026mut self, mem: \u0026mut Memory) {\n        let value = self.read_immediate(mem);\n\n        let carry_in = if self.get_flag(FLAG_C) { 1 } else { 0 };\n        let result = self.regs.a as u16 + value as u16 + carry_in as u16;\n\n        // Update flags\n        self.set_flag(FLAG_C, result \u003e 0xFF);\n        let result_u8 = result as u8;\n        self.set_zn_flags(result_u8);\n\n        // Overflow flag\n        self.set_flag(\n            FLAG_V,\n            (!(self.regs.a ^ value) \u0026 (self.regs.a ^ result_u8) \u0026 0x80) != 0,\n        );\n\n        self.regs.a = result_u8;\n        self.cycles += 2;\n    }\n\n    /// Compare memory with accumulator (sets flags only)\n    pub fn inst_cmp_imm(\u0026mut self, mem: \u0026mut Memory) {\n        let value = self.read_immediate(mem);\n\n        let result = self.regs.a.wrapping_sub(value);\n\n        self.set_flag(FLAG_C, self.regs.a \u003e= value);\n        self.set_zn_flags(result);\n\n        self.cycles += 2;\n    }\n\n    pub fn inst_sbc_imm(\u0026mut self, mem: \u0026mut Memory) {\n        let value = self.read_immediate(mem);\n\n        let carry_in = if self.get_flag(FLAG_C) { 0 } else { 1 }; // SPC700 uses inverted carry\n        let result = self.regs.a as i16 - value as i16 - carry_in as i16;\n\n        self.set_flag(FLAG_C, result \u003e= 0);\n        let result_u8 = result as u8;\n        self.set_zn_flags(result_u8);\n        self.set_flag(\n            FLAG_V,\n            ((self.regs.a ^ result_u8) \u0026 (self.regs.a ^ value) \u0026 0x80) != 0,\n        );\n\n        self.regs.a = result_u8;\n        self.cycles += 2;\n    }\n\n    /// Bitwise AND with accumulator\n    pub fn inst_and_imm(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.a \u0026= self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n\n    /// Bitwise OR with accumulator\n    pub fn inst_ora_imm(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.a |= self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n\n    /// Bitwise XOR with accumulator\n    pub fn inst_eor_imm(\u0026mut self, mem: \u0026mut Memory) {\n        self.regs.a ^= self.read_immediate(mem);\n        self.set_zn_flags(self.regs.a);\n        self.cycles += 2;\n    }\n}\n","traces":[{"line":29,"address":[347920],"length":1,"stats":{"Line":13}},{"line":31,"address":[43262],"length":1,"stats":{"Line":13}},{"line":36,"address":[348000],"length":1,"stats":{"Line":0}},{"line":37,"address":[348032],"length":1,"stats":{"Line":0}},{"line":38,"address":[348051],"length":1,"stats":{"Line":0}},{"line":39,"address":[348055],"length":1,"stats":{"Line":0}},{"line":42,"address":[348064],"length":1,"stats":{"Line":9}},{"line":43,"address":[43435],"length":1,"stats":{"Line":9}},{"line":44,"address":[348127],"length":1,"stats":{"Line":12}},{"line":46,"address":[348147],"length":1,"stats":{"Line":12}},{"line":47,"address":[348590],"length":1,"stats":{"Line":1}},{"line":50,"address":[43928],"length":1,"stats":{"Line":1}},{"line":51,"address":[348620],"length":1,"stats":{"Line":1}},{"line":52,"address":[348635],"length":1,"stats":{"Line":1}},{"line":53,"address":[348650],"length":1,"stats":{"Line":1}},{"line":56,"address":[348670],"length":1,"stats":{"Line":1}},{"line":57,"address":[348691],"length":1,"stats":{"Line":1}},{"line":58,"address":[348712],"length":1,"stats":{"Line":1}},{"line":61,"address":[348733],"length":1,"stats":{"Line":1}},{"line":62,"address":[348754],"length":1,"stats":{"Line":1}},{"line":63,"address":[348775],"length":1,"stats":{"Line":1}},{"line":66,"address":[348796],"length":1,"stats":{"Line":1}},{"line":67,"address":[348817],"length":1,"stats":{"Line":0}},{"line":68,"address":[348838],"length":1,"stats":{"Line":0}},{"line":71,"address":[348859],"length":1,"stats":{"Line":1}},{"line":72,"address":[348880],"length":1,"stats":{"Line":1}},{"line":73,"address":[348901],"length":1,"stats":{"Line":1}},{"line":74,"address":[348919],"length":1,"stats":{"Line":1}},{"line":77,"address":[348937],"length":1,"stats":{"Line":0}},{"line":78,"address":[348955],"length":1,"stats":{"Line":0}},{"line":79,"address":[348973],"length":1,"stats":{"Line":0}},{"line":80,"address":[348991],"length":1,"stats":{"Line":0}},{"line":81,"address":[349009],"length":1,"stats":{"Line":0}},{"line":82,"address":[349027],"length":1,"stats":{"Line":0}},{"line":90,"address":[349056],"length":1,"stats":{"Line":3}},{"line":91,"address":[349110,349088],"length":1,"stats":{"Line":12}},{"line":92,"address":[349121],"length":1,"stats":{"Line":2}},{"line":94,"address":[44397],"length":1,"stats":{"Line":3}},{"line":98,"address":[349136],"length":1,"stats":{"Line":3}},{"line":99,"address":[349148],"length":1,"stats":{"Line":3}},{"line":102,"address":[349168],"length":1,"stats":{"Line":2}},{"line":103,"address":[349193],"length":1,"stats":{"Line":2}},{"line":104,"address":[349227],"length":1,"stats":{"Line":1}},{"line":107,"address":[349264],"length":1,"stats":{"Line":1}},{"line":108,"address":[44569,44590],"length":1,"stats":{"Line":2}},{"line":109,"address":[44592],"length":1,"stats":{"Line":0}},{"line":111,"address":[44583],"length":1,"stats":{"Line":2}},{"line":116,"address":[349328],"length":1,"stats":{"Line":8}},{"line":117,"address":[349360],"length":1,"stats":{"Line":8}},{"line":118,"address":[349382],"length":1,"stats":{"Line":8}},{"line":123,"address":[349424],"length":1,"stats":{"Line":0}},{"line":124,"address":[44744],"length":1,"stats":{"Line":0}},{"line":125,"address":[44772],"length":1,"stats":{"Line":0}},{"line":126,"address":[44792],"length":1,"stats":{"Line":0}},{"line":130,"address":[44816],"length":1,"stats":{"Line":1}},{"line":131,"address":[44829],"length":1,"stats":{"Line":1}},{"line":132,"address":[44835,44866],"length":1,"stats":{"Line":1}},{"line":134,"address":[44880],"length":1,"stats":{"Line":1}},{"line":135,"address":[44893],"length":1,"stats":{"Line":1}},{"line":136,"address":[44930,44899],"length":1,"stats":{"Line":1}},{"line":138,"address":[349648],"length":1,"stats":{"Line":1}},{"line":139,"address":[349661],"length":1,"stats":{"Line":1}},{"line":140,"address":[44963,44994],"length":1,"stats":{"Line":1}},{"line":142,"address":[349712],"length":1,"stats":{"Line":1}},{"line":143,"address":[45021],"length":1,"stats":{"Line":1}},{"line":144,"address":[349762,349731],"length":1,"stats":{"Line":1}},{"line":146,"address":[45072],"length":1,"stats":{"Line":1}},{"line":147,"address":[45085,45116],"length":1,"stats":{"Line":1}},{"line":150,"address":[349840],"length":1,"stats":{"Line":1}},{"line":151,"address":[349859],"length":1,"stats":{"Line":1}},{"line":152,"address":[349874],"length":1,"stats":{"Line":1}},{"line":153,"address":[349891,349923],"length":1,"stats":{"Line":1}},{"line":156,"address":[349936],"length":1,"stats":{"Line":1}},{"line":157,"address":[349955],"length":1,"stats":{"Line":1}},{"line":158,"address":[349970],"length":1,"stats":{"Line":1}},{"line":159,"address":[349987,350019],"length":1,"stats":{"Line":1}},{"line":162,"address":[350032],"length":1,"stats":{"Line":1}},{"line":163,"address":[350051],"length":1,"stats":{"Line":1}},{"line":164,"address":[350066],"length":1,"stats":{"Line":1}},{"line":165,"address":[45411,45379],"length":1,"stats":{"Line":1}},{"line":168,"address":[350128],"length":1,"stats":{"Line":1}},{"line":170,"address":[350163],"length":1,"stats":{"Line":1}},{"line":171,"address":[350190],"length":1,"stats":{"Line":1}},{"line":172,"address":[350237],"length":1,"stats":{"Line":1}},{"line":175,"address":[350254],"length":1,"stats":{"Line":1}},{"line":178,"address":[350288],"length":1,"stats":{"Line":1}},{"line":181,"address":[350338,350306],"length":1,"stats":{"Line":1}},{"line":184,"address":[350352],"length":1,"stats":{"Line":1}},{"line":185,"address":[350387],"length":1,"stats":{"Line":1}},{"line":186,"address":[350414],"length":1,"stats":{"Line":1}},{"line":187,"address":[350461],"length":1,"stats":{"Line":1}},{"line":189,"address":[350478],"length":1,"stats":{"Line":1}},{"line":191,"address":[350512],"length":1,"stats":{"Line":1}},{"line":192,"address":[45823,45855],"length":1,"stats":{"Line":1}},{"line":195,"address":[350576],"length":1,"stats":{"Line":1}},{"line":196,"address":[350611],"length":1,"stats":{"Line":1}},{"line":197,"address":[350638],"length":1,"stats":{"Line":1}},{"line":198,"address":[350685],"length":1,"stats":{"Line":1}},{"line":200,"address":[350702],"length":1,"stats":{"Line":1}},{"line":202,"address":[350736],"length":1,"stats":{"Line":1}},{"line":203,"address":[350786,350754],"length":1,"stats":{"Line":1}},{"line":206,"address":[46096],"length":1,"stats":{"Line":1}},{"line":207,"address":[350835],"length":1,"stats":{"Line":1}},{"line":208,"address":[350862],"length":1,"stats":{"Line":1}},{"line":209,"address":[350909],"length":1,"stats":{"Line":1}},{"line":211,"address":[350926],"length":1,"stats":{"Line":1}},{"line":212,"address":[350960],"length":1,"stats":{"Line":1}},{"line":213,"address":[350979],"length":1,"stats":{"Line":1}},{"line":214,"address":[46289,46321],"length":1,"stats":{"Line":1}},{"line":217,"address":[351056],"length":1,"stats":{"Line":1}},{"line":218,"address":[46371],"length":1,"stats":{"Line":1}},{"line":219,"address":[351118],"length":1,"stats":{"Line":1}},{"line":220,"address":[46443],"length":1,"stats":{"Line":1}},{"line":222,"address":[46460],"length":1,"stats":{"Line":1}},{"line":223,"address":[46494],"length":1,"stats":{"Line":1}},{"line":224,"address":[351235],"length":1,"stats":{"Line":1}},{"line":225,"address":[46561,46529],"length":1,"stats":{"Line":1}},{"line":228,"address":[46576],"length":1,"stats":{"Line":1}},{"line":229,"address":[351347],"length":1,"stats":{"Line":1}},{"line":230,"address":[351374],"length":1,"stats":{"Line":1}},{"line":231,"address":[351421],"length":1,"stats":{"Line":1}},{"line":233,"address":[46700],"length":1,"stats":{"Line":1}},{"line":234,"address":[351472],"length":1,"stats":{"Line":1}},{"line":235,"address":[46752],"length":1,"stats":{"Line":1}},{"line":236,"address":[351508,351540],"length":1,"stats":{"Line":1}},{"line":240,"address":[351568],"length":1,"stats":{"Line":1}},{"line":241,"address":[351605],"length":1,"stats":{"Line":1}},{"line":242,"address":[46879],"length":1,"stats":{"Line":1}},{"line":244,"address":[351653],"length":1,"stats":{"Line":1}},{"line":245,"address":[46923],"length":1,"stats":{"Line":1}},{"line":247,"address":[351695],"length":1,"stats":{"Line":1}},{"line":248,"address":[351712,351744],"length":1,"stats":{"Line":1}},{"line":251,"address":[47008],"length":1,"stats":{"Line":0}},{"line":252,"address":[351797],"length":1,"stats":{"Line":0}},{"line":253,"address":[47071],"length":1,"stats":{"Line":0}},{"line":255,"address":[351845],"length":1,"stats":{"Line":0}},{"line":256,"address":[351868],"length":1,"stats":{"Line":0}},{"line":258,"address":[351887],"length":1,"stats":{"Line":0}},{"line":259,"address":[351904,351936],"length":1,"stats":{"Line":0}},{"line":262,"address":[351952],"length":1,"stats":{"Line":0}},{"line":263,"address":[47237],"length":1,"stats":{"Line":0}},{"line":264,"address":[352016],"length":1,"stats":{"Line":0}},{"line":266,"address":[352037],"length":1,"stats":{"Line":0}},{"line":267,"address":[352060],"length":1,"stats":{"Line":0}},{"line":269,"address":[47325],"length":1,"stats":{"Line":0}},{"line":270,"address":[47342,47374],"length":1,"stats":{"Line":0}},{"line":273,"address":[352144],"length":1,"stats":{"Line":1}},{"line":274,"address":[47429],"length":1,"stats":{"Line":1}},{"line":275,"address":[352208],"length":1,"stats":{"Line":1}},{"line":277,"address":[47476],"length":1,"stats":{"Line":1}},{"line":278,"address":[352260],"length":1,"stats":{"Line":1}},{"line":280,"address":[352310,352278],"length":1,"stats":{"Line":1}},{"line":283,"address":[352336],"length":1,"stats":{"Line":0}},{"line":284,"address":[47621],"length":1,"stats":{"Line":0}},{"line":285,"address":[352400],"length":1,"stats":{"Line":0}},{"line":287,"address":[352421],"length":1,"stats":{"Line":0}},{"line":288,"address":[47699],"length":1,"stats":{"Line":0}},{"line":290,"address":[352470,352502],"length":1,"stats":{"Line":0}},{"line":293,"address":[352528],"length":1,"stats":{"Line":0}},{"line":294,"address":[47813],"length":1,"stats":{"Line":0}},{"line":295,"address":[47839],"length":1,"stats":{"Line":0}},{"line":297,"address":[352613],"length":1,"stats":{"Line":0}},{"line":298,"address":[47891],"length":1,"stats":{"Line":0}},{"line":300,"address":[352662,352694],"length":1,"stats":{"Line":0}},{"line":303,"address":[352720],"length":1,"stats":{"Line":3}},{"line":304,"address":[47987],"length":1,"stats":{"Line":3}},{"line":306,"address":[352757],"length":1,"stats":{"Line":3}},{"line":307,"address":[352799,353011],"length":1,"stats":{"Line":3}},{"line":310,"address":[48126],"length":1,"stats":{"Line":3}},{"line":311,"address":[352920],"length":1,"stats":{"Line":1}},{"line":312,"address":[352924],"length":1,"stats":{"Line":3}},{"line":315,"address":[352962],"length":1,"stats":{"Line":3}},{"line":317,"address":[48188],"length":1,"stats":{"Line":3}},{"line":320,"address":[352991],"length":1,"stats":{"Line":3}},{"line":321,"address":[353041,353033,352994],"length":1,"stats":{"Line":6}},{"line":325,"address":[48304],"length":1,"stats":{"Line":3}},{"line":326,"address":[353075],"length":1,"stats":{"Line":3}},{"line":328,"address":[48341],"length":1,"stats":{"Line":3}},{"line":330,"address":[353124],"length":1,"stats":{"Line":3}},{"line":331,"address":[353159],"length":1,"stats":{"Line":2}},{"line":333,"address":[353172,353204],"length":1,"stats":{"Line":3}},{"line":336,"address":[353232],"length":1,"stats":{"Line":2}},{"line":337,"address":[353251],"length":1,"stats":{"Line":2}},{"line":339,"address":[48501],"length":1,"stats":{"Line":2}},{"line":340,"address":[48744,48542],"length":1,"stats":{"Line":2}},{"line":342,"address":[353391],"length":1,"stats":{"Line":2}},{"line":343,"address":[353432],"length":1,"stats":{"Line":2}},{"line":344,"address":[353436],"length":1,"stats":{"Line":2}},{"line":345,"address":[353472],"length":1,"stats":{"Line":2}},{"line":347,"address":[353457],"length":1,"stats":{"Line":2}},{"line":350,"address":[48724],"length":1,"stats":{"Line":2}},{"line":351,"address":[353504,353543,353551],"length":1,"stats":{"Line":4}},{"line":355,"address":[353568],"length":1,"stats":{"Line":1}},{"line":356,"address":[353587],"length":1,"stats":{"Line":1}},{"line":357,"address":[353605],"length":1,"stats":{"Line":1}},{"line":358,"address":[353622,353654],"length":1,"stats":{"Line":1}},{"line":362,"address":[48912],"length":1,"stats":{"Line":1}},{"line":363,"address":[353699],"length":1,"stats":{"Line":1}},{"line":364,"address":[353717],"length":1,"stats":{"Line":1}},{"line":365,"address":[353766,353734],"length":1,"stats":{"Line":1}},{"line":369,"address":[353792],"length":1,"stats":{"Line":1}},{"line":370,"address":[353811],"length":1,"stats":{"Line":1}},{"line":371,"address":[353829],"length":1,"stats":{"Line":1}},{"line":372,"address":[353846,353878],"length":1,"stats":{"Line":1}}],"covered":161,"coverable":204},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","dsp.rs"],"content":"use crate::memory::Memory;\n\n/// Voice of the SNES APU DSP\n#[derive(Debug, Clone, Copy)]\npub struct Voice {\n    pub left_vol: u8,\n    pub right_vol: u8,\n    pub pitch: u16,\n    pub key_on: bool,\n    pub sample_start: u16,\n    pub sample_end: u16,\n    pub current_addr: u16,\n    pub frac: u16,          // fractional accumulator for pitch stepping\n    pub current_sample: i8, // last fetched sample\n}\n\nimpl Default for Voice {\n    fn default() -\u003e Self {\n        Self {\n            left_vol: 0,\n            right_vol: 0,\n            pitch: 0,\n            key_on: false,\n            sample_start: 0,\n            sample_end: 0,\n            current_addr: 0,\n            frac: 0,\n            current_sample: 0,\n        }\n    }\n}\n\npub struct Dsp {\n    registers: [u8; 128], // $F200-$F27F\n    pub voices: [Voice; 8],\n}\n\nimpl Dsp {\n    pub fn new() -\u003e Self {\n        Self {\n            registers: [0; 128],\n            voices: [Voice::default(); 8],\n        }\n    }\n\n    /// Read DSP register (memory-mapped)\n    pub fn read(\u0026self, addr: u16) -\u003e u8 {\n        let index = (addr - 0xF200) as usize;\n        self.registers[index]\n    }\n\n    /// Write DSP register (memory-mapped)\n    pub fn write(\u0026mut self, addr: u16, value: u8) {\n        // Make sure addr is in the valid DSP register range\n        if addr \u003c 0xF200 || (addr as usize) \u003e= 0xF200 + self.registers.len() {\n            // return could be used instead of panicking if more verif is added\n            panic!(\"Invalid DSP write address: {:#X}\", addr);\n        }\n    \n        let index = (addr - 0xF200) as usize;\n        self.registers[index] = value;\n    \n        match index {\n            // 0x00..=0x07: Left volume for each voice\n            // Registers 0x00..0x07 directly map to the `left_vol` field of each voice.\n            0x00..=0x07 =\u003e self.voices[index].left_vol = value,\n    \n            // 0x08..=0x0F: Right volume for each voice\n            // Same idea as left volume, but offset by 8.\n            0x08..=0x0F =\u003e self.voices[index - 0x08].right_vol = value,\n    \n            // 0x10..=0x17: Pitch low byte\n            // Sets the low 8 bits of the pitch value.\n            // The high 8 bits are updated separately at 0x18..=0x1F.\n            0x10..=0x17 =\u003e {\n                let voice_idx = index - 0x10;\n                let pitch = (self.voices[voice_idx].pitch \u0026 0xFF00) | value as u16;\n                self.voices[voice_idx].pitch = pitch;\n            }\n    \n            // 0x18..=0x1F: Pitch high byte\n            // Sets the high 8 bits of the pitch value.\n            0x18..=0x1F =\u003e {\n                let voice_idx = index - 0x18;\n                let pitch = ((value as u16) \u003c\u003c 8) | (self.voices[voice_idx].pitch \u0026 0x00FF);\n                self.voices[voice_idx].pitch = pitch;\n            }\n    \n            // 0x20..=0x27: Key On\n            // Writing a nonzero value starts playback for the corresponding voice.\n            // This also resets the current address to `sample_start`\n            // and clears the fractional accumulator.\n            // Writing zero turns the voice off.\n            0x20..=0x27 =\u003e {\n                let voice_idx = index - 0x20;\n                self.voices[voice_idx].key_on = value != 0;\n                if value != 0 {\n                    self.voices[voice_idx].current_addr = self.voices[voice_idx].sample_start;\n                    self.voices[voice_idx].frac = 0;\n                }\n            }\n    \n            // 0x30..=0x37: Sample Start (low byte)\n            // Sets the low 8 bits of the sample start address.\n            0x30..=0x37 =\u003e {\n                let voice_idx = index - 0x30;\n                self.voices[voice_idx].sample_start =\n                    (self.voices[voice_idx].sample_start \u0026 0xFF00) | value as u16;\n            }\n    \n            // 0x38..=0x3F: Sample End (low byte)\n            // Sets the low 8 bits of the sample end address.\n            0x38..=0x3F =\u003e {\n                let voice_idx = index - 0x38;\n                self.voices[voice_idx].sample_end =\n                    (self.voices[voice_idx].sample_end \u0026 0xFF00) | value as u16;\n            }\n    \n            _ =\u003e {} // Other registers (echo, ADSR, etc.) not implemented yet\n        }    \n    }    \n\n    /// Step DSP one tick (process voices)\n    pub fn step(\u0026mut self, mem: \u0026Memory) {\n        for voice in self.voices.iter_mut() {\n            if !voice.key_on {\n                continue;\n            }\n    \n            // Advance fractional accumulator\n            voice.frac = voice.frac.wrapping_add(voice.pitch);\n            let step = voice.frac \u003e\u003e 8; // integer increment\n            voice.frac \u0026= 0xFF;         // keep fractional\n    \n            // Advance current address\n            voice.current_addr = voice.current_addr.wrapping_add(step);\n    \n            // Stop if we reach the end of the sample\n            if voice.current_addr \u003e= voice.sample_end {\n                voice.key_on = false;\n            } else {\n                // Fetch sample from memory after stepping\n                voice.current_sample = mem.read8(voice.current_addr) as i8;\n            }\n        }\n    }    \n\n    /// Mix all voices into a stereo output buffer\n    pub fn render_audio(\u0026self, num_samples: usize) -\u003e Vec\u003c(i16, i16)\u003e {\n        let mut buffer = vec![(0i16, 0i16); num_samples];\n\n        for voice in \u0026self.voices {\n            if voice.key_on {\n                let left_vol = voice.left_vol as i32;\n                let right_vol = voice.right_vol as i32;\n                let sample_val = voice.current_sample as i32;\n\n                for sample in \u0026mut buffer {\n                    sample.0 = (sample.0 as i32 + sample_val * left_vol)\n                        .clamp(i16::MIN as i32, i16::MAX as i32) as i16;\n                    sample.1 = (sample.1 as i32 + sample_val * right_vol)\n                        .clamp(i16::MIN as i32, i16::MAX as i32) as i16;\n                }\n            }\n        }\n        buffer\n    }\n}\n","traces":[{"line":18,"address":[344192],"length":1,"stats":{"Line":25}},{"line":39,"address":[344256],"length":1,"stats":{"Line":28}},{"line":41,"address":[339249],"length":1,"stats":{"Line":27}},{"line":42,"address":[343602],"length":1,"stats":{"Line":21}},{"line":47,"address":[344464],"length":1,"stats":{"Line":1}},{"line":48,"address":[343798,343845],"length":1,"stats":{"Line":1}},{"line":49,"address":[38875,38922,38908],"length":1,"stats":{"Line":2}},{"line":53,"address":[344592],"length":1,"stats":{"Line":1}},{"line":55,"address":[343945,344119],"length":1,"stats":{"Line":4}},{"line":57,"address":[344679],"length":1,"stats":{"Line":0}},{"line":60,"address":[344198,344143],"length":1,"stats":{"Line":2}},{"line":61,"address":[344225,344188,344243],"length":1,"stats":{"Line":2}},{"line":66,"address":[339947,339893,341368],"length":1,"stats":{"Line":5}},{"line":70,"address":[346305,344954,345019],"length":1,"stats":{"Line":6}},{"line":75,"address":[344314,344391],"length":1,"stats":{"Line":2}},{"line":76,"address":[345467,344402,345451],"length":1,"stats":{"Line":4}},{"line":77,"address":[346229,346147,346182],"length":1,"stats":{"Line":4}},{"line":78,"address":[345594,345574,345528],"length":1,"stats":{"Line":4}},{"line":83,"address":[344451,344374],"length":1,"stats":{"Line":2}},{"line":84,"address":[345150,345963,345991],"length":1,"stats":{"Line":4}},{"line":85,"address":[346063,346019,345971],"length":1,"stats":{"Line":2}},{"line":86,"address":[345428,345408,345362],"length":1,"stats":{"Line":4}},{"line":94,"address":[340175,340098],"length":1,"stats":{"Line":2}},{"line":95,"address":[345012,344996,344522],"length":1,"stats":{"Line":2}},{"line":96,"address":[345072,345004,345039],"length":1,"stats":{"Line":2}},{"line":97,"address":[345238,345057],"length":1,"stats":{"Line":2}},{"line":98,"address":[345095,345197],"length":1,"stats":{"Line":1}},{"line":99,"address":[345936,345872,345913],"length":1,"stats":{"Line":2}},{"line":105,"address":[340158,340235],"length":1,"stats":{"Line":2}},{"line":106,"address":[344842,344826,344582],"length":1,"stats":{"Line":2}},{"line":107,"address":[39937,39988,40012],"length":1,"stats":{"Line":2}},{"line":108,"address":[344869,344834,344911],"length":1,"stats":{"Line":2}},{"line":113,"address":[39593,39661],"length":1,"stats":{"Line":2}},{"line":114,"address":[340297,340336],"length":1,"stats":{"Line":1}},{"line":115,"address":[340392,340443,340467],"length":1,"stats":{"Line":2}},{"line":116,"address":[345352,345387,345429],"length":1,"stats":{"Line":2}},{"line":124,"address":[345744],"length":1,"stats":{"Line":1}},{"line":125,"address":[346451,346484],"length":1,"stats":{"Line":2}},{"line":126,"address":[345854],"length":1,"stats":{"Line":1}},{"line":131,"address":[40908],"length":1,"stats":{"Line":1}},{"line":132,"address":[40931],"length":1,"stats":{"Line":1}},{"line":133,"address":[40944],"length":1,"stats":{"Line":1}},{"line":136,"address":[345920],"length":1,"stats":{"Line":2}},{"line":139,"address":[345940,345991,345978],"length":1,"stats":{"Line":6}},{"line":140,"address":[41023],"length":1,"stats":{"Line":2}},{"line":143,"address":[341623],"length":1,"stats":{"Line":2}},{"line":149,"address":[41801,41795,41040],"length":1,"stats":{"Line":2}},{"line":150,"address":[341705],"length":1,"stats":{"Line":2}},{"line":152,"address":[346762,346849],"length":1,"stats":{"Line":2}},{"line":153,"address":[341930],"length":1,"stats":{"Line":1}},{"line":154,"address":[346332],"length":1,"stats":{"Line":1}},{"line":155,"address":[41371],"length":1,"stats":{"Line":1}},{"line":156,"address":[41386],"length":1,"stats":{"Line":1}},{"line":158,"address":[347065,347470],"length":1,"stats":{"Line":2}},{"line":159,"address":[346533,346622,346657],"length":1,"stats":{"Line":2}},{"line":160,"address":[342261],"length":1,"stats":{"Line":2}},{"line":161,"address":[346660,346778,346748],"length":1,"stats":{"Line":2}},{"line":162,"address":[347411],"length":1,"stats":{"Line":1}},{"line":166,"address":[346972],"length":1,"stats":{"Line":1}}],"covered":58,"coverable":59},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","lib.rs"],"content":"pub mod cpu;\npub mod dsp;\npub mod memory;\npub mod timers;\npub mod apu;\n\npub use apu::Apu;\npub use cpu::Spc700;\npub use memory::Memory;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","memory.rs"],"content":"use crate::dsp::Dsp;\n\npub struct Memory {\n    pub ram: [u8; 64 * 1024], // 64KB APU RAM\n    pub dsp: Dsp,             // DSP registers\n}\n\nimpl Memory {\n    pub fn new() -\u003e Self {\n        Self {\n            ram: [0; 64 * 1024],\n            dsp: Dsp::new(),\n        }\n    }\n\n    pub fn read8(\u0026self, addr: u16) -\u003e u8 {\n        // DSP memory-mapped registers\n        if (0xF200..=0xF27F).contains(\u0026addr) {\n            self.dsp.read(addr)\n        } else {\n            self.ram[addr as usize]\n        }\n    }\n\n    pub fn read16(\u0026self, addr: u16) -\u003e u16 {\n        let lo = self.read8(addr) as u16;\n        let hi = self.read8(addr.wrapping_add(1)) as u16;\n        (hi \u003c\u003c 8) | lo\n    }\n\n    pub fn write8(\u0026mut self, addr: u16, val: u8) {\n        if (0xF200..=0xF27F).contains(\u0026addr) {\n            self.dsp.write(addr, val);\n        } else {\n            self.ram[addr as usize] = val;\n        }\n    }\n\n    pub fn write16(\u0026mut self, addr: u16, value: u16) {\n        let lo = (value \u0026 0xFF) as u8;\n        let hi = (value \u003e\u003e 8) as u8;\n        self.write8(addr, lo);\n        self.write8(addr.wrapping_add(1), hi);\n    }\n}\n","traces":[{"line":9,"address":[343504],"length":1,"stats":{"Line":8}},{"line":11,"address":[343551],"length":1,"stats":{"Line":8}},{"line":12,"address":[343568],"length":1,"stats":{"Line":21}},{"line":16,"address":[343648],"length":1,"stats":{"Line":11}},{"line":18,"address":[343670,343755],"length":1,"stats":{"Line":33}},{"line":19,"address":[55076],"length":1,"stats":{"Line":0}},{"line":21,"address":[338236,338288,338306],"length":1,"stats":{"Line":41}},{"line":25,"address":[343792],"length":1,"stats":{"Line":0}},{"line":26,"address":[338363],"length":1,"stats":{"Line":0}},{"line":27,"address":[55207],"length":1,"stats":{"Line":0}},{"line":28,"address":[55246],"length":1,"stats":{"Line":0}},{"line":31,"address":[338448],"length":1,"stats":{"Line":21}},{"line":32,"address":[343936,344022],"length":1,"stats":{"Line":42}},{"line":33,"address":[343986],"length":1,"stats":{"Line":0}},{"line":35,"address":[342838,342895,342908],"length":1,"stats":{"Line":42}},{"line":39,"address":[338608],"length":1,"stats":{"Line":3}},{"line":40,"address":[344096],"length":1,"stats":{"Line":3}},{"line":41,"address":[338651],"length":1,"stats":{"Line":3}},{"line":42,"address":[344119],"length":1,"stats":{"Line":3}},{"line":43,"address":[344136],"length":1,"stats":{"Line":3}}],"covered":14,"coverable":20},{"path":["/","home","cbaziret","devel","eip","r-snes","apu","src","timers.rs"],"content":"use crate::memory::Memory;\n\npub struct Timers;\n\nimpl Timers {\n    pub fn new() -\u003e Self {\n        Self\n    }\n\n    pub fn step(\u0026mut self, _mem: \u0026mut Memory) {\n        // TODO: implement timer logic\n    }\n}\n","traces":[{"line":10,"address":[51840],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":1},{"path":["/","home","cbaziret","devel","eip","r-snes","common","src","lib.rs"],"content":"pub mod snes_address;\npub mod u16_split;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","common","src","snes_address.rs"],"content":"use std::convert::From;\n\n/// Common struct used to represent memory addresses in the global\n/// SNES adddress space.\n///\n/// The address space is split in 256 64Ko banks.\n#[derive(Debug, Copy, Clone, Eq, PartialEq, Default)]\npub struct SnesAddress {\n    /// The bank number of the address\n    pub bank: u8,\n\n    /// The memory address within the bank\n    pub addr: u16,\n}\n\nimpl From\u003cSnesAddress\u003e for usize {\n    fn from(addr: SnesAddress) -\u003e usize {\n        ((addr.bank as usize) \u003c\u003c 16) | (addr.addr as usize)\n    }\n}\n\nimpl From\u003cusize\u003e for SnesAddress {\n    /// If value is larger than 24 bits, only the lowest 24 bits are used and\n    /// the excess bits are ignored.\n    fn from(value: usize) -\u003e SnesAddress {\n        SnesAddress {\n            bank: ((value \u003e\u003e 16) \u0026 0xFF) as u8,\n            addr: (value \u0026 0xFFFF) as u16,\n        }\n    }\n}\n\nimpl SnesAddress {\n    /// Increment the memory address stored in [`self`]\n    ///\n    /// Returns whether the increment caused a bank change.\n    pub fn increment(\u0026mut self) -\u003e bool {\n        self.addr = self.addr.wrapping_add(1);\n\n        if self.addr != 0 {\n            return false;\n        }\n        self.bank = self.bank.wrapping_add(1);\n        true\n    }\n\n    /// Decrement the memory address stored in [`self`]\n    ///\n    /// Returns whether the decrement caused a bank change.\n    pub fn decrement(\u0026mut self) -\u003e bool {\n        self.addr = self.addr.wrapping_sub(1);\n\n        if self.addr != u16::MAX {\n            return false;\n        }\n        self.bank = self.bank.wrapping_sub(1);\n        true\n    }\n}\n\n#[cfg(test)]\nmod test {\n    use std::u16;\n\n    use super::*;\n\n    #[test]\n    fn test_simple_increment() {\n        let mut addr = SnesAddress { bank: 0, addr: 1 };\n        assert!(!addr.increment());\n\n        assert_eq!(addr, SnesAddress { bank: 0, addr: 2 });\n    }\n\n    #[test]\n    fn test_simple_decrement() {\n        let mut addr = SnesAddress { bank: 0, addr: 1 };\n        assert!(!addr.decrement());\n\n        assert_eq!(addr, SnesAddress { bank: 0, addr: 0 });\n    }\n\n    #[test]\n    fn test_wrapping_increment() {\n        let mut addr = SnesAddress {\n            bank: 3,\n            addr: u16::MAX,\n        };\n        assert!(addr.increment());\n\n        assert_eq!(addr, SnesAddress { bank: 4, addr: 0 });\n    }\n\n    #[test]\n    fn test_wrapping_decrement() {\n        let mut addr = SnesAddress { bank: 3, addr: 0 };\n        assert!(addr.decrement());\n\n        assert_eq!(\n            addr,\n            SnesAddress {\n                bank: 2,\n                addr: u16::MAX\n            }\n        );\n    }\n\n    #[test]\n    fn test_to_usize() {\n        let addr: SnesAddress = SnesAddress {\n            bank: (0xE3),\n            addr: (0x3F49),\n        };\n        let expected: usize = 0xE33F49;\n\n        assert_eq!(usize::from(addr), expected);\n    }\n\n    #[test]\n    fn test_from_usize() {\n        let nb: usize = 0x124089;\n        let expected: SnesAddress = SnesAddress {\n            bank: (0x12),\n            addr: (0x4089),\n        };\n\n        assert_eq!(SnesAddress::from(nb), expected);\n    }\n\n    #[test]\n    fn test_from_usize_too_big() {\n        let nb: usize = 0x12408993245;\n        let expected: SnesAddress = SnesAddress {\n            bank: (0x99),\n            addr: (0x3245),\n        };\n\n        assert_eq!(SnesAddress::from(nb), expected);\n    }\n\n    #[test]\n    fn test_from_usize_too_small() {\n        let nb: usize = 0x124;\n        let expected: SnesAddress = SnesAddress {\n            bank: (0x00),\n            addr: (0x0124),\n        };\n\n        assert_eq!(SnesAddress::from(nb), expected);\n    }\n}\n","traces":[{"line":17,"address":[37744],"length":1,"stats":{"Line":1}},{"line":18,"address":[37759],"length":1,"stats":{"Line":1}},{"line":25,"address":[37776],"length":1,"stats":{"Line":3}},{"line":27,"address":[37781],"length":1,"stats":{"Line":3}},{"line":28,"address":[37788],"length":1,"stats":{"Line":3}},{"line":37,"address":[37792],"length":1,"stats":{"Line":2}},{"line":38,"address":[37805],"length":1,"stats":{"Line":2}},{"line":40,"address":[37825],"length":1,"stats":{"Line":2}},{"line":41,"address":[37865],"length":1,"stats":{"Line":1}},{"line":43,"address":[37835],"length":1,"stats":{"Line":1}},{"line":44,"address":[37858],"length":1,"stats":{"Line":1}},{"line":50,"address":[37888],"length":1,"stats":{"Line":2}},{"line":51,"address":[37901],"length":1,"stats":{"Line":2}},{"line":53,"address":[37921],"length":1,"stats":{"Line":2}},{"line":54,"address":[37961],"length":1,"stats":{"Line":1}},{"line":56,"address":[37931],"length":1,"stats":{"Line":1}},{"line":57,"address":[37954],"length":1,"stats":{"Line":1}}],"covered":17,"coverable":17},{"path":["/","home","cbaziret","devel","eip","r-snes","common","src","u16_split.rs"],"content":"/// Extension trait for [`u16`] which defines additional methods\n/// allowing to \"split\" references (mutable or not) to a [`u16`] into\n/// two separate references to its individual bytes (as [`u8`]s)\npub trait U16Split {\n    /// Split an immutable reference to a [`u16`] into two\n    /// immutable references to its bytes (as [`u8`]s)\n    fn split\u003c'a\u003e(\u0026'a self) -\u003e SplitU16\u003c'a\u003e;\n    /// Split a mutable reference to a [`u16`] into two\n    /// mutable references to its bytes (as [`u8`]s)\n    fn split_mut\u003c'a\u003e(\u0026'a mut self) -\u003e SplitU16Mut\u003c'a\u003e;\n\n    /// Get an immutable reference to the least significant byte of a [`u16`]\n    fn lo\u003c'a\u003e(\u0026'a self) -\u003e \u0026'a u8 {\n        self.split().lo\n    }\n    /// Get an immutable reference to the most significant byte of a [`u16`]\n    fn hi\u003c'a\u003e(\u0026'a self) -\u003e \u0026'a u8 {\n        self.split().hi\n    }\n\n    /// Get an mutable reference to the least significant byte of a [`u16`]\n    fn lo_mut\u003c'a\u003e(\u0026'a mut self) -\u003e \u0026'a mut u8 {\n        self.split_mut().lo\n    }\n    /// Get an mutable reference to the most significant byte of a [`u16`]\n    fn hi_mut\u003c'a\u003e(\u0026'a mut self) -\u003e \u0026'a mut u8 {\n        self.split_mut().hi\n    }\n}\n\n/// Helper struct which contains two immutable references\n/// to the individual bytes of a [`u16`]\npub struct SplitU16\u003c'a\u003e {\n    /// Ref to the least signicant byte\n    pub lo: \u0026'a u8,\n    /// Ref to the most significant byte\n    pub hi: \u0026'a u8,\n}\n\n/// Helper struct which contains two immutable references\n/// to the individual bytes of a [`u16`]\npub struct SplitU16Mut\u003c'a\u003e {\n    /// Mut ref to the least significant byte\n    pub lo: \u0026'a mut u8,\n    /// Mut ref to the most significant byte\n    pub hi: \u0026'a mut u8,\n}\n\nimpl U16Split for u16 {\n    fn split\u003c'a\u003e(\u0026'a self) -\u003e SplitU16\u003c'a\u003e {\n        let first_byte_ptr = self as *const u16 as *const u8;\n        let second_byte_ptr = unsafe { first_byte_ptr.add(1) };\n        let (lo, hi) = if cfg!(target_endian = \"little\") {\n            unsafe { (\u0026*first_byte_ptr, \u0026*second_byte_ptr) }\n        } else {\n            unsafe { (\u0026*second_byte_ptr, \u0026*first_byte_ptr) }\n        };\n        SplitU16 { lo, hi }\n    }\n\n    fn split_mut\u003c'a\u003e(\u0026'a mut self) -\u003e SplitU16Mut\u003c'a\u003e {\n        let first_byte_ptr = self as *mut u16 as *mut u8;\n        let second_byte_ptr = unsafe { first_byte_ptr.add(1) };\n        let (lo, hi) = if cfg!(target_endian = \"little\") {\n            unsafe { (\u0026mut *first_byte_ptr, \u0026mut *second_byte_ptr) }\n        } else {\n            unsafe { (\u0026mut *second_byte_ptr, \u0026mut *first_byte_ptr) }\n        };\n        SplitU16Mut { lo, hi }\n    }\n}\n\n#[cfg(test)]\nmod test {\n    use super::*;\n\n    #[test]\n    fn test_split_u16() {\n        let my_u16: u16 = 0x1234;\n\n        let byte_refs = my_u16.split();\n\n        assert_eq!(*byte_refs.hi, 0x12);\n        assert_eq!(*byte_refs.lo, 0x34);\n\n        assert_eq!(my_u16, 0x1234);\n    }\n\n    #[test]\n    fn get_individual_bytes() {\n        let my_u16: u16 = 0xbeef;\n\n        assert_eq!(*my_u16.hi(), 0xbe);\n        assert_eq!(*my_u16.lo(), 0xef);\n    }\n\n    #[test]\n    fn test_split_u16_mut() {\n        let mut my_u16: u16 = 0x1234;\n\n        let byte_refs = my_u16.split_mut();\n\n        assert_eq!(*byte_refs.hi, 0x12);\n        assert_eq!(*byte_refs.lo, 0x34);\n\n        *byte_refs.lo = 0xee;\n\n        // drop(byte_refs) // byte_refs is implicitly dropped as we start\n        //                    reading from my_u16 again\n        assert_eq!(my_u16, 0x12ee);\n\n        // we can also assign directly from the method call\n        *my_u16.hi_mut() = 0xaa;\n        assert_eq!(my_u16, 0xaaee);\n\n        *my_u16.lo_mut() = 0x42;\n        assert_eq!(my_u16, 0xaa42);\n    }\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":1}},{"line":14,"address":[],"length":0,"stats":{"Line":1}},{"line":17,"address":[],"length":0,"stats":{"Line":1}},{"line":18,"address":[],"length":0,"stats":{"Line":1}},{"line":22,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":1}},{"line":26,"address":[],"length":0,"stats":{"Line":1}},{"line":27,"address":[],"length":0,"stats":{"Line":1}},{"line":50,"address":[],"length":0,"stats":{"Line":1}},{"line":51,"address":[],"length":0,"stats":{"Line":1}},{"line":52,"address":[],"length":0,"stats":{"Line":2}},{"line":54,"address":[],"length":0,"stats":{"Line":2}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":1}},{"line":62,"address":[],"length":0,"stats":{"Line":1}},{"line":63,"address":[],"length":0,"stats":{"Line":1}},{"line":65,"address":[],"length":0,"stats":{"Line":1}},{"line":67,"address":[],"length":0,"stats":{"Line":0}}],"covered":16,"coverable":18},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","instr_metalang_procmacro","src","lib.rs"],"content":"mod parser;\n\nuse parser::{Cycle, Instr};\nuse proc_macro2::TokenStream;\nuse quote::{format_ident, quote};\n\n/// Function that actually implements all the logic for the proc macro,\n/// using the types provided by the `proc_macro2` crate, which have the\n/// advantage of also existing outside of proc macro crates; and therefore\n/// have more utilities built around them, which makes unit-testing easier,\n/// among many other things.\npub(crate) fn cpu_instr2(input: TokenStream) -\u003e TokenStream {\n    let Instr { name, cycles } = match parser::Instr::try_from(input) {\n        Ok(instr) =\u003e instr,\n        Err(msg) =\u003e panic!(\"{}\", msg),\n    };\n\n    let cycle_funcs = cycles\n        .iter()\n        .enumerate()\n        .map(|(i, Cycle { body, cyc_type })| {\n            let func_name = format_ident!(\"{}_cyc{}\", name, i + 1);\n            let next_func_name = if i != cycles.len() - 1 {\n                format_ident!(\"{}_cyc{}\", name, i + 2)\n            } else {\n                format_ident!(\"opcode_fetch\")\n            };\n\n            quote! {\n                pub(crate) fn #func_name(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    #body\n\n                    (CycleResult::#cyc_type, InstrCycle(#next_func_name))\n                }\n            }\n        });\n\n    TokenStream::from_iter(cycle_funcs)\n}\n\n/// The main proc macro of this crate.\n///\n/// Syntax:\n/// ```rs\n/// cpu_instr!(instr_name {\n///     instruction_body();\n/// });\n/// ```\n///\n/// This macro can be called at the top level (not necessarily within a\n/// function body) since it will only produce function definitions.\n///\n/// The instruction name (`instr_name` in the above example) will be used\n/// as the base for the function name(s) that will be generated, in the\n/// following format: `(\"{}_cyc{}\", instr_name, cycnum)`, where `cycnum`\n/// is the cycle number starting at 1.\n///\n/// The instruction body comes in curly braces after the instruction name.\n/// The body accepts special syntax (*meta instructions*) as well as\n/// function-body Rust code.  \n/// Meta-instructions are a statement starting by a `meta` identifier,\n/// followed by a meta-instruction name (usually in all uppercase),\n/// followed by operands and then a semicolon.\n///\n/// The two basic meta-instructions are `END_CYCLE` and `END_INSTR`,\n/// which both an cycle type as parameter, and act as cycle delimiters;\n/// resulting in a separate function for each cycle.\n///\n/// For a reference of the available meta-instructions\n/// and their behaviour, see the (not yet done because the language is still\n/// very much subject to change) meta language reference in the module\n/// documentation.\n#[proc_macro]\npub fn cpu_instr(input: proc_macro::TokenStream) -\u003e proc_macro::TokenStream {\n    cpu_instr2(input.into()).into()\n}\n\n#[cfg(test)]\nmod test {\n    use super::*;\n\n    fn assert_tokstream_eq(actual: TokenStream, expected: TokenStream) {\n        let Ok(actual) = syn::parse2::\u003csyn::File\u003e(actual) else {\n            panic!(\"assert_tokstream_eq: actual doesn't parse\");\n        };\n        let Ok(expected) = syn::parse2::\u003csyn::File\u003e(expected) else {\n            panic!(\"assert_tokstream_eq: expected doesn't parse\");\n        };\n\n        assert_eq!(\n            actual,\n            expected,\n            \"\\n=====\\nActual:\\n{}\\n=====\\nExpected:\\n{}\\n\",\n            prettyplease::unparse(\u0026actual),\n            prettyplease::unparse(\u0026expected)\n        )\n    }\n\n    fn assert_macro_produces(macro_input: TokenStream, exp_output: TokenStream) {\n        assert_tokstream_eq(cpu_instr2(macro_input), exp_output)\n    }\n\n    #[test]\n    fn test_inx() {\n        assert_macro_produces(\n            quote!(instr_inx {\n                cpu.registers.X = cpu.registers.X.wrapping_add(1);\n                cpu.registers.P.Z = cpu.registers.X == 0;\n                cpu.registers.P.N = cpu.registers.X \u003e 0x7fff;\n\n                meta END_INSTR Internal;\n            }),\n            quote!(\n                pub(crate) fn instr_inx_cyc1(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    cpu.registers.X = cpu.registers.X.wrapping_add(1);\n                    cpu.registers.P.Z = cpu.registers.X == 0;\n                    cpu.registers.P.N = cpu.registers.X \u003e 0x7fff;\n\n                    (CycleResult::Internal, InstrCycle(opcode_fetch))\n                }\n            ),\n        );\n    }\n\n    #[test]\n    fn test_some_instr() {\n        assert_macro_produces(\n            quote!(some_instr {\n                some_function1(cpu);\n                meta END_CYCLE Internal;\n\n                some_function2(cpu);\n                meta END_CYCLE Read;\n\n                some_function3(cpu);\n                meta END_INSTR Write;\n            }),\n            quote!(\n                pub(crate) fn some_instr_cyc1(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    some_function1(cpu);\n\n                    (CycleResult::Internal, InstrCycle(some_instr_cyc2))\n                }\n                pub(crate) fn some_instr_cyc2(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    some_function2(cpu);\n\n                    (CycleResult::Read, InstrCycle(some_instr_cyc3))\n                }\n                pub(crate) fn some_instr_cyc3(cpu: \u0026mut CPU) -\u003e (CycleResult, InstrCycle) {\n                    some_function3(cpu);\n\n                    (CycleResult::Write, InstrCycle(opcode_fetch))\n                }\n            ),\n        );\n    }\n}\n","traces":[{"line":12,"address":[19872,20315],"length":1,"stats":{"Line":2}},{"line":13,"address":[20027,19889],"length":1,"stats":{"Line":4}},{"line":14,"address":[19982],"length":1,"stats":{"Line":2}},{"line":15,"address":[19933],"length":1,"stats":{"Line":0}},{"line":18,"address":[20084],"length":1,"stats":{"Line":2}},{"line":21,"address":[16491,15367,15312,18542],"length":1,"stats":{"Line":6}},{"line":22,"address":[15427],"length":1,"stats":{"Line":2}},{"line":23,"address":[16077,16142],"length":1,"stats":{"Line":4}},{"line":24,"address":[16502,16242],"length":1,"stats":{"Line":2}},{"line":26,"address":[16200,16292],"length":1,"stats":{"Line":2}},{"line":29,"address":[17075,16469],"length":1,"stats":{"Line":4}},{"line":38,"address":[20234],"length":1,"stats":{"Line":2}},{"line":74,"address":[20336],"length":1,"stats":{"Line":0}},{"line":75,"address":[20346],"length":1,"stats":{"Line":0}}],"covered":11,"coverable":14},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","instr_metalang_procmacro","src","parser.rs"],"content":"use pm2::{Ident, TokenStream, TokenTree};\nuse proc_macro2 as pm2;\n\n/// Enum for all the meta instructions implemented for the CPU\n/// meta-language.\npub(crate) enum MetaInstruction {\n    EndCycle(Ident),\n    EndInstr(Ident),\n}\n\nimpl MetaInstruction {\n    /// Method which checks if this instr is a `EndInstr`\n    fn is_end_instr(\u0026self) -\u003e bool {\n        match self {\n            Self::EndInstr(_) =\u003e true,\n            _ =\u003e false,\n        }\n    }\n}\n\nimpl MetaInstruction {\n    /// Conversion from a Token iterator\n    ///\n    /// For some reason can't be implemented as a TryFrom trait\n    fn try_from\u003cI: IntoIterator\u003cItem = TokenTree\u003e\u003e(value: I) -\u003e Result\u003cSelf, \u0026'static str\u003e {\n        let mut it = value.into_iter();\n\n        let Some(TokenTree::Ident(meta_kw)) = it.next() else {\n            Err(\"Expecting a meta-keyword\")?\n        };\n        let ret = match meta_kw.to_string().as_str() {\n            \"END_CYCLE\" =\u003e {\n                let Some(TokenTree::Ident(cyc_type)) = it.next() else {\n                    Err(\"END_CYCLE expects an identifier operand (cycle type)\")?\n                };\n                MetaInstruction::EndCycle(cyc_type)\n            }\n\n            \"END_INSTR\" =\u003e {\n                let Some(TokenTree::Ident(cyc_type)) = it.next() else {\n                    Err(\"INSTR expects an identifier operand (cycle type)\")?\n                };\n                MetaInstruction::EndInstr(cyc_type)\n            }\n\n            _ =\u003e Err(\"Unknown meta-keyword\")?,\n        };\n        if it.next().is_some() {\n            Err(\"Unexpected token after end of meta-instruction\")?\n        }\n        Ok(ret)\n    }\n}\n\n/// Type resulting from the parsing of the token stream passed\n/// as parameter to the [`cpu_instr`] proc macro.\npub(crate) struct Instr {\n    pub name: Ident,\n    pub cycles: Vec\u003cCycle\u003e,\n}\n\nimpl Instr {\n    fn new(name: Ident) -\u003e Self {\n        Self {\n            name,\n            cycles: vec![],\n        }\n    }\n}\n\nimpl TryFrom\u003cTokenStream\u003e for Instr {\n    fn try_from(stream: TokenStream) -\u003e Result\u003cSelf, Self::Error\u003e {\n        let mut it = stream.into_iter();\n        let Some(TokenTree::Ident(name)) = it.next() else {\n            Err(\"Expecting the instruction name\")?\n        };\n        let Some(TokenTree::Group(body)) = it.next() else {\n            Err(\"Expecting the instruction body\")?\n        };\n        if it.next().is_some() {\n            Err(\"Unexpected token after the instruction body\")?\n        }\n\n        let mut it = body.stream().into_iter().peekable();\n        let mut ret = Instr::new(name);\n        loop {\n            let it = it.by_ref();\n            let cycle_body = it.take_while(|token| token.to_string() != \"meta\");\n            let body_tok_stream = TokenStream::from_iter(cycle_body);\n            let meta_instr = MetaInstruction::try_from(it.take_while(|token| {\n                let TokenTree::Punct(p) = token else {\n                    return true;\n                };\n                return p.as_char() != ';';\n            }))?;\n\n            if it.peek().is_none() \u0026\u0026 !meta_instr.is_end_instr() {\n                Err(\"Instructions must end by an END_INSTR meta instruction\")?\n            }\n\n            match meta_instr {\n                MetaInstruction::EndCycle(c) =\u003e ret.cycles.push(Cycle::new(body_tok_stream, c)),\n                MetaInstruction::EndInstr(c) =\u003e ret.cycles.push(Cycle::new(body_tok_stream, c)),\n            }\n\n            if it.peek().is_none() {\n                break;\n            }\n        }\n        Ok(ret)\n    }\n    type Error = \u0026'static str;\n}\n\n/// Data structure which contains the info required to build\n/// a cycle function body\npub(crate) struct Cycle {\n    /// Raw function body\n    pub body: TokenStream,\n    /// Cycle type (part of the function return value; should evaluate\n    /// to something of type `CycleResult`)\n    pub cyc_type: Ident,\n}\n\nimpl Cycle {\n    fn new(body: TokenStream, cyc_type: Ident) -\u003e Self {\n        Self { body, cyc_type }\n    }\n}\n","traces":[{"line":13,"address":[30304],"length":1,"stats":{"Line":1}},{"line":14,"address":[30309],"length":1,"stats":{"Line":1}},{"line":25,"address":[],"length":0,"stats":{"Line":2}},{"line":26,"address":[],"length":0,"stats":{"Line":2}},{"line":28,"address":[],"length":0,"stats":{"Line":6}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":6}},{"line":32,"address":[],"length":0,"stats":{"Line":2}},{"line":33,"address":[],"length":0,"stats":{"Line":3}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":1}},{"line":39,"address":[],"length":0,"stats":{"Line":2}},{"line":40,"address":[],"length":0,"stats":{"Line":3}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":1}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":1}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":63,"address":[30461,30320],"length":1,"stats":{"Line":2}},{"line":66,"address":[30355],"length":1,"stats":{"Line":2}},{"line":72,"address":[33048,33551,30480],"length":1,"stats":{"Line":2}},{"line":73,"address":[30503],"length":1,"stats":{"Line":2}},{"line":74,"address":[30631,30693,30568],"length":1,"stats":{"Line":6}},{"line":75,"address":[33408],"length":1,"stats":{"Line":0}},{"line":77,"address":[30789,30938,30876],"length":1,"stats":{"Line":6}},{"line":78,"address":[33185],"length":1,"stats":{"Line":0}},{"line":80,"address":[31026,31124],"length":1,"stats":{"Line":4}},{"line":81,"address":[31260,33164],"length":1,"stats":{"Line":0}},{"line":84,"address":[31444,31230],"length":1,"stats":{"Line":4}},{"line":85,"address":[31498,31605],"length":1,"stats":{"Line":4}},{"line":86,"address":[32800],"length":1,"stats":{"Line":1}},{"line":87,"address":[31615,31669],"length":1,"stats":{"Line":4}},{"line":88,"address":[28016,28039],"length":1,"stats":{"Line":6}},{"line":89,"address":[31722],"length":1,"stats":{"Line":2}},{"line":90,"address":[28144],"length":1,"stats":{"Line":6}},{"line":91,"address":[28162],"length":1,"stats":{"Line":2}},{"line":92,"address":[28203],"length":1,"stats":{"Line":2}},{"line":94,"address":[28183],"length":1,"stats":{"Line":1}},{"line":97,"address":[32099,32171,32036],"length":1,"stats":{"Line":5}},{"line":98,"address":[32192],"length":1,"stats":{"Line":0}},{"line":101,"address":[32140],"length":1,"stats":{"Line":1}},{"line":102,"address":[32534],"length":1,"stats":{"Line":1}},{"line":103,"address":[32698,32420],"length":1,"stats":{"Line":2}},{"line":106,"address":[32735,32682],"length":1,"stats":{"Line":2}},{"line":110,"address":[32837],"length":1,"stats":{"Line":1}},{"line":126,"address":[33568],"length":1,"stats":{"Line":1}}],"covered":38,"coverable":47},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","cpu.rs"],"content":"use crate::{instr_tab::*, registers::Registers};\nuse common::snes_address::SnesAddress;\n\n/// Resumable main CPU of the SNES, a 65C816\n///\n/// The primary way to use this CPU is through the [`cycle`] function,\n/// which allows to resume execution between cycles, and inspecting\n/// what kind of cycle (memory access or internal) the CPU just finished.\n#[expect(non_snake_case, reason = \"Registers are named in full caps\")]\npub struct CPU {\n    /// Internal registers accessible read/write to executed programs\n    registers: Registers,\n\n    /// Address bus: points to one byte in the global address space\n    /// where memory I/O may occur if a read or write is executed.\n    addr_bus: SnesAddress,\n    /// Data bus: holds one byte that may be sent to RAM (at the address\n    /// hold by the address bus) by executing a write) or coming from\n    /// RAM (from the address in the address bus) right after a read has\n    /// been executed.\n    ///\n    /// It is a public member to allow code managing the CPU to feed\n    /// in bytes read from RAM into the CPU.\n    pub data_bus: u8,\n\n    /// Instruction register: in the original hardware, this holds the opcode\n    /// of the current instruction being executed; in our case, we can take\n    /// the shortcut of holding a reference to our custom Instruction type.\n    IR: \u0026'static Instruction,\n    /// Timing control unit: holds how many cycles of the current\n    /// instruction have been executed\n    TCU: usize,\n}\n\n/// The result of a CPU cycle.\n///\n/// This enum is the return type of the [`CPU::cycle`] function: it is used\n/// to inform the caller of what the CPU has done or I/O requests.\n#[derive(Debug, PartialEq, Eq)]\npub enum CycleResult {\n    /// The CPU wants to read from RAM. The caller should write in the data\n    /// bus the byte contained at the address pointed to by the address bus.\n    Read,\n\n    /// The CPU wants to write to RAM. The caller should write to RAM the\n    /// content of the data bus at the address pointed to by the address bus.\n    Write,\n\n    /// The CPU executes an internal cycle: it only tweaks internal registers,\n    /// does not access RAM. No specific action is required from the caller.\n    Internal,\n}\n\nimpl CPU {\n    pub fn new(registers: Registers) -\u003e Self {\n        Self {\n            registers,\n            addr_bus: SnesAddress::default(),\n            data_bus: 0,\n            IR: INSTRUCTIONS[0xea].unwrap(), // By default hold a NOP (no-operation) to do nothing\n            TCU: 1, // NOP is only 1 cycle, so we go to an opcode fetch cycle\n        }\n    }\n\n    /// Public getter to internal registers, can be used for tests or diagnostics\n    pub fn regs(\u0026self) -\u003e \u0026Registers {\n        \u0026self.registers\n    }\n\n    /// Public getter to the address bus, needs to be read by the\n    /// code managing the CPU for RAM I/O\n    pub fn addr_bus(\u0026self) -\u003e \u0026SnesAddress {\n        \u0026self.addr_bus\n    }\n\n    /// Execute a single CPU cycle.\n    ///\n    /// This function is the core part of the public API to this struct.\n    /// See the following example usage:\n    ///\n    /// ```rs\n    /// let mut cpu = CPU::new(Registers::default);\n    ///\n    /// // Example RAM, would be much more complicated in practice\n    /// let mut ram = [0u8; 65536 * 256];\n    ///\n    /// loop {\n    ///     match cpu.cycle() {\n    ///         // The CPU completed an internal cycle, no action required\n    ///         CycleResult::Internal =\u003e {\n    ///             // sleep for the amount of time for internal cycles\n    ///         },\n    ///\n    ///         // The CPU wants to read from memory\n    ///         CycleResult::Read =\u003e {\n    ///             // Get the read address\n    ///             let addr = *cpu.address_bus();\n    ///\n    ///             // Read the byte from RAM\n    ///             let byte = ram[(addr.bank \u003c\u003c 16) | addr.addr];\n    ///\n    ///             // Inject the byte from RAM into the CPU data bus\n    ///             cpu.data_bus = byte;\n    ///\n    ///             // sleep for the amount of time depending on the read address\n    ///         },\n    ///\n    ///         // The CPU wants to write to memory\n    ///         CycleResult::Write =\u003e {\n    ///             // Get the write address\n    ///             let addr = *cpu.address_bus();\n    ///\n    ///             // Get the byte to write\n    ///             let byte = cpu.data_bus;\n    ///\n    ///             // Inject the byte from the CPU data bus into RAM\n    ///             ram[(addr.bank \u003c\u003c 16) | addr.addr] = byte;\n    ///\n    ///             // sleep for the amount of time depending on the write address\n    ///         }\n    ///     },\n    /// }\n    /// ```\n    ///\n    /// See [`CycleResult`] for more information about the return value of\n    /// this function.\n    pub fn cycle(\u0026mut self) -\u003e CycleResult {\n        // check for opcode fetch cycle\n        if self.TCU == self.IR.len() {\n            self.TCU = 0;\n            self.addr_bus = SnesAddress {\n                bank: self.registers.PB,\n                addr: self.registers.PC,\n            };\n            return CycleResult::Read;\n        }\n\n        // if first cycle of an instruction, set IR according to the fetched opcode\n        if self.TCU == 0 {\n            if let Some(instr) = INSTRUCTIONS[self.data_bus as usize] {\n                self.IR = instr;\n            } else {\n                todo!(\"Unimplemented instruction ({:#02x})\", self.data_bus);\n            }\n        }\n\n        // actually run the instr cycle\n        let ret = match self.IR[self.TCU] {\n            InstructionCycle::Read =\u003e CycleResult::Read,\n            InstructionCycle::Write =\u003e CycleResult::Write,\n            InstructionCycle::Internal(internal) =\u003e {\n                internal(self);\n                CycleResult::Internal\n            }\n        };\n\n        self.TCU += 1;\n        ret\n    }\n\n    /// `INX` instruction: increment register X\n    ///\n    /// Flags set:\n    /// - `Z`: whether the result is zero\n    /// - `N`: whether the result is negative (if it were interpreted as signed)\n    pub(crate) fn inx(\u0026mut self) {\n        self.registers.X = self.registers.X.wrapping_add(1);\n        self.registers.P.Z = self.registers.X == 0;\n        self.registers.P.N = self.registers.X \u003e 0x7fff;\n    }\n}\n\n#[cfg(test)]\nmod test {\n    use super::*;\n\n    #[test]\n    fn test_1_plus_1_is_2() {\n        let mut regs = Registers::default();\n\n        regs.X = 1;\n        let mut cpu = CPU::new(regs);\n\n        cpu.inx();\n        assert_eq!(cpu.regs().X, 2);\n    }\n\n    #[test]\n    fn test_1_plus_1_is_2_cycle_api() {\n        let mut regs = Registers::default();\n        regs.PB = 0x12;\n        regs.PC = 0x3456;\n\n        regs.X = 1;\n        let mut cpu = CPU::new(regs);\n\n        assert_eq!(\n            cpu.cycle(),\n            CycleResult::Read,\n            \"Expecting a read cycle for opcode fetch\"\n        );\n        assert_eq!(\n            *cpu.addr_bus(),\n            SnesAddress {\n                bank: 0x12,\n                addr: 0x3456\n            },\n            \"Read query should be from address at PB:PC\"\n        );\n        cpu.data_bus = 0xe8; // Inject the INX opcode into the CPU\n\n        assert_eq!(\n            cpu.cycle(),\n            CycleResult::Internal,\n            \"Expecting internal cycle for register increment\"\n        );\n        assert_eq!(cpu.regs().X, 2, \"Expecting value 2 in X register\");\n    }\n}\n","traces":[{"line":55,"address":[39184],"length":1,"stats":{"Line":1}},{"line":58,"address":[39218],"length":1,"stats":{"Line":1}},{"line":60,"address":[39232],"length":1,"stats":{"Line":1}},{"line":66,"address":[39376],"length":1,"stats":{"Line":1}},{"line":72,"address":[39392],"length":1,"stats":{"Line":1}},{"line":73,"address":[39400],"length":1,"stats":{"Line":1}},{"line":127,"address":[39408],"length":1,"stats":{"Line":1}},{"line":129,"address":[39443],"length":1,"stats":{"Line":1}},{"line":130,"address":[39472],"length":1,"stats":{"Line":1}},{"line":131,"address":[39487],"length":1,"stats":{"Line":1}},{"line":132,"address":[39480],"length":1,"stats":{"Line":1}},{"line":133,"address":[39483],"length":1,"stats":{"Line":1}},{"line":135,"address":[39494],"length":1,"stats":{"Line":1}},{"line":139,"address":[39458],"length":1,"stats":{"Line":1}},{"line":140,"address":[39592,39708,39504],"length":1,"stats":{"Line":3}},{"line":141,"address":[39700],"length":1,"stats":{"Line":1}},{"line":148,"address":[39852,39555],"length":1,"stats":{"Line":2}},{"line":149,"address":[39916],"length":1,"stats":{"Line":0}},{"line":150,"address":[39926],"length":1,"stats":{"Line":0}},{"line":151,"address":[39946],"length":1,"stats":{"Line":1}},{"line":152,"address":[39966],"length":1,"stats":{"Line":1}},{"line":153,"address":[39968],"length":1,"stats":{"Line":1}},{"line":157,"address":[39981,40026],"length":1,"stats":{"Line":1}},{"line":158,"address":[40013],"length":1,"stats":{"Line":1}},{"line":166,"address":[40064],"length":1,"stats":{"Line":1}},{"line":167,"address":[40078],"length":1,"stats":{"Line":1}},{"line":168,"address":[40101],"length":1,"stats":{"Line":1}},{"line":169,"address":[40114],"length":1,"stats":{"Line":1}}],"covered":26,"coverable":28},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","instr_tab.rs"],"content":"use crate::cpu::CPU;\n\n/// An action the CPU will execute during a cycle.\n///\n/// For [`Read`]/`[`Write`]` cycle, there are no additional fields, the CPU spends\n/// the whole cycle reading or writing.\n///\n/// For internal cycles, any arbitrary action can happen within the CPU, so\n/// the [`Internal`] variant holds a function pointer to the rust code to run.\npub(crate) enum InstructionCycle {\n    Read,\n    Write,\n    Internal(fn(\u0026mut CPU) -\u003e ()),\n}\n\n/// Type representing the definition of a CPU instruction\n///\n/// Conceptually, an instruction is simply a list of actions\n/// done in 1 cycle each. This is what this type represents.\npub(crate) type Instruction = [InstructionCycle];\n\n/// Table of all SNES CPU instructions.\n///\n/// Since each one of the 256 possible opcodes is associated with a valid\n/// instruction, we can use an array to store them all.\n///\n/// When all instructions will be implemented, the [`Option`] wrapper\n/// will be removed.\npub(crate) const INSTRUCTIONS: [Option\u003c\u0026'static Instruction\u003e; 256] = [\n    /* 00 */ None,\n    /* 01 */ None,\n    /* 02 */ None,\n    /* 03 */ None,\n    /* 04 */ None,\n    /* 05 */ None,\n    /* 06 */ None,\n    /* 07 */ None,\n    /* 08 */ None,\n    /* 09 */ None,\n    /* 0a */ None,\n    /* 0b */ None,\n    /* 0c */ None,\n    /* 0d */ None,\n    /* 0e */ None,\n    /* 0f */ None,\n    /* 10 */ None,\n    /* 11 */ None,\n    /* 12 */ None,\n    /* 13 */ None,\n    /* 14 */ None,\n    /* 15 */ None,\n    /* 16 */ None,\n    /* 17 */ None,\n    /* 18 */ None,\n    /* 19 */ None,\n    /* 1a */ None,\n    /* 1b */ None,\n    /* 1c */ None,\n    /* 1d */ None,\n    /* 1e */ None,\n    /* 1f */ None,\n    /* 20 */ None,\n    /* 21 */ None,\n    /* 22 */ None,\n    /* 23 */ None,\n    /* 24 */ None,\n    /* 25 */ None,\n    /* 26 */ None,\n    /* 27 */ None,\n    /* 28 */ None,\n    /* 29 */ None,\n    /* 2a */ None,\n    /* 2b */ None,\n    /* 2c */ None,\n    /* 2d */ None,\n    /* 2e */ None,\n    /* 2f */ None,\n    /* 30 */ None,\n    /* 31 */ None,\n    /* 32 */ None,\n    /* 33 */ None,\n    /* 34 */ None,\n    /* 35 */ None,\n    /* 36 */ None,\n    /* 37 */ None,\n    /* 38 */ None,\n    /* 39 */ None,\n    /* 3a */ None,\n    /* 3b */ None,\n    /* 3c */ None,\n    /* 3d */ None,\n    /* 3e */ None,\n    /* 3f */ None,\n    /* 40 */ None,\n    /* 41 */ None,\n    /* 42 */ None,\n    /* 43 */ None,\n    /* 44 */ None,\n    /* 45 */ None,\n    /* 46 */ None,\n    /* 47 */ None,\n    /* 48 */ None,\n    /* 49 */ None,\n    /* 4a */ None,\n    /* 4b */ None,\n    /* 4c */ None,\n    /* 4d */ None,\n    /* 4e */ None,\n    /* 4f */ None,\n    /* 50 */ None,\n    /* 51 */ None,\n    /* 52 */ None,\n    /* 53 */ None,\n    /* 54 */ None,\n    /* 55 */ None,\n    /* 56 */ None,\n    /* 57 */ None,\n    /* 58 */ None,\n    /* 59 */ None,\n    /* 5a */ None,\n    /* 5b */ None,\n    /* 5c */ None,\n    /* 5d */ None,\n    /* 5e */ None,\n    /* 5f */ None,\n    /* 60 */ None,\n    /* 61 */ None,\n    /* 62 */ None,\n    /* 63 */ None,\n    /* 64 */ None,\n    /* 65 */ None,\n    /* 66 */ None,\n    /* 67 */ None,\n    /* 68 */ None,\n    /* 69 */ None,\n    /* 6a */ None,\n    /* 6b */ None,\n    /* 6c */ None,\n    /* 6d */ None,\n    /* 6e */ None,\n    /* 6f */ None,\n    /* 70 */ None,\n    /* 71 */ None,\n    /* 72 */ None,\n    /* 73 */ None,\n    /* 74 */ None,\n    /* 75 */ None,\n    /* 76 */ None,\n    /* 77 */ None,\n    /* 78 */ None,\n    /* 79 */ None,\n    /* 7a */ None,\n    /* 7b */ None,\n    /* 7c */ None,\n    /* 7d */ None,\n    /* 7e */ None,\n    /* 7f */ None,\n    /* 80 */ None,\n    /* 81 */ None,\n    /* 82 */ None,\n    /* 83 */ None,\n    /* 84 */ None,\n    /* 85 */ None,\n    /* 86 */ None,\n    /* 87 */ None,\n    /* 88 */ None,\n    /* 89 */ None,\n    /* 8a */ None,\n    /* 8b */ None,\n    /* 8c */ None,\n    /* 8d */ None,\n    /* 8e */ None,\n    /* 8f */ None,\n    /* 90 */ None,\n    /* 91 */ None,\n    /* 92 */ None,\n    /* 93 */ None,\n    /* 94 */ None,\n    /* 95 */ None,\n    /* 96 */ None,\n    /* 97 */ None,\n    /* 98 */ None,\n    /* 99 */ None,\n    /* 9a */ None,\n    /* 9b */ None,\n    /* 9c */ None,\n    /* 9d */ None,\n    /* 9e */ None,\n    /* 9f */ None,\n    /* a0 */ None,\n    /* a1 */ None,\n    /* a2 */ None,\n    /* a3 */ None,\n    /* a4 */ None,\n    /* a5 */ None,\n    /* a6 */ None,\n    /* a7 */ None,\n    /* a8 */ None,\n    /* a9 */ None,\n    /* aa */ None,\n    /* ab */ None,\n    /* ac */ None,\n    /* ad */ None,\n    /* ae */ None,\n    /* af */ None,\n    /* b0 */ None,\n    /* b1 */ None,\n    /* b2 */ None,\n    /* b3 */ None,\n    /* b4 */ None,\n    /* b5 */ None,\n    /* b6 */ None,\n    /* b7 */ None,\n    /* b8 */ None,\n    /* b9 */ None,\n    /* ba */ None,\n    /* bb */ None,\n    /* bc */ None,\n    /* bd */ None,\n    /* be */ None,\n    /* bf */ None,\n    /* c0 */ None,\n    /* c1 */ None,\n    /* c2 */ None,\n    /* c3 */ None,\n    /* c4 */ None,\n    /* c5 */ None,\n    /* c6 */ None,\n    /* c7 */ None,\n    /* c8 */ None,\n    /* c9 */ None,\n    /* ca */ None,\n    /* cb */ None,\n    /* cc */ None,\n    /* cd */ None,\n    /* ce */ None,\n    /* cf */ None,\n    /* d0 */ None,\n    /* d1 */ None,\n    /* d2 */ None,\n    /* d3 */ None,\n    /* d4 */ None,\n    /* d5 */ None,\n    /* d6 */ None,\n    /* d7 */ None,\n    /* d8 */ None,\n    /* d9 */ None,\n    /* da */ None,\n    /* db */ None,\n    /* dc */ None,\n    /* dd */ None,\n    /* de */ None,\n    /* df */ None,\n    /* e0 */ None,\n    /* e1 */ None,\n    /* e2 */ None,\n    /* e3 */ None,\n    /* e4 */ None,\n    /* e5 */ None,\n    /* e6 */ None,\n    /* e7 */ None,\n    /* e8 */ Some(\u0026[InstructionCycle::Internal(CPU::inx)]),\n    /* e9 */ None,\n    /* ea */ Some(\u0026[InstructionCycle::Internal(|_| {})]), // No-op, do nothing\n    /* eb */ None,\n    /* ec */ None,\n    /* ed */ None,\n    /* ee */ None,\n    /* ef */ None,\n    /* f0 */ None,\n    /* f1 */ None,\n    /* f2 */ None,\n    /* f3 */ None,\n    /* f4 */ None,\n    /* f5 */ None,\n    /* f6 */ None,\n    /* f7 */ None,\n    /* f8 */ None,\n    /* f9 */ None,\n    /* fa */ None,\n    /* fb */ None,\n    /* fc */ None,\n    /* fd */ None,\n    /* fe */ None,\n    /* ff */ None,\n];\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","lib.rs"],"content":"pub mod registers;\npub mod cpu;\nmod instr_tab;\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use registers::Registers;\n\n\n    #[test]\n    fn regs () {\n        let _ = Registers::default();\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","cpu","src","registers.rs"],"content":"/// A struct which represents the WDC 65C816's registers\n#[allow(non_snake_case, reason = \"We are naming register in all caps\")]\n#[derive(Debug)]\npub struct Registers {\n    /// The accumulator register: stores the result of most operations\n    pub A: u16,\n\n    /// Data Bank register: Default bank address for memory transfers\n    pub DB: u8,\n\n    /// Direct register: offset applied to all memory addresses for instructions\n    /// which use direct addressing\n    pub D: u16,\n\n    /// The index registers: used for 2D computations or memory access\n    pub X: u16,\n    pub Y: u16,\n\n    /// Processor status register: contains various CPU flags\n    pub P: RegisterP,\n\n    /// Program bank register: stores the bank address of current execution\n    pub PB: u8,\n\n    /// Program Counter: stores the current execution address within [`Registers::PB`]\n    pub PC: u16,\n\n    /// Stack pointer: the address of the top of the stack\n    pub S: u16,\n}\n\n#[allow(non_snake_case, reason = \"We are naming register in all caps\")]\n#[derive(Debug)]\npub struct RegisterP {\n    /// Carry flag: typically set when an arithmetic operation \"carries out\"\n    pub C: bool,\n\n    /// Negative flag: set when the result of a previous instruction is negative\n    pub N: bool,\n\n    /// Overflow flag: whether an operation overflew\n    pub V: bool,\n\n    /// Zero flag: set when the result is zero\n    pub Z: bool,\n\n    // Registers below are still unused\n    /// Decimal flag\n    pub D: bool,\n\n    /// IRQ Disable flag\n    pub I: bool,\n\n    /// Memory/Accumulator flag: Controls the width of the A register\n    ///\n    /// When set to 0, the accumulator register (A) is 16 bits wide \\\n    /// When set to 1, the accumulator register (A) is 8 bits wide\n    ///\n    /// Always set to 1 in emulation mode, reset to 1 when switching to native mode\n    pub M: bool,\n\n    /// Index flag: Controls the width of the index registers X and Y\n    ///\n    /// When set to 0, both X and Y are 16 bits wide \\\n    /// When set to 1, both X and Y are 8 bits wide\n    ///\n    /// When switching from 0 to 1, the high byte of both registers resets to 0\n    ///\n    /// Only exists in native mode (E=1), replaced by the B flag in emulation mode.\\\n    /// Reset to 1 when switching to native mode\n    pub X: bool,\n\n    /// Emulation flag: whether the CPU is in 8-bit compatibility mode\n    pub E: bool,\n\n    /// Break flag\n    pub B: bool,\n}\n\n/// Implementation of the default state of the CPU registers on power-on or reset\n/// TODO: Make this implementation truthful to the real 65816.\nimpl Default for Registers {\n    fn default() -\u003e Self {\n        Self {\n            A: 0,\n            DB: 0,\n            D: 0,\n            X: 0,\n            Y: 0,\n            P: RegisterP::default(),\n            PB: 0,\n            PC: 0,\n            S: 0,\n        }\n    }\n}\n\n/// TODO: Make this implementation truthful to the real 65816.\nimpl Default for RegisterP {\n    fn default() -\u003e Self {\n        Self {\n            C: false,\n            N: false,\n            V: false,\n            Z: false,\n            D: false,\n            I: false,\n            M: false,\n            X: false,\n            E: false,\n            B: false,\n        }\n    }\n}\n","traces":[{"line":83,"address":[42288],"length":1,"stats":{"Line":1}},{"line":90,"address":[42302],"length":1,"stats":{"Line":1}},{"line":100,"address":[42400],"length":1,"stats":{"Line":1}}],"covered":3,"coverable":3},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","lib.rs"],"content":"pub mod utils;\npub mod tile;\npub mod ppu;\n\n#[cfg(test)]\nmod tests;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","ppu.rs"],"content":"use crate::utils::{render_scanline, CGRAM_SIZE, HEIGHT, VRAM_SIZE, WIDTH};\n\npub struct PPU {\n    pub(crate) framebuffer: Vec\u003cu32\u003e,\n    pub(crate) vram: [u8; VRAM_SIZE],\n    pub(crate) cgram: [u16; CGRAM_SIZE],\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    pub(crate) cgaddr: u8,\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    pub(crate) latch: u8,\n    pub(crate) latch_filled: bool\n}\n\nimpl PPU {\n    pub fn new() -\u003e Self {\n        let mut ppu = Self {\n            framebuffer: vec![0; WIDTH * HEIGHT],\n            vram: [0; VRAM_SIZE],\n            cgram: [0; CGRAM_SIZE],\n            cgaddr: 0,\n            latch: 0,\n            latch_filled: false\n        };\n\n        // Hardcoded palette\n        for i in 0..CGRAM_SIZE {\n            let r = (i \u0026 0x1F) as u16;\n            let g = ((i \u003e\u003e 2) \u0026 0x1F) as u16;\n            let b = ((i \u003e\u003e 4) \u0026 0x1F) as u16;\n            ppu.cgram[i] = (b \u003c\u003c 10) | (g \u003c\u003c 5) | r;\n        }\n\n        ppu\n    }\n\n    pub fn write_vram(\u0026mut self, addr: usize, value: u8) {\n        if addr \u003e= VRAM_SIZE {\n            eprintln!(\"[ERR::VRAM] Write attempt to invalid address 0x{:04X}\", addr);\n            return;\n        }\n        self.vram[addr] = value;\n    }\n\n    pub fn read_vram(\u0026self, addr: usize) -\u003e u8 {\n        if addr \u003e= VRAM_SIZE {\n            eprintln!(\"[ERR::VRAM] Read attempt from invalid address 0x{:04X}\", addr);\n            return 0;\n        }\n        self.vram[addr]\n    }\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    // Set current CGRAM address ($2121 on the SNES)\n    pub fn set_cgram_addr(\u0026mut self, addr: u8) {\n        self.cgaddr = addr;\n        self.latch_filled = false; // reset latch when address changes\n    }\n\n    #[allow(dead_code)] // For future CPU write handling (not implemented yet)\n    // Write one byte to CGRAM ($2122 on the SNES)\n    pub fn write_cgram_data(\u0026mut self, value: u8) {\n        if self.latch_filled {\n            // 2nd write â†’ combine low + high into one 16-bit value\n            let color = u16::from_le_bytes([self.latch, value]);\n            self.cgram[self.cgaddr as usize] = color \u0026 0x7FFF; // mask to 15 bits\n            self.cgaddr = self.cgaddr.wrapping_add(1); // auto-increment address\n            self.latch_filled = false;\n        } else {\n            // 1st write â†’ store in latch\n            self.latch = value;\n            self.latch_filled = true;\n        }\n    }\n\n    pub fn read_cgram(\u0026self, index: u8) -\u003e u32 {\n        bgr555_to_argb(self.cgram[index as usize])\n    }\n\n    pub fn render(\u0026mut self, tiles_per_row: usize) {\n        for y in 0..HEIGHT {\n            render_scanline(self, y, tiles_per_row);\n        }\n    }\n}\n\npub fn bgr555_to_argb(bgr: u16) -\u003e u32 {\n    let r = (bgr \u0026 0x1F) as u32;\n    let g = ((bgr \u003e\u003e 5) \u0026 0x1F) as u32;\n    let b = ((bgr \u003e\u003e 10) \u0026 0x1F) as u32;\n\n    // Expand 5-bit to 8-bit by duplicating upper bits\n    let r8 = (r \u003c\u003c 3) | (r \u003e\u003e 2);\n    let g8 = (g \u003c\u003c 3) | (g \u003e\u003e 2);\n    let b8 = (b \u003c\u003c 3) | (b \u003e\u003e 2);\n\n    (0xFF \u003c\u003c 24) | (r8 \u003c\u003c 16) | (g8 \u003c\u003c 8) | b8\n}\n","traces":[{"line":17,"address":[79157,78432,79163],"length":1,"stats":{"Line":13}},{"line":19,"address":[702786,703072],"length":1,"stats":{"Line":13}},{"line":20,"address":[702891],"length":1,"stats":{"Line":13}},{"line":21,"address":[702925],"length":1,"stats":{"Line":13}},{"line":28,"address":[703426,703044,703135],"length":1,"stats":{"Line":39}},{"line":29,"address":[703241],"length":1,"stats":{"Line":13}},{"line":30,"address":[78954,79000],"length":1,"stats":{"Line":26}},{"line":31,"address":[703330],"length":1,"stats":{"Line":13}},{"line":32,"address":[703356,703436],"length":1,"stats":{"Line":13}},{"line":35,"address":[703265],"length":1,"stats":{"Line":13}},{"line":38,"address":[703488],"length":1,"stats":{"Line":4}},{"line":39,"address":[703523],"length":1,"stats":{"Line":4}},{"line":40,"address":[703554],"length":1,"stats":{"Line":1}},{"line":43,"address":[703664,703675,703534],"length":1,"stats":{"Line":5}},{"line":46,"address":[703712],"length":1,"stats":{"Line":1}},{"line":47,"address":[79433],"length":1,"stats":{"Line":2}},{"line":48,"address":[703768],"length":1,"stats":{"Line":1}},{"line":49,"address":[703862],"length":1,"stats":{"Line":1}},{"line":51,"address":[703748,703894,703879],"length":1,"stats":{"Line":2}},{"line":56,"address":[703936],"length":1,"stats":{"Line":5}},{"line":57,"address":[703948],"length":1,"stats":{"Line":5}},{"line":58,"address":[703954],"length":1,"stats":{"Line":5}},{"line":63,"address":[703968],"length":1,"stats":{"Line":2}},{"line":64,"address":[79875,79720,79689],"length":1,"stats":{"Line":14}},{"line":66,"address":[704035],"length":1,"stats":{"Line":5}},{"line":67,"address":[704186,704087,704129],"length":1,"stats":{"Line":8}},{"line":68,"address":[704142],"length":1,"stats":{"Line":5}},{"line":69,"address":[704172],"length":1,"stats":{"Line":5}},{"line":72,"address":[79707],"length":1,"stats":{"Line":2}},{"line":73,"address":[704017],"length":1,"stats":{"Line":7}},{"line":77,"address":[79904],"length":1,"stats":{"Line":1}},{"line":78,"address":[704278,704229],"length":1,"stats":{"Line":1}},{"line":81,"address":[704304],"length":1,"stats":{"Line":2}},{"line":82,"address":[704327,704352],"length":1,"stats":{"Line":4}},{"line":83,"address":[80099],"length":1,"stats":{"Line":2}},{"line":88,"address":[704416],"length":1,"stats":{"Line":1}},{"line":89,"address":[80120],"length":1,"stats":{"Line":1}},{"line":90,"address":[704438],"length":1,"stats":{"Line":1}},{"line":91,"address":[704456],"length":1,"stats":{"Line":5}},{"line":94,"address":[704471],"length":1,"stats":{"Line":5}},{"line":95,"address":[704485],"length":1,"stats":{"Line":5}},{"line":96,"address":[704499],"length":1,"stats":{"Line":5}},{"line":98,"address":[704513],"length":1,"stats":{"Line":5}}],"covered":43,"coverable":43},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","tile.rs"],"content":"use image::{Rgba};\nuse crate::ppu::PPU;\nuse crate::utils::{TILE_SIZE};\n\npub fn load_and_split_image(path: \u0026str) -\u003e (Vec\u003cVec\u003cRgba\u003cu8\u003e\u003e\u003e, usize) {\n    let img = image::open(path).expect(\"[ERR::ImageLoad] Failed to load image file.\");\n    let img = img.to_rgba8();\n    let width = img.width() as usize;\n    let height = img.height() as usize;\n\n    let tile_size = TILE_SIZE;\n\n    let tiles_x = (width + tile_size - 1) / tile_size;\n    let tiles_y = (height + tile_size - 1) / tile_size;\n\n    let mut tiles = Vec::new();\n\n    for ty in 0..tiles_y {\n        for tx in 0..tiles_x {\n            let mut tile = Vec::new();\n\n            let x_start = tx * tile_size;\n            let y_start = ty * tile_size;\n            let x_end = (x_start + tile_size).min(width);\n            let y_end = (y_start + tile_size).min(height);\n\n            for y in y_start..y_end {\n                for x in x_start..x_end {\n                    let px = img.get_pixel(x as u32, y as u32);\n                    tile.push(*px);\n                }\n            }\n\n            tiles.push(tile);\n        }\n    }\n\n    (tiles, width)\n}\n\npub fn load_tiles_into_vram(ppu: \u0026mut PPU, tiles: \u0026Vec\u003cVec\u003cRgba\u003cu8\u003e\u003e\u003e) {\n    for (tile_index, tile) in tiles.iter().enumerate() {\n        let base_addr = tile_index * TILE_SIZE * TILE_SIZE;\n        if tile.len() \u003c TILE_SIZE * TILE_SIZE {\n            eprintln!(\n                \"[WARN] Skipping tile {}: only {} pixels, expected {}\",\n                tile_index,\n                tile.len(),\n                TILE_SIZE * TILE_SIZE\n            );\n            continue;\n        }\n\n        for y in 0..TILE_SIZE {\n            for x in 0..TILE_SIZE {\n                let pixel = \u0026tile[y * TILE_SIZE + x];\n\n                // Tmp: taking the red intensity as a \"palette index\"\n                let value = pixel[0] \u003e\u003e 2; // 0â€“255 â†’ 0â€“63 (enough to index a fake palette)\n\n                let addr = base_addr + y * TILE_SIZE + x;\n                ppu.write_vram(addr, value);\n            }\n        }\n    }\n}\n\npub fn get_tile_from_vram(ppu: \u0026PPU, tile_index: usize) -\u003e Vec\u003cu32\u003e {\n    let mut tile_pixels = Vec::new();\n    let base_addr = tile_index * TILE_SIZE * TILE_SIZE;\n\n    for y in 0..TILE_SIZE {\n        for x in 0..TILE_SIZE {\n            let addr = base_addr + y * TILE_SIZE + x;\n            let palette_index = ppu.read_vram(addr);\n\n            // Get color from CGRAM\n            let argb = ppu.read_cgram(palette_index);\n            tile_pixels.push(argb);\n        }\n    }\n\n    tile_pixels\n}\n","traces":[{"line":5,"address":[137024,139019,139013],"length":1,"stats":{"Line":7}},{"line":6,"address":[483895],"length":1,"stats":{"Line":7}},{"line":7,"address":[483980],"length":1,"stats":{"Line":5}},{"line":8,"address":[484043,484117],"length":1,"stats":{"Line":10}},{"line":9,"address":[484135],"length":1,"stats":{"Line":5}},{"line":11,"address":[484194],"length":1,"stats":{"Line":5}},{"line":13,"address":[137374],"length":1,"stats":{"Line":5}},{"line":14,"address":[484330],"length":1,"stats":{"Line":5}},{"line":16,"address":[484455],"length":1,"stats":{"Line":5}},{"line":18,"address":[484557,484470],"length":1,"stats":{"Line":10}},{"line":19,"address":[485597,484686,484857],"length":1,"stats":{"Line":15}},{"line":20,"address":[484990],"length":1,"stats":{"Line":5}},{"line":22,"address":[485078,485005],"length":1,"stats":{"Line":5}},{"line":23,"address":[485153,485177,485058],"length":1,"stats":{"Line":10}},{"line":24,"address":[485211,485161],"length":1,"stats":{"Line":10}},{"line":25,"address":[138434],"length":1,"stats":{"Line":5}},{"line":27,"address":[485348],"length":1,"stats":{"Line":5}},{"line":28,"address":[485498,485612],"length":1,"stats":{"Line":10}},{"line":29,"address":[485722],"length":1,"stats":{"Line":5}},{"line":30,"address":[485770],"length":1,"stats":{"Line":5}},{"line":34,"address":[485519],"length":1,"stats":{"Line":5}},{"line":38,"address":[484733],"length":1,"stats":{"Line":5}},{"line":41,"address":[485872],"length":1,"stats":{"Line":1}},{"line":42,"address":[139182,139081],"length":1,"stats":{"Line":2}},{"line":43,"address":[486152,486111,486236],"length":1,"stats":{"Line":2}},{"line":44,"address":[486203,486259],"length":1,"stats":{"Line":2}},{"line":45,"address":[486317],"length":1,"stats":{"Line":1}},{"line":54,"address":[486355,486279],"length":1,"stats":{"Line":2}},{"line":55,"address":[139623,139592],"length":1,"stats":{"Line":2}},{"line":56,"address":[486529,486678],"length":1,"stats":{"Line":1}},{"line":59,"address":[139786],"length":1,"stats":{"Line":1}},{"line":61,"address":[486802,486701,486658],"length":1,"stats":{"Line":2}},{"line":62,"address":[486789],"length":1,"stats":{"Line":1}},{"line":68,"address":[487088,487913,487907],"length":1,"stats":{"Line":4}},{"line":69,"address":[140311],"length":1,"stats":{"Line":4}},{"line":70,"address":[487165,487321,487283],"length":1,"stats":{"Line":8}},{"line":72,"address":[140517,140459],"length":1,"stats":{"Line":8}},{"line":73,"address":[487455,487554],"length":1,"stats":{"Line":8}},{"line":74,"address":[487669,487811],"length":1,"stats":{"Line":4}},{"line":75,"address":[487800,487844],"length":1,"stats":{"Line":8}},{"line":78,"address":[487851],"length":1,"stats":{"Line":4}},{"line":79,"address":[487876],"length":1,"stats":{"Line":4}},{"line":83,"address":[487501],"length":1,"stats":{"Line":4}}],"covered":43,"coverable":43},{"path":["/","home","cbaziret","devel","eip","r-snes","ppu","src","utils.rs"],"content":"use crate::ppu::PPU;\nuse crate::tile::get_tile_from_vram;\n\npub const VRAM_SIZE: usize = 64 * 1024; // 64 KB\npub const CGRAM_SIZE: usize = 256; // 256 color palette\npub const TILE_SIZE: usize = 8;\npub const TILES_X: usize = 32;\npub const TILES_Y: usize = 32;\npub const WIDTH: usize = TILES_X * TILE_SIZE;\npub const HEIGHT: usize = TILES_Y * TILE_SIZE;\npub const SCALE: usize = 2;\npub const SCREEN_WIDTH: usize = WIDTH * SCALE;\npub const SCREEN_HEIGHT: usize = HEIGHT * SCALE;\n\npub fn render_scanline(ppu: \u0026mut PPU, y: usize, tiles_per_row: usize) {\n    if y \u003e= HEIGHT {\n        return;\n    }\n\n    for x in 0..tiles_per_row {\n        let tile_index = (y / TILE_SIZE) * tiles_per_row + x;\n\n        let tile_pixels = get_tile_from_vram(ppu, tile_index);\n\n        let tile_line = y % TILE_SIZE;\n\n        for px in 0..TILE_SIZE {\n            let screen_x = x * TILE_SIZE + px;\n            if screen_x \u003c WIDTH {\n                let color = tile_pixels[tile_line * TILE_SIZE + px];\n                ppu.framebuffer[y * WIDTH + screen_x] = color;\n            }\n        }\n    }\n}","traces":[{"line":15,"address":[243217,242272,243211],"length":1,"stats":{"Line":1}},{"line":16,"address":[625159],"length":1,"stats":{"Line":1}},{"line":20,"address":[625176,625212],"length":1,"stats":{"Line":4}},{"line":21,"address":[625296,625396],"length":1,"stats":{"Line":2}},{"line":23,"address":[625381],"length":1,"stats":{"Line":2}},{"line":25,"address":[625394,625417],"length":1,"stats":{"Line":9}},{"line":27,"address":[625433,625517],"length":1,"stats":{"Line":10}},{"line":28,"address":[625741,625680,625631],"length":1,"stats":{"Line":10}},{"line":29,"address":[625728,626038],"length":1,"stats":{"Line":10}},{"line":30,"address":[625764],"length":1,"stats":{"Line":5}},{"line":31,"address":[625908],"length":1,"stats":{"Line":5}}],"covered":11,"coverable":11}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('pre', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('code', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>
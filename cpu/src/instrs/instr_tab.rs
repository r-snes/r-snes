use crate::cpu::{CPU, CycleResult};
use common::snes_address::SnesAddress;

use crate::instrs::{
    flags::*,
    uncategorised::*,
};

pub(crate) struct InstrCycle(pub fn(&mut CPU) -> (CycleResult, InstrCycle));

impl From<fn(&mut CPU) -> (CycleResult, InstrCycle)> for InstrCycle {
    fn from(value: fn(&mut CPU) -> (CycleResult, InstrCycle)) -> Self {
        InstrCycle(value)
    }
}

pub(crate) fn opcode_fetch(cpu: &mut CPU) -> (CycleResult, InstrCycle) {
    cpu.addr_bus = SnesAddress {
        bank: cpu.registers.PB,
        addr: cpu.registers.PC,
    };

    (
        CycleResult::Read,
        InstrCycle(|next_cyc_cpu| (INSTR_CYC1[next_cyc_cpu.data_bus as usize].0)(next_cyc_cpu)),
    )
}

const INSTR_CYC1: [InstrCycle; 256] = [
    /* 00 */ InstrCycle(opcode_fetch),
    /* 01 */ InstrCycle(opcode_fetch),
    /* 02 */ InstrCycle(opcode_fetch),
    /* 03 */ InstrCycle(opcode_fetch),
    /* 04 */ InstrCycle(opcode_fetch),
    /* 05 */ InstrCycle(opcode_fetch),
    /* 06 */ InstrCycle(opcode_fetch),
    /* 07 */ InstrCycle(opcode_fetch),
    /* 08 */ InstrCycle(opcode_fetch),
    /* 09 */ InstrCycle(opcode_fetch),
    /* 0a */ InstrCycle(opcode_fetch),
    /* 0b */ InstrCycle(opcode_fetch),
    /* 0c */ InstrCycle(opcode_fetch),
    /* 0d */ InstrCycle(opcode_fetch),
    /* 0e */ InstrCycle(opcode_fetch),
    /* 0f */ InstrCycle(opcode_fetch),
    /* 10 */ InstrCycle(opcode_fetch),
    /* 11 */ InstrCycle(opcode_fetch),
    /* 12 */ InstrCycle(opcode_fetch),
    /* 13 */ InstrCycle(opcode_fetch),
    /* 14 */ InstrCycle(opcode_fetch),
    /* 15 */ InstrCycle(opcode_fetch),
    /* 16 */ InstrCycle(opcode_fetch),
    /* 17 */ InstrCycle(opcode_fetch),
    /* 18 */ InstrCycle(clc_cyc1),
    /* 19 */ InstrCycle(opcode_fetch),
    /* 1a */ InstrCycle(opcode_fetch),
    /* 1b */ InstrCycle(opcode_fetch),
    /* 1c */ InstrCycle(opcode_fetch),
    /* 1d */ InstrCycle(opcode_fetch),
    /* 1e */ InstrCycle(opcode_fetch),
    /* 1f */ InstrCycle(opcode_fetch),
    /* 20 */ InstrCycle(opcode_fetch),
    /* 21 */ InstrCycle(opcode_fetch),
    /* 22 */ InstrCycle(opcode_fetch),
    /* 23 */ InstrCycle(opcode_fetch),
    /* 24 */ InstrCycle(opcode_fetch),
    /* 25 */ InstrCycle(opcode_fetch),
    /* 26 */ InstrCycle(opcode_fetch),
    /* 27 */ InstrCycle(opcode_fetch),
    /* 28 */ InstrCycle(opcode_fetch),
    /* 29 */ InstrCycle(opcode_fetch),
    /* 2a */ InstrCycle(opcode_fetch),
    /* 2b */ InstrCycle(opcode_fetch),
    /* 2c */ InstrCycle(opcode_fetch),
    /* 2d */ InstrCycle(opcode_fetch),
    /* 2e */ InstrCycle(opcode_fetch),
    /* 2f */ InstrCycle(opcode_fetch),
    /* 30 */ InstrCycle(opcode_fetch),
    /* 31 */ InstrCycle(opcode_fetch),
    /* 32 */ InstrCycle(opcode_fetch),
    /* 33 */ InstrCycle(opcode_fetch),
    /* 34 */ InstrCycle(opcode_fetch),
    /* 35 */ InstrCycle(opcode_fetch),
    /* 36 */ InstrCycle(opcode_fetch),
    /* 37 */ InstrCycle(opcode_fetch),
    /* 38 */ InstrCycle(sec_cyc1),
    /* 39 */ InstrCycle(opcode_fetch),
    /* 3a */ InstrCycle(opcode_fetch),
    /* 3b */ InstrCycle(opcode_fetch),
    /* 3c */ InstrCycle(opcode_fetch),
    /* 3d */ InstrCycle(opcode_fetch),
    /* 3e */ InstrCycle(opcode_fetch),
    /* 3f */ InstrCycle(opcode_fetch),
    /* 40 */ InstrCycle(opcode_fetch),
    /* 41 */ InstrCycle(opcode_fetch),
    /* 42 */ InstrCycle(opcode_fetch),
    /* 43 */ InstrCycle(opcode_fetch),
    /* 44 */ InstrCycle(opcode_fetch),
    /* 45 */ InstrCycle(opcode_fetch),
    /* 46 */ InstrCycle(opcode_fetch),
    /* 47 */ InstrCycle(opcode_fetch),
    /* 48 */ InstrCycle(opcode_fetch),
    /* 49 */ InstrCycle(opcode_fetch),
    /* 4a */ InstrCycle(opcode_fetch),
    /* 4b */ InstrCycle(opcode_fetch),
    /* 4c */ InstrCycle(opcode_fetch),
    /* 4d */ InstrCycle(opcode_fetch),
    /* 4e */ InstrCycle(opcode_fetch),
    /* 4f */ InstrCycle(opcode_fetch),
    /* 50 */ InstrCycle(opcode_fetch),
    /* 51 */ InstrCycle(opcode_fetch),
    /* 52 */ InstrCycle(opcode_fetch),
    /* 53 */ InstrCycle(opcode_fetch),
    /* 54 */ InstrCycle(opcode_fetch),
    /* 55 */ InstrCycle(opcode_fetch),
    /* 56 */ InstrCycle(opcode_fetch),
    /* 57 */ InstrCycle(opcode_fetch),
    /* 58 */ InstrCycle(cli_cyc1),
    /* 59 */ InstrCycle(opcode_fetch),
    /* 5a */ InstrCycle(opcode_fetch),
    /* 5b */ InstrCycle(opcode_fetch),
    /* 5c */ InstrCycle(opcode_fetch),
    /* 5d */ InstrCycle(opcode_fetch),
    /* 5e */ InstrCycle(opcode_fetch),
    /* 5f */ InstrCycle(opcode_fetch),
    /* 60 */ InstrCycle(opcode_fetch),
    /* 61 */ InstrCycle(opcode_fetch),
    /* 62 */ InstrCycle(opcode_fetch),
    /* 63 */ InstrCycle(opcode_fetch),
    /* 64 */ InstrCycle(opcode_fetch),
    /* 65 */ InstrCycle(opcode_fetch),
    /* 66 */ InstrCycle(opcode_fetch),
    /* 67 */ InstrCycle(opcode_fetch),
    /* 68 */ InstrCycle(opcode_fetch),
    /* 69 */ InstrCycle(opcode_fetch),
    /* 6a */ InstrCycle(opcode_fetch),
    /* 6b */ InstrCycle(opcode_fetch),
    /* 6c */ InstrCycle(opcode_fetch),
    /* 6d */ InstrCycle(opcode_fetch),
    /* 6e */ InstrCycle(opcode_fetch),
    /* 6f */ InstrCycle(opcode_fetch),
    /* 70 */ InstrCycle(opcode_fetch),
    /* 71 */ InstrCycle(opcode_fetch),
    /* 72 */ InstrCycle(opcode_fetch),
    /* 73 */ InstrCycle(opcode_fetch),
    /* 74 */ InstrCycle(opcode_fetch),
    /* 75 */ InstrCycle(opcode_fetch),
    /* 76 */ InstrCycle(opcode_fetch),
    /* 77 */ InstrCycle(opcode_fetch),
    /* 78 */ InstrCycle(sei_cyc1),
    /* 79 */ InstrCycle(opcode_fetch),
    /* 7a */ InstrCycle(opcode_fetch),
    /* 7b */ InstrCycle(opcode_fetch),
    /* 7c */ InstrCycle(opcode_fetch),
    /* 7d */ InstrCycle(opcode_fetch),
    /* 7e */ InstrCycle(opcode_fetch),
    /* 7f */ InstrCycle(opcode_fetch),
    /* 80 */ InstrCycle(opcode_fetch),
    /* 81 */ InstrCycle(opcode_fetch),
    /* 82 */ InstrCycle(opcode_fetch),
    /* 83 */ InstrCycle(opcode_fetch),
    /* 84 */ InstrCycle(opcode_fetch),
    /* 85 */ InstrCycle(opcode_fetch),
    /* 86 */ InstrCycle(opcode_fetch),
    /* 87 */ InstrCycle(opcode_fetch),
    /* 88 */ InstrCycle(opcode_fetch),
    /* 89 */ InstrCycle(opcode_fetch),
    /* 8a */ InstrCycle(opcode_fetch),
    /* 8b */ InstrCycle(opcode_fetch),
    /* 8c */ InstrCycle(opcode_fetch),
    /* 8d */ InstrCycle(opcode_fetch),
    /* 8e */ InstrCycle(opcode_fetch),
    /* 8f */ InstrCycle(opcode_fetch),
    /* 90 */ InstrCycle(opcode_fetch),
    /* 91 */ InstrCycle(opcode_fetch),
    /* 92 */ InstrCycle(opcode_fetch),
    /* 93 */ InstrCycle(opcode_fetch),
    /* 94 */ InstrCycle(opcode_fetch),
    /* 95 */ InstrCycle(opcode_fetch),
    /* 96 */ InstrCycle(opcode_fetch),
    /* 97 */ InstrCycle(opcode_fetch),
    /* 98 */ InstrCycle(opcode_fetch),
    /* 99 */ InstrCycle(opcode_fetch),
    /* 9a */ InstrCycle(opcode_fetch),
    /* 9b */ InstrCycle(opcode_fetch),
    /* 9c */ InstrCycle(opcode_fetch),
    /* 9d */ InstrCycle(opcode_fetch),
    /* 9e */ InstrCycle(opcode_fetch),
    /* 9f */ InstrCycle(opcode_fetch),
    /* a0 */ InstrCycle(opcode_fetch),
    /* a1 */ InstrCycle(opcode_fetch),
    /* a2 */ InstrCycle(opcode_fetch),
    /* a3 */ InstrCycle(opcode_fetch),
    /* a4 */ InstrCycle(opcode_fetch),
    /* a5 */ InstrCycle(opcode_fetch),
    /* a6 */ InstrCycle(opcode_fetch),
    /* a7 */ InstrCycle(opcode_fetch),
    /* a8 */ InstrCycle(opcode_fetch),
    /* a9 */ InstrCycle(opcode_fetch),
    /* aa */ InstrCycle(opcode_fetch),
    /* ab */ InstrCycle(opcode_fetch),
    /* ac */ InstrCycle(opcode_fetch),
    /* ad */ InstrCycle(opcode_fetch),
    /* ae */ InstrCycle(opcode_fetch),
    /* af */ InstrCycle(opcode_fetch),
    /* b0 */ InstrCycle(opcode_fetch),
    /* b1 */ InstrCycle(opcode_fetch),
    /* b2 */ InstrCycle(opcode_fetch),
    /* b3 */ InstrCycle(opcode_fetch),
    /* b4 */ InstrCycle(opcode_fetch),
    /* b5 */ InstrCycle(opcode_fetch),
    /* b6 */ InstrCycle(opcode_fetch),
    /* b7 */ InstrCycle(opcode_fetch),
    /* b8 */ InstrCycle(clv_cyc1),
    /* b9 */ InstrCycle(opcode_fetch),
    /* ba */ InstrCycle(opcode_fetch),
    /* bb */ InstrCycle(opcode_fetch),
    /* bc */ InstrCycle(opcode_fetch),
    /* bd */ InstrCycle(opcode_fetch),
    /* be */ InstrCycle(opcode_fetch),
    /* bf */ InstrCycle(opcode_fetch),
    /* c0 */ InstrCycle(opcode_fetch),
    /* c1 */ InstrCycle(opcode_fetch),
    /* c2 */ InstrCycle(opcode_fetch),
    /* c3 */ InstrCycle(opcode_fetch),
    /* c4 */ InstrCycle(opcode_fetch),
    /* c5 */ InstrCycle(opcode_fetch),
    /* c6 */ InstrCycle(opcode_fetch),
    /* c7 */ InstrCycle(opcode_fetch),
    /* c8 */ InstrCycle(opcode_fetch),
    /* c9 */ InstrCycle(opcode_fetch),
    /* ca */ InstrCycle(opcode_fetch),
    /* cb */ InstrCycle(opcode_fetch),
    /* cc */ InstrCycle(opcode_fetch),
    /* cd */ InstrCycle(opcode_fetch),
    /* ce */ InstrCycle(opcode_fetch),
    /* cf */ InstrCycle(opcode_fetch),
    /* d0 */ InstrCycle(opcode_fetch),
    /* d1 */ InstrCycle(opcode_fetch),
    /* d2 */ InstrCycle(opcode_fetch),
    /* d3 */ InstrCycle(opcode_fetch),
    /* d4 */ InstrCycle(opcode_fetch),
    /* d5 */ InstrCycle(opcode_fetch),
    /* d6 */ InstrCycle(opcode_fetch),
    /* d7 */ InstrCycle(opcode_fetch),
    /* d8 */ InstrCycle(cld_cyc1),
    /* d9 */ InstrCycle(opcode_fetch),
    /* da */ InstrCycle(opcode_fetch),
    /* db */ InstrCycle(opcode_fetch),
    /* dc */ InstrCycle(opcode_fetch),
    /* dd */ InstrCycle(opcode_fetch),
    /* de */ InstrCycle(opcode_fetch),
    /* df */ InstrCycle(opcode_fetch),
    /* e0 */ InstrCycle(opcode_fetch),
    /* e1 */ InstrCycle(opcode_fetch),
    /* e2 */ InstrCycle(opcode_fetch),
    /* e3 */ InstrCycle(opcode_fetch),
    /* e4 */ InstrCycle(opcode_fetch),
    /* e5 */ InstrCycle(opcode_fetch),
    /* e6 */ InstrCycle(opcode_fetch),
    /* e7 */ InstrCycle(opcode_fetch),
    /* e8 */ InstrCycle(inx_cyc1),
    /* e9 */ InstrCycle(opcode_fetch),
    /* ea */ InstrCycle(nop_cyc1),
    /* eb */ InstrCycle(opcode_fetch),
    /* ec */ InstrCycle(opcode_fetch),
    /* ed */ InstrCycle(opcode_fetch),
    /* ee */ InstrCycle(opcode_fetch),
    /* ef */ InstrCycle(opcode_fetch),
    /* f0 */ InstrCycle(opcode_fetch),
    /* f1 */ InstrCycle(opcode_fetch),
    /* f2 */ InstrCycle(opcode_fetch),
    /* f3 */ InstrCycle(opcode_fetch),
    /* f4 */ InstrCycle(opcode_fetch),
    /* f5 */ InstrCycle(opcode_fetch),
    /* f6 */ InstrCycle(opcode_fetch),
    /* f7 */ InstrCycle(opcode_fetch),
    /* f8 */ InstrCycle(sed_cyc1),
    /* f9 */ InstrCycle(opcode_fetch),
    /* fa */ InstrCycle(opcode_fetch),
    /* fb */ InstrCycle(opcode_fetch),
    /* fc */ InstrCycle(opcode_fetch),
    /* fd */ InstrCycle(opcode_fetch),
    /* fe */ InstrCycle(opcode_fetch),
    /* ff */ InstrCycle(opcode_fetch),
];
